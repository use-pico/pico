# 14.1 Migration Overview

## Table of Contents
- [14.1 Migration Overview](./14.1-migration-overview.md) *(current)*
- [14.2 From CVA to CLS](./14.2-from-cva-to-cls.md)
- [14.3 From TV to CLS](./14.3-from-tv-to-cls.md)
- [14.4 From Stitches to CLS](./14.4-from-stitches-to-cls.md)
- [14.5 From Vanilla Extract to CLS](./14.5-from-vanilla-extract-to-cls.md)
- [14.6 From CSS Modules to CLS](./14.6-from-css-modules-to-cls.md)
- [14.7 From Emotion to CLS](./14.7-from-emotion-to-cls.md)
- [14.8 Migration Best Practices](./14.8-migration-best-practices.md)

---

Welcome to the **Migration Guide**! 🚀 This chapter is your **comprehensive roadmap** for migrating from other styling libraries to CLS. Whether you're coming from **CVA**, **TV**, **Stitches**, or any other styling solution, we've got you covered.

## **Why Migrate to CLS?** 🤔

Before diving into the migration details, let's understand **why** you might want to migrate to CLS:

### **Key Benefits** ✨

- **🎯 Type Safety**: Comprehensive contract validation and IntelliSense
- **🏗️ Scalability**: Multi-level inheritance and composition
- **🎨 Design Tokens**: Organized, inheritable design values
- **⚡ Runtime Flexibility**: Dynamic theming and user customization
- **🌐 Framework Agnostic**: Works with any framework or no framework
- **👥 Team Collaboration**: Predictable APIs and consistent patterns
- **📈 Performance**: Optimized class generation with caching

### **When Migration Makes Sense** 🎯

- **Complex design systems** requiring inheritance and composition
- **Multi-framework environments** where consistency is crucial
- **Runtime theming** and user customization requirements
- **Large-scale applications** with complex styling needs
- **Teams building maintainable** and extensible styling systems

## **Migration Complexity Overview** 📊

Here's a **quick overview** of migration complexity for different libraries:

| Library | Complexity | Timeline | Key Challenges |
|---------|------------|----------|----------------|
| **CVA** | 🟡 Medium | 2-4 weeks | Learning contracts, architecture planning |
| **TV** | 🟡 Medium | 2-4 weeks | Moving from Tailwind-specific to framework-agnostic |
| **Stitches** | 🟡 Medium | 3-5 weeks | CSS-in-JS to class-based paradigm shift |
| **Vanilla Extract** | 🔴 High | 4-8 weeks | Build-time to runtime paradigm shift |
| **CSS Modules** | 🟢 Easy | 1-2 weeks | Simple class-based migration |
| **Emotion** | 🟡 Medium | 3-5 weeks | CSS-in-JS to class-based paradigm shift |

## **Common Migration Patterns** 🔄

### **1. Contract-First Approach** 📋

**Before (CVA/TV):**
```typescript
// Variant-based approach
const button = cva({
  base: "base-classes",
  variants: {
    size: { sm: "text-sm", md: "text-base", lg: "text-lg" },
    tone: { primary: "bg-blue-600", secondary: "bg-gray-600" }
  }
});
```

**After (CLS):**
```typescript
// Contract-first approach
const ButtonCls = cls({
  slot: ["root"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["primary", "secondary"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg.primary": ["bg-blue-600"],
    "color.bg.secondary": ["bg-gray-600"]
  }),
  rules: [
    def.rule({
      variant: { size: "sm" },
      root: what.css(["text-sm"])
    }),
    def.rule({
      variant: { tone: "primary" },
      root: what.css(["color.bg.primary"])
    })
  ]
}));
```

### **2. Design Token Migration** 🎨

**Before (Hardcoded Values):**
```typescript
// Scattered hardcoded values
const button = cva({
  variants: {
    tone: {
      primary: "bg-blue-600 text-white", // Hardcoded
      secondary: "bg-gray-600 text-white" // Hardcoded
    }
  }
});
```

**After (Design Tokens):**
```typescript
// Organized design tokens
const ButtonCls = cls({
  slot: ["root"],
  variant: { tone: ["primary", "secondary"] }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg.primary": ["bg-blue-600"],
    "color.bg.secondary": ["bg-gray-600"],
    "color.text.primary": ["text-white"],
    "color.text.secondary": ["text-white"]
  }),
  rules: [
    def.rule({
      variant: { tone: "primary" },
      root: what.css(["color.bg.primary", "color.text.primary"])
    }),
    def.rule({
      variant: { tone: "secondary" },
      root: what.css(["color.bg.secondary", "color.text.secondary"])
    })
  ]
}));
```

### **3. Component Interface Migration** 🧩

**Before (Library-Specific):**
```typescript
// CVA/TV component interface
interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  size?: "sm" | "md" | "lg";
  tone?: "primary" | "secondary";
}

function Button({ size, tone, className, ...props }: ButtonProps) {
  return (
    <button className={button({ size, tone, className })} {...props} />
  );
}
```

**After (CLS Component Interface):**
```typescript
// CLS component interface
import type { Component } from "@use-pico/cls";

interface ButtonProps extends Component<typeof ButtonCls, React.ButtonHTMLAttributes<HTMLButtonElement>> {
  children: React.ReactNode;
}

function Button({
  size = "md",
  tone = "primary",
  tva = ButtonCls,
  cls,
  ...props
}: ButtonProps) {
  const buttonClasses = useCls(tva, cls, ({ what }) => ({
    variant: what.variant({ size, tone })
  }));

  return (
    <button className={buttonClasses.root()} {...props} />
  );
}
```

## **Migration Strategy** 🎯

### **Phase 1: Preparation** 📋

1. **📚 Learn CLS Concepts**: Understand contracts, tokens, rules, and inheritance
2. **🏗️ Plan Architecture**: Design your inheritance hierarchy and token structure
3. **🛠️ Set Up Environment**: Install CLS and configure your build tools
4. **📝 Create Migration Plan**: Identify components to migrate and their dependencies

### **Phase 2: Foundation** 🏛️

1. **🎨 Define Design Tokens**: Create your token structure and values
2. **📋 Create Base Contracts**: Define foundational CLS instances
3. **🧪 Build Test Components**: Create simple components to validate your approach
4. **📖 Document Patterns**: Establish team patterns and conventions

### **Phase 3: Migration** 🔄

1. **🎯 Start with Simple Components**: Begin with basic, isolated components
2. **🔄 Migrate Component by Component**: Convert one component at a time
3. **✅ Test Thoroughly**: Ensure all variants and combinations work correctly
4. **📈 Iterate and Refine**: Improve your patterns based on real usage

### **Phase 4: Optimization** ⚡

1. **🏗️ Implement Inheritance**: Refactor common patterns into base classes
2. **🎨 Optimize Tokens**: Consolidate and organize your design tokens
3. **📊 Performance Tuning**: Optimize class generation and caching
4. **📚 Documentation**: Update team documentation and examples

## **Common Challenges & Solutions** 🛠️

### **Challenge 1: Learning Curve** 📚

**Problem**: CLS has more concepts than simpler libraries.

**Solution**:
- Start with simple components and gradually add complexity
- Use the **contract-first approach** to understand the structure
- Leverage **design tokens** to organize your values
- Practice with **inheritance** on smaller components first

### **Challenge 2: Architecture Planning** 🏗️

**Problem**: Designing the right inheritance hierarchy can be complex.

**Solution**:
- Start with **flat contracts** and add inheritance later
- Use **composition** (`use()` method) for simple combinations
- Create **base classes** for common patterns (buttons, inputs, etc.)
- Document your **inheritance strategy** for team consistency

### **Challenge 3: Performance Concerns** ⚡

**Problem**: Runtime class generation might seem slower than build-time.

**Solution**:
- CLS includes **per-slot memoization** for performance
- **Lazy evaluation** means styles are computed only when needed
- **Caching** prevents redundant class generation
- **Tree shaking** removes unused code in production

### **Challenge 4: Team Adoption** 👥

**Problem**: Team members need to learn new patterns and concepts.

**Solution**:
- Provide **comprehensive documentation** and examples
- Create **migration guides** for common patterns
- Use **consistent naming conventions** across the team
- **Pair program** during the initial migration phase

## **Testing Your Migration** 🧪

### **Unit Testing** ✅

```typescript
// Test CLS instances
describe("ButtonCls", () => {
  it("should generate correct classes for primary variant", () => {
    const classes = ButtonCls.create({
      variant: { tone: "primary" }
    });
    
    expect(classes.root()).toContain("bg-blue-600");
    expect(classes.root()).toContain("text-white");
  });

  it("should handle multiple variants", () => {
    const classes = ButtonCls.create({
      variant: { size: "sm", tone: "primary" }
    });
    
    expect(classes.root()).toContain("text-sm");
    expect(classes.root()).toContain("bg-blue-600");
  });
});
```

### **Integration Testing** 🔗

```typescript
// Test React components
describe("Button Component", () => {
  it("should render with correct classes", () => {
    render(<Button size="sm" tone="primary">Click me</Button>);
    
    const button = screen.getByRole("button");
    expect(button).toHaveClass("text-sm", "bg-blue-600", "text-white");
  });

  it("should handle user configuration", () => {
    render(
      <Button 
        size="sm" 
        tone="primary"
        tweak={({ what }) => ({
          variant: what.variant({ size: "lg" }) // Override size
        })}
      >
        Click me
      </Button>
    );
    
    const button = screen.getByRole("button");
    expect(button).toHaveClass("text-lg"); // Should use overridden size
  });
});
```

## **Rollback Strategy** 🔄

### **Gradual Migration** 📈

- **Keep both systems** running during migration
- **Migrate components incrementally** to reduce risk
- **Use feature flags** to control which system is active
- **Monitor performance** and user experience during migration

### **Rollback Plan** 🔙

- **Maintain old code** until migration is complete and tested
- **Create migration scripts** that can be reversed
- **Document rollback procedures** for each component
- **Test rollback scenarios** before starting migration

## **Success Metrics** 📊

### **Technical Metrics** ⚡

- **Bundle size reduction** (if applicable)
- **Runtime performance** improvements
- **Type safety coverage** increase
- **Code duplication** reduction

### **Team Metrics** 👥

- **Developer productivity** improvements
- **Code review efficiency** increase
- **Bug reduction** in styling-related issues
- **Team satisfaction** with the new system

### **Business Metrics** 💼

- **Time to market** for new features
- **Maintenance cost** reduction
- **Design consistency** improvements
- **User experience** enhancements

## **Getting Help** 🆘

### **Resources** 📚

- **CLS Documentation**: Comprehensive guides and examples
- **Community Support**: GitHub discussions and issues
- **Migration Examples**: Real-world migration case studies
- **Team Training**: Workshops and pair programming sessions

### **Support Channels** 💬

- **GitHub Issues**: For bugs and feature requests
- **GitHub Discussions**: For questions and community support
- **Documentation**: For detailed guides and examples
- **Team Slack/Discord**: For internal team support

## **Next Steps** 🚀

Now that you understand the **migration overview**, you're ready to dive into **specific migration guides**:

- **[From CVA to CLS](./14.2-from-cva-to-cls.md)** - Migrate from Class Variance Authority
- **[From TV to CLS](./14.3-from-tv-to-cls.md)** - Migrate from Tailwind Variants
- **[From Stitches to CLS](./14.4-from-stitches-to-cls.md)** - Migrate from Stitches CSS-in-JS
- **[From Vanilla Extract to CLS](./14.5-from-vanilla-extract-to-cls.md)** - Migrate from Vanilla Extract
- **[From CSS Modules to CLS](./14.6-from-css-modules-to-cls.md)** - Migrate from CSS Modules
- **[From Emotion to CLS](./14.7-from-emotion-to-cls.md)** - Migrate from Emotion CSS-in-JS
- **[Migration Best Practices](./14.8-migration-best-practices.md)** - Best practices and tips

Each guide provides **step-by-step instructions**, **code examples**, and **common pitfalls** to avoid.

**Ready to start your migration journey?** Let's begin with the specific library you're migrating from! 🎯

---

**Previous:** [Chapter 13: Comparison](../13-comparison/README.md) | **Next:** [14.2 From CVA to CLS](./14.2-from-cva-to-cls.md)
