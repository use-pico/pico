# 4.2 `withCls` HOC

## Table of Contents
- [4.1 `useCls` Hook](./4.1-usecls-hook.md)
- [4.2 `withCls` HOC](./4.2-withcls-hoc.md) *(current)*
- [4.3 Context Integration](./4.3-context-integration.md)
- [4.4 `Component` Patterns](./4.4-component-patterns.md)
- [4.5 `ClsProvider` & `useClsContext`](./4.5-clsprovider-useclscontext.md)
- [4.6 Component Creation](./4.6-component-creation.md)
- [4.7 Theming & Tokens](./4.7-theming-tokens.md)

---

The `withCls` Higher-Order Component (HOC) is a powerful utility that **attaches CLS instances directly to your React components**. It provides convenient access to the CLS instance and its type information, making your components more self-contained and easier to work with.

## üéØ What is `withCls`?

The `withCls` HOC wraps your component and attaches a CLS instance to it, giving you access to:
- **Direct CLS instance access** via `Component.cls`
- **Type information** for better IntelliSense
- **Convenient styling methods** without importing CLS instances separately

Think of it as **component enhancement** - your component becomes aware of its styling system.

## üìù Basic Usage

```tsx
import { cls } from "@use-pico/cls";
import { withCls } from "@use-pico/cls/react";

// Define your CLS instance
const ButtonCls = cls({
  slot: ["root", "label", "icon"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["primary", "secondary", "danger"]
  }
}, ({ what, def }) => ({
  root: def.root([
    "px-4 py-2 rounded font-medium transition-colors",
    what.variant({ size: "md", tone: "primary" })
  ]),
  label: def.label(["text-white"]),
  icon: def.icon(["w-4 h-4"])
}));

// Define your component
function Button({ children, size = "md", tone = "primary", ...props }) {
  return (
    <button 
      className={ButtonCls.create(({ what }) => ({
        variant: what.variant({ size, tone })
      })).root()}
      {...props}
    >
      {children}
    </button>
  );
}

// Attach CLS to component
const ModernButton = withCls(Button, ButtonCls);

// Now you can use it like:
// <ModernButton size="lg" tone="danger">Click me</ModernButton>
// And access the CLS: ModernButton.cls
```

## üîß HOC Signature

```typescript
function withCls<TCls extends Cls<any>, T extends object>(
  Component: T,
  clsInstance: TCls
): T & {
  cls: TCls;
  "~slots": ClsSlots<TCls["contract"]>;
  "~contract": TCls["contract"];
  "~definition": TCls["definition"];
}
```

### **Parameters:**

- **`Component`**: The React component to wrap
- **`clsInstance`**: The CLS instance to attach

### **Returns:**

The original component with additional properties:
- **`cls`**: The attached CLS instance
- **`~slots`**: Type information for slots
- **`~contract`**: Type information for the contract
- **`~definition`**: Type information for the definition

## üé® Advanced Usage Patterns

### **Component with Multiple Slots**

```tsx
const CardCls = cls({
  slot: ["root", "header", "body", "footer"],
  variant: {
    size: ["sm", "md", "lg"],
    layout: ["horizontal", "vertical"]
  }
}, ({ what, def }) => ({
  root: def.root([
    "border rounded-lg shadow-sm",
    what.variant({ size: "md", layout: "vertical" })
  ]),
  header: def.header(["p-4 border-b"]),
  body: def.body(["p-4"]),
  footer: def.footer(["p-4 border-t bg-gray-50"])
}));

function Card({ children, size = "md", layout = "vertical", ...props }) {
  const classes = CardCls.create(({ what }) => ({
    variant: what.variant({ size, layout })
  }));
  
  return (
    <div className={classes.root()} {...props}>
      <div className={classes.header()}>Header</div>
      <div className={classes.body()}>{children}</div>
      <div className={classes.footer()}>Footer</div>
    </div>
  );
}

const ModernCard = withCls(Card, CardCls);
// Access: ModernCard.cls.create(...)
```

### **Component with Icon Support**

```tsx
const IconButtonCls = cls({
  slot: ["root", "icon", "label"],
  variant: {
    size: ["sm", "md", "lg"],
    hasIcon: [true, false]
  }
}, ({ what, def }) => ({
  root: def.root([
    "inline-flex items-center justify-center rounded",
    what.variant({ size: "md", hasIcon: false })
  ]),
  icon: def.icon(["w-4 h-4"]),
  label: def.label(["ml-2"])
}));

function IconButton({ 
  children, 
  icon, 
  size = "md", 
  ...props 
}) {
  const hasIcon = Boolean(icon);
  const classes = IconButtonCls.create(({ what }) => ({
    variant: what.variant({ size, hasIcon })
  }));
  
  return (
    <button className={classes.root()} {...props}>
      {icon && <span className={classes.icon()}>{icon}</span>}
      {children && <span className={classes.label()}>{children}</span>}
    </button>
  );
}

const ModernIconButton = withCls(IconButton, IconButtonCls);
```

## üîç Accessing the CLS Instance

Once you've attached a CLS instance to your component, you can access it in several ways:

### **Direct Access**

```tsx
// Access the CLS instance directly
const buttonClasses = ModernButton.cls.create(({ what }) => ({
  variant: what.variant({ size: "lg", tone: "danger" })
}));

console.log(buttonClasses.root()); // Generated classes
```

### **Type Information Access**

```tsx
// Access type information
type ButtonSlots = typeof ModernButton["~slots"];
type ButtonContract = typeof ModernButton["~contract"];
type ButtonDefinition = typeof ModernButton["~definition"];

// Use in other components
function ButtonGroup({ children }) {
  // You can use the attached CLS instance
  const groupClasses = ModernButton.cls.create(({ what }) => ({
    variant: what.variant({ size: "md", tone: "secondary" })
  }));
  
  return (
    <div className="flex gap-2">
      {children}
    </div>
  );
}
```

### **Component Composition**

```tsx
// Create a button with an icon using the attached CLS
function IconButton({ icon, children, ...props }) {
  const buttonClasses = ModernButton.cls.create(({ what }) => ({
    variant: what.variant({ size: "md", tone: "primary" })
  }));
  
  return (
    <button className={buttonClasses.root()} {...props}>
      {icon && <span className="w-4 h-4 mr-2">{icon}</span>}
      {children}
    </button>
  );
}

const ModernIconButton = withCls(IconButton, IconButtonCls);
```

## ‚ö° Performance Benefits

### **Reduced Imports**

```tsx
// ‚ùå Without withCls: Need to import CLS everywhere
import { ButtonCls } from "./ButtonCls";
import { CardCls } from "./CardCls";
import { IconCls } from "./IconCls";

// ‚úÖ With withCls: CLS is attached to component
const ModernButton = withCls(Button, ButtonCls);
const ModernCard = withCls(Card, CardCls);
const ModernIcon = withCls(Icon, IconCls);

// Use anywhere without imports
function App() {
  return (
    <div>
      <ModernButton>Click me</ModernButton>
      <ModernCard>Content</ModernCard>
      <ModernIcon name="star" />
    </div>
  );
}
```

### **Type Safety**

```tsx
// TypeScript knows about the attached CLS
function ButtonWrapper() {
  // ‚úÖ Type-safe access
  const classes = ModernButton.cls.create(({ what }) => ({
    variant: what.variant({ 
      size: "md",     // TypeScript ensures this is valid
      tone: "primary" // TypeScript ensures this is valid
    })
  }));
  
  return <button className={classes.root()}>Wrapper</button>;
}
```

## üéØ Best Practices

### **1. Keep Components Focused**

```tsx
// ‚úÖ Good: Component handles its own styling
function Button({ children, size, tone, ...props }) {
  const classes = ButtonCls.create(({ what }) => ({
    variant: what.variant({ size, tone })
  }));
  
  return <button className={classes.root()} {...props}>{children}</button>;
}

const ModernButton = withCls(Button, ButtonCls);

// ‚ùå Avoid: Component with too many responsibilities
function Button({ children, size, tone, theme, layout, ...props }) {
  // Too many styling concerns
}
```

### **2. Use Consistent Naming**

```tsx
// ‚úÖ Good: Clear naming convention
const ModernButton = withCls(Button, ButtonCls);
const ModernCard = withCls(Card, CardCls);
const ModernInput = withCls(Input, InputCls);

// ‚ùå Avoid: Inconsistent naming
const ButtonWithCls = withCls(Button, ButtonCls);
const CardComponent = withCls(Card, CardCls);
```

### **3. Leverage Type Information**

```tsx
// ‚úÖ Good: Use attached type information
function ButtonGroup({ children, variant }) {
  // Use the attached CLS for consistent styling
  const groupClasses = ModernButton.cls.create(({ what }) => ({
    variant: what.variant({ size: "md", tone: variant })
  }));
  
  return (
    <div className="flex gap-2">
      {children}
    </div>
  );
}

// ‚ùå Avoid: Hard-coding styles
function ButtonGroup({ children, variant }) {
  return (
    <div className="flex gap-2">
      {children}
    </div>
  );
}
```

## üîç Common Patterns

### **Component Library Pattern**

```tsx
// components/Button.tsx
export const Button = withCls(ButtonComponent, ButtonCls);
export const Card = withCls(CardComponent, CardCls);
export const Input = withCls(InputComponent, InputCls);

// Usage in other files
import { Button, Card, Input } from "./components";

function App() {
  return (
    <div>
      <Button size="lg" tone="primary">Click me</Button>
      <Card size="md">Content</Card>
      <Input placeholder="Enter text" />
    </div>
  );
}
```

### **Theme-Aware Components**

```tsx
function ThemedButton({ children, theme, ...props }) {
  // Use the attached CLS with theme overrides
  const classes = ModernButton.cls.create(
    ({ what }) => ({
      variant: what.variant({ size: "md", tone: "primary" })
    }),
    ({ override }) => ({
      token: override.token({
        "color.bg": {
          primary: theme === "dark" ? ["bg-gray-800"] : ["bg-blue-600"]
        }
      })
    })
  );
  
  return <button className={classes.root()} {...props}>{children}</button>;
}

const ModernThemedButton = withCls(ThemedButton, ButtonCls);
```

## üöÄ What's Next?

Now that you understand the `withCls` HOC, you're ready to explore:

- **[4.3 Context Integration](./4.3-context-integration.md)**: Master React Context integration
- **[4.4 `Component` Patterns](./4.4-component-patterns.md)**: Advanced component patterns
- **[4.5 `ClsProvider` & `useClsContext`](./4.5-clsprovider-useclscontext.md)**: Global styling contexts

The `withCls` HOC makes your components more self-contained and easier to work with. Use it to create a cohesive component library! üéâ

---

**Previous:** [4.1 `useCls` Hook](./4.1-usecls-hook.md) | **Next:** [4.3 Context Integration](./4.3-context-integration.md)
