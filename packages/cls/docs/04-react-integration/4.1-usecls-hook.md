# 4.1 `useCls` Hook

## Table of Contents
- [4.1 `useCls` Hook](./4.1-usecls-hook.md) *(current)*
- [4.2 `withCls` HOC](./4.2-withcls-hoc.md)
- [4.3 Context Integration](./4.3-context-integration.md)
- [4.4 `Component` Patterns](./4.4-component-patterns.md)
- [4.5 `ClsProvider` & `useClsContext`](./4.5-clsprovider-useclscontext.md)
- [4.6 Component Creation](./4.6-component-creation.md)
- [4.7 Theming & Tokens](./4.7-theming-tokens.md)

---

The `useCls` hook is the **foundation of React integration** in `@use-pico/cls`. It bridges the gap between CLS instances and React components, providing type-safe, dynamic styling with seamless context integration.

## üéØ What is `useCls`?

The `useCls` hook takes a CLS instance and optional configuration functions, then returns a fully configured CLS instance ready for use in your React components. It's like having a **styling factory** that works perfectly with React's rendering cycle.

## üìù Basic Usage

```tsx
import { cls } from "@use-pico/cls";
import { useCls } from "@use-pico/cls/react";

// Define your CLS instance
const ButtonCls = cls({
  slot: ["root", "label"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["primary", "secondary"],
    disabled: [true, false]
  }
}, ({ what, def }) => ({
  root: def.root([
    "px-4 py-2 rounded font-medium",
    what.variant({ size: "md", tone: "primary", disabled: false })
  ]),
  label: def.label(["text-white"])
}));

// Use in your component with Component interface
import type { Component } from "@use-pico/cls";

interface ButtonProps extends Component<typeof ButtonCls, React.ButtonHTMLAttributes<HTMLButtonElement>> {
  children: React.ReactNode;
  size?: "sm" | "md" | "lg";
  tone?: "primary" | "secondary";
  disabled?: boolean;
}

function Button({ 
  children, 
  size = "md", 
  tone = "primary", 
  disabled = false,
  tva = ButtonCls,
  cls,
  ...props
}: ButtonProps) {
  const buttonClasses = tva.create(cls, () => ({
    variant: {
      size,
      tone,
      disabled
    }
  }));
  
  return (
    <button 
      className={buttonClasses.root()}
      disabled={disabled}
      {...props}
    >
      <span className={buttonClasses.label()}>{children}</span>
    </button>
  );
}
```

## üîß Hook Signature

```typescript
function useCls<TContract extends Contract<any, any, any>>(
  clsInstance: Cls<TContract>,
  userConfigFn?: (props: WhatUtil<TContract>) => Partial<CreateConfig<TContract>>,
  internalConfigFn?: (props: WhatUtil<TContract>) => Partial<CreateConfig<TContract>>
): Cls<TContract>
```

### **Parameters:**

- **`clsInstance`**: The CLS instance to use
- **`userConfigFn`**: Optional function for user-provided configuration (variants, tokens, etc.)
- **`internalConfigFn`**: Optional function for internal/context configuration

### **Returns:**

A fully configured CLS instance with all styling resolved and ready for use.

## üé® Advanced Usage Patterns

### **Dynamic Variants**

```tsx
interface ResponsiveButtonProps extends Component<typeof ButtonCls, React.ButtonHTMLAttributes<HTMLButtonElement>> {
  children: React.ReactNode;
  size?: "sm" | "md" | "lg";
  tone?: "primary" | "secondary";
  disabled?: boolean;
}

function ResponsiveButton({ 
  children, 
  size = "md", 
  tone = "secondary", 
  disabled = false,
  tva = ButtonCls,
  cls,
  ...props
}: ResponsiveButtonProps) {
  const buttonClasses = tva.create(cls, () => ({
    variant: {
      size,
      tone,
      disabled
    }
  }));
  
  return (
    <button 
      className={buttonClasses.root()}
      disabled={disabled}
      {...props}
    >
      {children}
    </button>
  );
}
```

### **Runtime Token Overrides**

```tsx
interface ThemedButtonProps extends Component<typeof ButtonCls, React.ButtonHTMLAttributes<HTMLButtonElement>> {
  children: React.ReactNode;
  theme: "light" | "dark";
}

function ThemedButton({ 
  children, 
  theme,
  tva = ButtonCls,
  cls,
  ...props
}: ThemedButtonProps) {
  const buttonClasses = tva.create(cls, ({ override }) => ({
    variant: {
      size: "md",
      tone: "primary"
    },
    token: override.token({
      "color.bg": {
        primary: theme === "dark" ? ["bg-gray-800"] : ["bg-blue-600"]
      }
    })
  }));
  
  return (
    <button 
      className={buttonClasses.root()}
      {...props}
    >
      {children}
    </button>
  );
}
```

### **Context Integration**

The `useCls` hook automatically connects to `ClsProvider` context:

```tsx
// Parent component provides context
function App() {
  return (
    <ClsProvider value={ThemeCls}>
      <Button>I inherit from context!</Button>
    </ClsProvider>
  );
}

// Child component automatically gets context tokens
interface ButtonProps extends Component<typeof ButtonCls, React.ButtonHTMLAttributes<HTMLButtonElement>> {
  children: React.ReactNode;
}

function Button({ 
  children,
  tva = ButtonCls,
  cls,
  ...props
}: ButtonProps) {
  // useCls automatically merges context with component CLS
  const buttonClasses = useCls(tva, cls, ({ what }) => ({
    variant: what.variant({
      size: "md",
      tone: "primary"
    })
  }));
  
  return (
    <button 
      className={buttonClasses.root()}
      {...props}
    >
      {children}
    </button>
  );
}
```

## ‚ö° Performance Considerations

### **Performance Considerations**

CLS is object-heavy by design, which can impact performance in some scenarios:

```tsx
// Simple usage - no performance concerns
interface ButtonProps extends Component<typeof ButtonCls, React.ButtonHTMLAttributes<HTMLButtonElement>> {
  size: "sm" | "md" | "lg";
  tone: "primary" | "secondary";
  disabled: boolean;
}

function Button({ 
  size, 
  tone, 
  disabled,
  tva = ButtonCls,
  cls,
  ...props
}: ButtonProps) {
  const buttonClasses = tva.create(cls, () => ({
    variant: {
      size,
      tone,
      disabled
    }
  }));
  
  return (
    <button 
      className={buttonClasses.root()}
      {...props}
    >
      Click me
    </button>
  );
}
```

### **Performance Trade-offs**

- **‚úÖ Type Safety**: Full TypeScript support with IntelliSense
- **‚úÖ Developer Experience**: Excellent DX with predictable APIs
- **‚ùå Object Creation**: Creates objects on each render
- **‚ùå Memory Usage**: Higher memory footprint than string-based solutions

## üîÑ Context Token Merging

The `useCls` hook automatically merges context tokens with your component's tokens:

```tsx
// Context provides base tokens
const ThemeCls = cls({
  token: {
    "color.bg": {
      primary: ["bg-blue-600"],
      secondary: ["bg-gray-600"]
    }
  }
});

// Component overrides specific tokens
const ButtonCls = cls({
  token: {
    "color.bg": {
      primary: ["bg-green-600"], // Overrides context
      danger: ["bg-red-600"]     // New token
    }
  }
});

// useCls automatically merges them!
interface ButtonProps extends Component<typeof ButtonCls, React.ButtonHTMLAttributes<HTMLButtonElement>> {
  children: React.ReactNode;
}

function Button({ 
  children,
  tva = ButtonCls,
  cls,
  ...props
}: ButtonProps) {
  const classes = useCls(tva, cls);
  // Result: primary = green, secondary = gray (from context), danger = red
  
  return (
    <button 
      className={classes.root()}
      {...props}
    >
      {children}
    </button>
  );
}
```

## üéØ Best Practices

### **1. Keep Configs Simple**

```tsx
// ‚úÖ Good: Simple, focused config
const buttonClasses = tva.create(cls, () => ({
  variant: {
    size,
    tone
  }
}));

// ‚ùå Avoid: Complex logic in config
const buttonClasses = tva.create(cls, () => {
  const size = window.innerWidth < 768 ? "sm" : "md";
  const tone = isActive ? "primary" : "secondary";
  return {
    variant: {
      size,
      tone
    },
    token: complexTokenLogic()
  };
});
```

### **2. Use Type-Safe Variants**

```tsx
// ‚úÖ Good: Type-safe variant usage
const buttonClasses = useCls(ButtonCls, ({ what }) => ({
  variant: what.variant({ 
    size: "md",     // TypeScript ensures this is valid
    tone: "primary" // TypeScript ensures this is valid
  })
}));

// ‚ùå Avoid: Manual variant construction
const buttonClasses = useCls(ButtonCls, () => ({
  variant: { size: "md", tone: "primary" } // No type safety
}));
```

### **3. Leverage Context for Theming**

```tsx
// ‚úÖ Good: Use context for global theming
function Button({ children, tva = ButtonCls, cls, ...props }) {
  const buttonClasses = useCls(tva, cls, ({ what }) => ({
    variant: what.variant({
      size: "md",
      tone: "primary"
    })
  }));
  // Context tokens are automatically applied
  
  return (
    <button className={buttonClasses.root()} {...props}>
      {children}
    </button>
  );
}

// ‚ùå Avoid: Manual theme prop drilling
function Button({ children, theme, colors, spacing }) {
  // Don't pass everything as props
}
```

## üîç Common Patterns

### **Status-Based Styling**

```tsx
function StatusButton({ status, children }) {
  const buttonClasses = useCls(ButtonCls, ({ what }) => ({
    variant: what.variant({
      size: "md",
      tone: status === "success" ? "primary" : 
            status === "error" ? "danger" : "secondary"
    })
  }));
  
  return <button className={buttonClasses.root()}>{children}</button>;
}
```

### **Responsive Components**

```tsx
function ResponsiveCard({ children, size = "md" }) {
  const cardClasses = useCls(CardCls, ({ what }) => ({
    variant: what.variant({
      size,
      layout: "vertical"
    })
  }));
  
  return <div className={cardClasses.root()}>{children}</div>;
}
```

## üöÄ What's Next?

Now that you understand the `useCls` hook, you're ready to explore:

- **[4.2 `withCls` HOC](./4.2-withcls-hoc.md)**: Attach CLS instances directly to components
- **[4.3 Context Integration](./4.3-context-integration.md)**: Master React Context integration
- **[4.4 `Component` Patterns](./4.4-component-patterns.md)**: Advanced component patterns

The `useCls` hook is your gateway to type-safe, dynamic styling in React. Use it wisely, and your components will thank you! üéâ

---

**Previous:** [Chapter 3: Core API](../03-core-api/README.md) | **Next:** [4.2 `withCls` HOC](./4.2-withcls-hoc.md)
