# 3.1 `cls()` Function

## Table of Contents
- [3.1 `cls()` Function](./3.1-cls-function.md) *(current)*
- [3.2 `extend()` Method](./3.2-extend-method.md)
- [3.3 `contract()` Helper](./3.3-contract-helper.md)
- [3.4 `use()` Method](./3.4-use-method.md)
- [3.5 `merge()` Utility](./3.5-merge-utility.md)
- [3.6 `tvc()` Helper](./3.6-tvc-helper.md)
- [3.7 What Utility](./3.7-what-utility.md)
- [3.8 Definition Helpers](./3.8-definition-helpers.md)
- [3.9 Override Helpers](./3.9-override-helpers.md)
- [3.10 Override System Deep Dive](./3.10-override-system-deep-dive.md)

---

The `cls()` function is the **heart and soul** of CLS - it's the main function you'll use to create styling modules! Think of it as the "factory function" that takes your contract and definition, then gives you back a fully-featured CLS instance. Let's dive deep into how it works! üéØ

## Function Signature üìã

```typescript
function cls<
  const TTokenContract extends TokenContract,
  const TSlotContract extends SlotContract,
  const TVariantContract extends VariantContract,
  const TContract extends Contract<TTokenContract, TSlotContract, TVariantContract, any>
>(
  contract: TContract,
  definitionFn: (props: WhatUtil<TContract>) => Definition<TContract>
): Cls<TContract>
```

**Parameters:**
- `contract`: The contract defining your module's structure (tokens, slots, variants)
- `definitionFn`: A function that receives helper utilities and returns the definition

**Returns:** A fully-featured CLS instance with methods like `create()`, `extend()`, `use()`, etc.

## Basic Usage üöÄ

### Simple Button Example

```typescript
import { cls } from "@use-pico/cls";

const ButtonCls = cls({
  tokens: {
    "color.bg": ["default", "primary", "danger"],
    "color.text": ["default", "primary", "danger"]
  },
  slot: ["root", "label"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["default", "primary", "danger"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      default: ["bg-gray-100"],
      primary: ["bg-blue-600"],
      danger: ["bg-red-500"]
    },
    "color.text": {
      default: ["text-gray-900"],
      primary: ["text-white"],
      danger: ["text-white"]
    }
  }),
  rules: [
    def.root({
      root: what.both(["inline-flex", "items-center", "rounded"], ["color.bg.default", "color.text.default"]),
      label: what.css(["font-medium"])
    }),
    def.rule(
      what.variant({ tone: "primary" }),
      { root: what.token(["color.bg.primary", "color.text.primary"]) }
    ),
    def.rule(
      what.variant({ tone: "danger" }),
      { root: what.token(["color.bg.danger", "color.text.danger"]) }
    )
  ],
  defaults: def.defaults({
    size: "md",
    tone: "default"
  })
}));
```

## Contract Parameter üìã

The **first parameter** is your contract - it defines the structure of your module:

```typescript
import { cls, contract } from "@use-pico/cls";

const contract = contract({
  tokens: {
    "color.bg": ["default", "primary", "danger"],
    "color.text": ["default", "primary", "danger"],
    "spacing.padding": ["sm", "md", "lg"]
  },
  slot: ["root", "label", "icon"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["default", "primary", "danger"],
    disabled: ["bool"]
  }
});

const ButtonCls = cls(contract, definition);
```

### Contract Structure

- **`tokens`**: Named design values organized by category
- **`slot`**: Named parts of your module that receive styling
- **`variant`**: Configurable properties that affect appearance

## Definition Function üé®

The **second parameter** is a function that receives helper utilities and returns your definition:

```typescript
const ButtonCls = cls(contract, ({ what, def }) => {
  // 'what' provides type-safe helpers for styling
  // 'def' provides helpers for building definitions
  
  return {
    token: def.token({ /* token definitions */ }),
    rules: [ /* rule definitions */ ],
    defaults: def.defaults({ /* default variants */ })
  };
});
```

### Helper Utilities

- **`what`**: Type-safe helpers for styling (`what.css()`, `what.token()`, `what.variant()`, etc.)
- **`def`**: Definition builders (`def.token()`, `def.rule()`, `def.root()`, `def.defaults()`)

## Return Value üéÅ

The `cls()` function returns a **CLS instance** with these methods:

```typescript
const ButtonCls = cls(contract, definition);

// Core methods
ButtonCls.create(config) // Create class instances
ButtonCls.extend(contract, definition) // Extend with inheritance
ButtonCls.use(otherCls) // Use another CLS instance

// Utility methods
ButtonCls.cls(userConfig, internalConfig) // Create component props
ButtonCls.contract // Access the original contract
ButtonCls.definition // Access the original definition
```

## Type Safety üîí

CLS provides **full TypeScript support** with automatic type inference:

```typescript
const ButtonCls = cls({
  tokens: {
    "color.bg": ["default", "primary", "danger"]
  },
  slot: ["root", "label"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["default", "primary", "danger"]
  }
}, ({ what, def }) => ({
  // TypeScript knows exactly what tokens, slots, and variants are available
  token: def.token({
    "color.bg": {
      default: ["bg-gray-100"],
      primary: ["bg-blue-600"],
      danger: ["bg-red-500"]
    }
  }),
  rules: [
    def.rule(
      what.variant({ 
        size: "lg",     // ‚úÖ TypeScript knows this is valid
        tone: "primary" // ‚úÖ TypeScript knows this is valid
        // invalid: "value" // ‚ùå TypeScript error
      }),
      { root: what.token(["color.bg.primary"]) }
    )
  ]
}));
```

## Advanced Usage üåü

### With Pre-defined Contracts

```typescript
import { contract } from "@use-pico/cls";

const ButtonContract = contract({
  tokens: {
    "color.bg": ["default", "primary", "danger"],
    "color.text": ["default", "primary", "danger"]
  },
  slot: ["root", "label"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["default", "primary", "danger"]
  }
});

const ButtonCls = cls(ButtonContract, ({ what, def }) => ({
  // Implementation using the contract
}));
```

### Complex Module with Multiple Slots

```typescript
const CardCls = cls({
  tokens: {
    "color.bg": ["default", "primary", "secondary"],
    "color.border": ["default", "primary", "secondary"],
    "spacing.padding": ["sm", "md", "lg"],
    "spacing.margin": ["sm", "md", "lg"]
  },
  slot: ["root", "header", "body", "footer", "actions"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["default", "primary", "secondary"],
    elevated: ["bool"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      default: ["bg-white"],
      primary: ["bg-blue-50"],
      secondary: ["bg-gray-50"]
    },
    "color.border": {
      default: ["border-gray-200"],
      primary: ["border-blue-200"],
      secondary: ["border-gray-300"]
    },
    "spacing.padding": {
      sm: ["p-3"],
      md: ["p-4"],
      lg: ["p-6"]
    }
  }),
  rules: [
    def.root({
      root: what.both(
        ["rounded-lg", "border", "shadow-sm"],
        ["color.bg.default", "color.border.default", "spacing.padding.md"]
      ),
      header: what.css(["border-b", "border-gray-200", "p-4"]),
      body: what.css(["p-4"]),
      footer: what.css(["border-t", "border-gray-200", "p-4"]),
      actions: what.css(["flex", "justify-end", "gap-2", "p-4"])
    }),
    def.rule(
      what.variant({ tone: "primary" }),
      {
        root: what.token(["color.bg.primary", "color.border.primary"]),
        header: what.css(["border-blue-200"]),
        footer: what.css(["border-blue-200"])
      }
    ),
    def.rule(
      what.variant({ elevated: true }),
      { root: what.css(["shadow-lg"]) }
    )
  ],
  defaults: def.defaults({
    size: "md",
    tone: "default",
    elevated: false
  })
}));
```

## Error Handling üõ°Ô∏è

CLS provides **clear error messages** for common issues:

```typescript
// ‚ùå Missing required defaults
const ButtonCls = cls(contract, ({ what, def }) => ({
  // Error: "Missing defaults for variants: size, tone"
}));

// ‚ùå Invalid token reference
const ButtonCls = cls(contract, ({ what, def }) => ({
  rules: [
    def.rule(
      what.variant({ tone: "primary" }),
      { root: what.token(["color.bg.invalid"]) } // Error: "Token 'color.bg.invalid' not found in contract"
    )
  ]
}));

// ‚ùå Invalid variant value
const ButtonCls = cls(contract, ({ what, def }) => ({
  rules: [
    def.rule(
      what.variant({ size: "xl" }), // Error: "Variant 'size' value 'xl' not found in contract"
      { root: what.css(["text-xl"]) }
    )
  ]
}));
```

## Performance Considerations ‚ö°

The `cls()` function is **optimized for performance**:

```typescript
// ‚úÖ Good: Create CLS instance once, reuse it
const ButtonCls = cls(contract, definition);

// Use the same instance everywhere
const primaryButton = ButtonCls.create(({ what }) => ({
  variant: what.variant({ tone: "primary" })
}));

const dangerButton = ButtonCls.create(({ what }) => ({
  variant: what.variant({ tone: "danger" })
}));

// ‚ùå Bad: Don't recreate CLS instances
const getButtonClasses = (tone) => {
  const ButtonCls = cls(contract, definition); // Recreated every time!
  return ButtonCls.create(({ what }) => ({
    variant: what.variant({ tone })
  }));
};
```

## Best Practices üí°

### 1. **Use Descriptive Names**
```typescript
// ‚úÖ Good: Clear, descriptive names
const PrimaryButtonCls = cls(primaryButtonContract, primaryButtonDefinition);
const DangerButtonCls = cls(dangerButtonContract, dangerButtonDefinition);

// ‚ùå Bad: Generic names
const Button1 = cls(contract1, definition1);
const Button2 = cls(contract2, definition2);
```

### 2. **Keep Contracts Focused**
```typescript
// ‚úÖ Good: Focused, single-purpose contracts
const ButtonContract = contract({
  tokens: { "color.bg": ["primary", "danger"] },
  slot: ["root"],
  variant: { tone: ["primary", "danger"] }
});

// ‚ùå Bad: Overly complex contracts
const UniversalContract = contract({
  tokens: { /* everything */ },
  slot: ["root", "label", "icon", "badge", "loading", "error"],
  variant: { /* every possible variant */ }
});
```

### 3. **Leverage Type Inference**
```typescript
// ‚úÖ Good: Let TypeScript infer types
const ButtonCls = cls(contract, ({ what, def }) => ({
  // TypeScript knows the types from the contract
}));

// ‚ùå Bad: Don't add unnecessary type annotations
const ButtonCls = cls(contract, (props: WhatUtil<typeof contract>) => ({
  // Unnecessary type annotation
}));
```

## The Bottom Line üí°

The `cls()` function is your **primary tool** for creating CLS modules:

- **Simple API**: Just pass a contract and definition function
- **Type Safe**: Full TypeScript support with automatic inference
- **Performance Optimized**: Efficient creation and caching
- **Flexible**: Works with simple and complex modules
- **Error Resistant**: Clear error messages for common issues

Think of `cls()` as your **"module factory"** - it takes your specifications and gives you back a fully-featured styling module! üéâ

---

**Previous:** [Chapter 2: Design Philosophy](../02-design-philosophy/README.md) | **Next:** [3.2 `extend()` Method](./3.2-extend-method.md)
