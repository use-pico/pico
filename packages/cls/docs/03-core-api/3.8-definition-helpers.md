# 3.8 Definition Helpers

## Table of Contents
- [3.1 `cls()` Function](./3.1-cls-function.md)
- [3.2 `extend()` Method](./3.2-extend-method.md)
- [3.3 `contract()` Helper](./3.3-contract-helper.md)
- [3.4 `use()` Method](./3.4-use-method.md)
- [3.5 `merge()` Utility](./3.5-merge-utility.md)
- [3.6 `tvc()` Helper](./3.6-tvc-helper.md)
- [3.7 What Utility](./3.7-what-utility.md)
- [3.8 Definition Helpers](./3.8-definition-helpers.md) *(current)*
- [3.9 Override Helpers](./3.9-override-helpers.md)
- [3.10 Override System Deep Dive](./3.10-override-system-deep-dive.md)

---

The **Definition Helpers** are CLS's **building blocks** for creating definitions! Think of them as your "definition toolkit" - they provide type-safe, intuitive ways to build the different parts of your CLS definition. Let's explore all the `def` helpers! 🎯

## What are Definition Helpers? 🤔

The `def` helpers are passed to your definition function and provide type-safe builders for:

- **`def.token()`**: Define design token values
- **`def.root()`**: Define base styles for all slots
- **`def.rule()`**: Define conditional styling rules
- **`def.defaults()`**: Define default variant values

## def.token() - Design Token Definitions 🎨

### Basic Usage

```typescript
import { cls } from "@use-pico/cls";

const ButtonCls = cls({
  tokens: {
    "color.bg": ["default", "primary", "danger"],
    "color.text": ["default", "primary", "danger"],
    "spacing.padding": ["sm", "md", "lg"]
  },
  slot: ["root", "label"],
  variant: {
    size: ["sm", "md", "lg"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      default: ["bg-gray-100"],
      primary: ["bg-blue-600"],
      danger: ["bg-red-500"]
    },
    "color.text": {
      default: ["text-gray-900"],
      primary: ["text-white"],
      danger: ["text-white"]
    },
    "spacing.padding": {
      sm: ["px-2", "py-1"],
      md: ["px-4", "py-2"],
      lg: ["px-6", "py-3"]
    }
  }),
  rules: [
    def.root({
      root: what.token(["color.bg.default", "color.text.default", "spacing.padding.md"]),
      label: what.css(["font-medium"])
    })
  ],
  defaults: def.defaults({
    size: "md"
  })
}));
```

### Type-Safe Token Definitions

```typescript
// ✅ TypeScript validates token names and values
def.token({
  "color.bg": {
    default: ["bg-gray-100"],    // ✅ Valid token
    primary: ["bg-blue-600"],    // ✅ Valid token
    danger: ["bg-red-500"]       // ✅ Valid token
    // invalid: ["bg-yellow-500"] // ❌ TypeScript error - token doesn't exist
  },
  "color.text": {
    default: ["text-gray-900"],
    primary: ["text-white"],
    danger: ["text-white"]
  }
})
```

### Complex Token Values

```typescript
// ✅ Tokens can contain multiple classes
def.token({
  "color.bg": {
    default: ["bg-gray-100", "hover:bg-gray-200"],
    primary: ["bg-blue-600", "hover:bg-blue-700", "focus:ring-2", "focus:ring-blue-500"],
    danger: ["bg-red-500", "hover:bg-red-600", "focus:ring-2", "focus:ring-red-500"]
  },
  "spacing.padding": {
    sm: ["px-2", "py-1"],
    md: ["px-4", "py-2"],
    lg: ["px-6", "py-3", "text-lg"]
  }
})
```

## def.root() - Base Slot Styles 🎨

### Basic Usage

```typescript
import { cls } from "@use-pico/cls";

const CardCls = cls({
  tokens: {
    "color.bg": ["default", "primary", "secondary"],
    "spacing.padding": ["sm", "md", "lg"]
  },
  slot: ["root", "header", "body", "footer"],
  variant: {
    size: ["sm", "md", "lg"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      default: ["bg-white"],
      primary: ["bg-blue-50"],
      secondary: ["bg-gray-50"]
    },
    "spacing.padding": {
      sm: ["p-3"],
      md: ["p-4"],
      lg: ["p-6"]
    }
  }),
  rules: [
    def.root({
      root: what.both(
        ["rounded-lg", "border", "border-gray-200", "shadow-sm"],
        ["color.bg.default", "spacing.padding.md"]
      ),
      header: what.css(["border-b", "border-gray-200", "p-4"]),
      body: what.css(["p-4"]),
      footer: what.css(["border-t", "border-gray-200", "p-4"])
    })
  ],
  defaults: def.defaults({
    size: "md"
  })
}));
```

### Type-Safe Slot Definitions

```typescript
// ✅ TypeScript knows which slots are available
def.root({
  root: what.css(["rounded-lg", "border"]),     // ✅ Valid slot
  header: what.css(["border-b", "p-4"]),        // ✅ Valid slot
  body: what.css(["p-4"]),                      // ✅ Valid slot
  footer: what.css(["border-t", "p-4"]),        // ✅ Valid slot
  // invalid: what.css(["p-4"])                 // ❌ TypeScript error - slot doesn't exist
})
```

### Mixing CSS and Tokens

```typescript
// ✅ Combine CSS classes and token references
def.root({
  root: what.both(
    // CSS classes
    ["rounded-lg", "border", "shadow-sm"],
    // Token references
    ["color.bg.default", "spacing.padding.md"]
  ),
  header: what.both(
    ["border-b", "border-gray-200"],
    ["spacing.padding.md"]
  ),
  body: what.token(["spacing.padding.md"]),
  footer: what.both(
    ["border-t", "border-gray-200"],
    ["spacing.padding.md"]
  )
})
```

## def.rule() - Conditional Styling Rules 🎛️

### Basic Usage

```typescript
import { cls } from "@use-pico/cls";

const ButtonCls = cls({
  tokens: {
    "color.bg": ["default", "primary", "danger"],
    "color.text": ["default", "primary", "danger"]
  },
  slot: ["root", "label"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["default", "primary", "danger"],
    disabled: ["bool"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      default: ["bg-gray-100"],
      primary: ["bg-blue-600"],
      danger: ["bg-red-500"]
    },
    "color.text": {
      default: ["text-gray-900"],
      primary: ["text-white"],
      danger: ["text-white"]
    }
  }),
  rules: [
    def.root({
      root: what.both(
        ["inline-flex", "items-center", "rounded", "font-medium"],
        ["color.bg.default", "color.text.default"]
      ),
      label: what.css(["font-medium"])
    }),
    // Variant-based rules
    def.rule(
      what.variant({ tone: "primary" }),
      { 
        root: what.token(["color.bg.primary", "color.text.primary"]),
        label: what.css(["font-semibold"])
      }
    ),
    def.rule(
      what.variant({ tone: "danger" }),
      { 
        root: what.token(["color.bg.danger", "color.text.danger"]),
        label: what.css(["font-semibold"])
      }
    ),
    // Size-based rules
    def.rule(
      what.variant({ size: "sm" }),
      { root: what.css(["px-2", "py-1", "text-sm"]) }
    ),
    def.rule(
      what.variant({ size: "lg" }),
      { root: what.css(["px-6", "py-3", "text-lg"]) }
    ),
    // State-based rules
    def.rule(
      what.variant({ disabled: true }),
      { 
        root: what.css(["opacity-50", "cursor-not-allowed"]),
        label: what.css(["text-gray-500"])
      }
    )
  ],
  defaults: def.defaults({
    size: "md",
    tone: "default",
    disabled: false
  })
}));
```

### Complex Rule Combinations

```typescript
// ✅ Multiple variants in one rule
def.rule(
  what.variant({ 
    size: "lg", 
    tone: "primary", 
    disabled: true 
  }),
  { 
    root: what.both(
      what.token(["color.bg.primary", "color.text.primary"]),
      what.css(["px-6", "py-3", "text-lg", "opacity-50", "cursor-not-allowed"])
    ),
    label: what.css(["font-semibold", "text-gray-500"])
  }
)

// ✅ Partial variant combinations
def.rule(
  what.variant({ size: "lg", tone: "primary" }),
  { 
    root: what.both(
      what.token(["color.bg.primary", "color.text.primary"]),
      what.css(["px-6", "py-3", "text-lg"])
    )
  }
)
```

### Type-Safe Rule Definitions

```typescript
// ✅ TypeScript validates variant combinations
def.rule(
  what.variant({ 
    size: "lg",        // ✅ Valid size value
    tone: "primary",   // ✅ Valid tone value
    disabled: true     // ✅ Valid boolean value
    // size: "xl",     // ❌ TypeScript error - invalid size
    // tone: "invalid" // ❌ TypeScript error - invalid tone
  }),
  { 
    root: what.token([
      "color.bg.primary",  // ✅ TypeScript knows this token exists
      "color.text.primary" // ✅ TypeScript knows this token exists
      // "color.bg.invalid" // ❌ TypeScript error - token doesn't exist
    ])
  }
)
```

## def.defaults() - Default Variant Values 🎯

### Basic Usage

```typescript
import { cls } from "@use-pico/cls";

const ButtonCls = cls({
  tokens: {
    "color.bg": ["default", "primary", "danger"]
  },
  slot: ["root"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["default", "primary", "danger"],
    disabled: ["bool"],
    loading: ["bool"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      default: ["bg-gray-100"],
      primary: ["bg-blue-600"],
      danger: ["bg-red-500"]
    }
  }),
  rules: [
    def.root({
      root: what.token(["color.bg.default"])
    })
  ],
  defaults: def.defaults({
    size: "md",      // Default size
    tone: "default", // Default tone
    disabled: false, // Default disabled state
    loading: false   // Default loading state
  })
}));
```

### Type-Safe Default Values

```typescript
// ✅ TypeScript validates default values
def.defaults({
  size: "md",        // ✅ Valid size value
  tone: "default",   // ✅ Valid tone value
  disabled: false,   // ✅ Valid boolean value
  loading: false     // ✅ Valid boolean value
  // size: "xl",     // ❌ TypeScript error - invalid size
  // tone: "invalid" // ❌ TypeScript error - invalid tone
})
```

### Required Defaults

```typescript
// ✅ All variants must have defaults
def.defaults({
  size: "md",      // Required for size variant
  tone: "default", // Required for tone variant
  disabled: false, // Required for disabled variant
  loading: false   // Required for loading variant
  // Missing any variant will cause TypeScript error
})
```

## Advanced Definition Patterns 🌟

### Complex Module with Multiple Slots

```typescript
import { cls } from "@use-pico/cls";

const ModalCls = cls({
  tokens: {
    "color.bg": ["default", "primary"],
    "color.border": ["default", "primary"],
    "spacing.padding": ["sm", "md", "lg"],
    "spacing.margin": ["sm", "md", "lg"]
  },
  slot: ["overlay", "content", "header", "body", "footer", "closeButton"],
  variant: {
    size: ["sm", "md", "lg"],
    tone: ["default", "primary"],
    fullscreen: ["bool"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      default: ["bg-white"],
      primary: ["bg-blue-50"]
    },
    "color.border": {
      default: ["border-gray-200"],
      primary: ["border-blue-200"]
    },
    "spacing.padding": {
      sm: ["p-3"],
      md: ["p-4"],
      lg: ["p-6"]
    },
    "spacing.margin": {
      sm: ["m-2"],
      md: ["m-4"],
      lg: ["m-6"]
    }
  }),
  rules: [
    def.root({
      overlay: what.css(["fixed", "inset-0", "bg-black", "bg-opacity-50", "flex", "items-center", "justify-center"]),
      content: what.both(
        ["bg-white", "rounded-lg", "shadow-xl", "max-w-md", "w-full"],
        ["color.border.default", "spacing.padding.md", "spacing.margin.md"]
      ),
      header: what.css(["flex", "items-center", "justify-between", "border-b", "border-gray-200", "pb-3"]),
      body: what.css(["py-4"]),
      footer: what.css(["flex", "justify-end", "gap-2", "border-t", "border-gray-200", "pt-3"]),
      closeButton: what.css(["p-1", "rounded", "hover:bg-gray-100"])
    }),
    def.rule(
      what.variant({ tone: "primary" }),
      {
        content: what.token(["color.bg.primary", "color.border.primary"]),
        header: what.css(["border-blue-200"]),
        footer: what.css(["border-blue-200"])
      }
    ),
    def.rule(
      what.variant({ size: "lg" }),
      {
        content: what.token(["spacing.padding.lg", "spacing.margin.lg"]),
        header: what.css(["pb-4"]),
        body: what.css(["py-6"]),
        footer: what.css(["pt-4"])
      }
    ),
    def.rule(
      what.variant({ fullscreen: true }),
      {
        overlay: what.css(["bg-opacity-75"]),
        content: what.css(["max-w-none", "w-full", "h-full", "rounded-none", "m-0"])
      }
    )
  ],
  defaults: def.defaults({
    size: "md",
    tone: "default",
    fullscreen: false
  })
}));
```

### Conditional Token Definitions

```typescript
// ✅ Dynamic token definitions based on conditions
const getTokenDefinitions = (theme: "light" | "dark") => {
  if (theme === "light") {
    return def.token({
      "color.bg": {
        default: ["bg-white"],
        primary: ["bg-blue-600"],
        danger: ["bg-red-500"]
      },
      "color.text": {
        default: ["text-gray-900"],
        primary: ["text-white"],
        danger: ["text-white"]
      }
    });
  } else {
    return def.token({
      "color.bg": {
        default: ["bg-gray-800"],
        primary: ["bg-blue-700"],
        danger: ["bg-red-700"]
      },
      "color.text": {
        default: ["text-gray-100"],
        primary: ["text-white"],
        danger: ["text-white"]
      }
    });
  }
};

const ButtonCls = cls(buttonContract, ({ what, def }) => ({
  token: getTokenDefinitions("light"), // or "dark"
  rules: [
    def.root({
      root: what.token(["color.bg.default", "color.text.default"])
    })
  ],
  defaults: def.defaults({
    size: "md",
    tone: "default"
  })
}));
```

## Best Practices 💡

### 1. **Use def.token() for Semantic Values**
```typescript
// ✅ Good: Use tokens for semantic design values
def.token({
  "color.bg": {
    default: ["bg-gray-100"],
    primary: ["bg-blue-600"],
    danger: ["bg-red-500"]
  }
})

// ❌ Bad: Don't use tokens for utility classes
def.token({
  "layout": {
    flex: ["flex", "items-center"],
    grid: ["grid", "grid-cols-2"]
  }
})
```

### 2. **Keep Rules Focused**
```typescript
// ✅ Good: Focused, single-purpose rules
def.rule(
  what.variant({ tone: "primary" }),
  { root: what.token(["color.bg.primary", "color.text.primary"]) }
)

def.rule(
  what.variant({ size: "lg" }),
  { root: what.css(["px-6", "py-3", "text-lg"]) }
)

// ❌ Bad: Overly complex rules
def.rule(
  what.variant({ tone: "primary", size: "lg", disabled: true }),
  { root: what.css(["many", "different", "styles", "mixed", "together"]) }
)
```

### 3. **Use def.defaults() for All Variants**
```typescript
// ✅ Good: All variants have defaults
def.defaults({
  size: "md",
  tone: "default",
  disabled: false
})

// ❌ Bad: Missing defaults will cause TypeScript errors
def.defaults({
  size: "md"
  // Missing: tone, disabled
})
```

### 4. **Leverage Type Safety**
```typescript
// ✅ Good: Let TypeScript guide you
def.token({
  "color.bg": {
    // TypeScript will show available token values
    default: ["bg-gray-100"],
    primary: ["bg-blue-600"]
  }
})

def.rule(
  what.variant({ 
    // TypeScript will show available variant values
    size: "lg",
    tone: "primary"
  }),
  { 
    root: what.token([
      // TypeScript will show available tokens
      "color.bg.primary"
    ])
  }
)
```

## The Bottom Line 💡

The Definition Helpers are CLS's **building blocks**:

- **`def.token()`**: Define semantic design token values
- **`def.root()`**: Define base styles for all slots
- **`def.rule()`**: Define conditional styling rules
- **`def.defaults()`**: Define default variant values
- **Type safe**: Full TypeScript validation and IntelliSense
- **Intuitive**: Clear, purpose-built helpers for different definition needs

Think of the Definition Helpers as your **"definition construction kit"** - they provide the right tool for every part of your CLS definition! 🎉

---

**Previous:** [3.7 What Utility](./3.7-what-utility.md) | **Next:** [3.9 Override Helpers](./3.9-override-helpers.md)
