# 5.3 Inheritance

## Table of Contents
- [5.1 Contract Declaration](./5.1-contract-declaration.md)
- [5.2 Token Definition](./5.2-token-definition.md)
- [5.3 Inheritance](./5.3-inheritance.md) *(current)*
- [5.4 Runtime Overrides](./5.4-runtime-overrides.md)

---

Token inheritance is one of CLS's **most powerful features**. It allows you to build complex design systems by extending and overriding tokens from parent contracts. This chapter explores how token inheritance works, when to use it, and how to build scalable token hierarchies.

## **What is Token Inheritance?** ğŸ¤”

Token inheritance allows child contracts to **inherit all tokens** from their parent contracts while adding new tokens or overriding existing ones. This creates a **hierarchical design system** where:

- **Base tokens** provide foundational design values
- **Component tokens** extend and specialize base tokens
- **Theme tokens** override tokens for different contexts

### **The Inheritance Chain** ğŸ”—

```typescript
// Base design system tokens
const BaseTokens = cls({
  token: {
    "color.bg": ["primary", "secondary", "surface"],
    "color.text": ["primary", "secondary", "muted"],
    "spacing.p": ["sm", "md", "lg"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      primary: ["bg-blue-600"],
      secondary: ["bg-gray-600"],
      surface: ["bg-white"]
    },
    "color.text": {
      primary: ["text-gray-900"],
      secondary: ["text-gray-600"],
      muted: ["text-gray-500"]
    },
    "spacing.p": {
      sm: ["p-2"],
      md: ["p-4"],
      lg: ["p-6"]
    }
  })
}));

// Button extends base tokens
const ButtonTokens = BaseTokens.extend({
  token: {
    "button.variant": ["primary", "secondary", "outline"],
    "button.size": ["sm", "md", "lg"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.variant": {
      primary: ["bg-blue-600", "text-white"],
      secondary: ["bg-gray-600", "text-white"],
      outline: ["border", "border-gray-300", "text-gray-700"]
    },
    "button.size": {
      sm: ["px-3", "py-1.5", "text-sm"],
      md: ["px-4", "py-2", "text-base"],
      lg: ["px-6", "py-3", "text-lg"]
    }
  })
}));
```

## **How Token Inheritance Works** âš™ï¸

### **1. Automatic Token Merging** ğŸ”„

When you extend a contract, CLS automatically **merges all tokens** from the inheritance chain:

```typescript
// Parent tokens are automatically available
const ExtendedTokens = BaseTokens.extend({
  token: {
    "new.token": ["value1", "value2"]  // New tokens
  }
}, ({ what, def }) => ({
  token: def.token({
    "new.token": {
      value1: ["new-class-1"],
      value2: ["new-class-2"]
    }
    // Parent tokens are inherited automatically!
  })
}));

// All tokens are available:
// - Inherited: "color.bg", "color.text", "spacing.p"
// - New: "new.token"
```

### **2. Token Override Behavior** ğŸ¯

Child contracts can **override** parent tokens with different values:

```typescript
const OverrideTokens = BaseTokens.extend({
  token: {
    "color.bg": ["primary", "secondary", "surface", "accent"]  // Override + extend
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      primary: ["bg-purple-600"],      // Override parent value
      secondary: ["bg-gray-600"],      // Keep parent value
      surface: ["bg-gray-50"],         // Override parent value
      accent: ["bg-yellow-500"]        // New value
    }
  })
}));
```

### **3. Multi-Level Inheritance** ğŸ—ï¸

You can build **deep inheritance chains** for complex design systems:

```typescript
// Level 1: Foundation tokens
const FoundationTokens = cls({
  token: {
    "color.bg": ["primary", "secondary"],
    "spacing.p": ["sm", "md", "lg"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      primary: ["bg-blue-600"],
      secondary: ["bg-gray-600"]
    },
    "spacing.p": {
      sm: ["p-2"],
      md: ["p-4"],
      lg: ["p-6"]
    }
  })
}));

// Level 2: Component tokens
const ComponentTokens = FoundationTokens.extend({
  token: {
    "component.variant": ["default", "primary", "secondary"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "component.variant": {
      default: ["bg-white", "text-gray-900"],
      primary: ["bg-blue-600", "text-white"],
      secondary: ["bg-gray-600", "text-white"]
    }
  })
}));

// Level 3: Theme tokens
const ThemeTokens = ComponentTokens.extend({
  token: {
    "theme.mode": ["light", "dark"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "theme.mode": {
      light: ["bg-white", "text-gray-900"],
      dark: ["bg-gray-900", "text-gray-100"]
    }
  })
}));
```

## **Token Inheritance Patterns** ğŸ¨

### **1. Foundation â†’ Component Pattern** ğŸ§±

Build reusable components on top of foundation tokens:

```typescript
// Foundation design system
const DesignSystem = cls({
  token: {
    "color.bg": ["primary", "secondary", "surface"],
    "color.text": ["primary", "secondary", "muted"],
    "spacing.p": ["xs", "sm", "md", "lg", "xl"],
    "typography.size": ["xs", "sm", "base", "lg", "xl"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      primary: ["bg-blue-600"],
      secondary: ["bg-gray-600"],
      surface: ["bg-white"]
    },
    "color.text": {
      primary: ["text-gray-900"],
      secondary: ["text-gray-600"],
      muted: ["text-gray-500"]
    },
    "spacing.p": {
      xs: ["p-1"],
      sm: ["p-2"],
      md: ["p-4"],
      lg: ["p-6"],
      xl: ["p-8"]
    },
    "typography.size": {
      xs: ["text-xs"],
      sm: ["text-sm"],
      base: ["text-base"],
      lg: ["text-lg"],
      xl: ["text-xl"]
    }
  })
}));

// Button component inherits foundation
const ButtonTokens = DesignSystem.extend({
  token: {
    "button.variant": ["primary", "secondary", "outline", "ghost"],
    "button.size": ["sm", "md", "lg"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.variant": {
      primary: ["bg-blue-600", "text-white", "hover:bg-blue-700"],
      secondary: ["bg-gray-600", "text-white", "hover:bg-gray-700"],
      outline: ["border", "border-gray-300", "text-gray-700", "hover:bg-gray-50"],
      ghost: ["text-gray-700", "hover:bg-gray-100"]
    },
    "button.size": {
      sm: ["px-3", "py-1.5", "text-sm"],
      md: ["px-4", "py-2", "text-base"],
      lg: ["px-6", "py-3", "text-lg"]
    }
  })
}));
```

### **2. Theme â†’ Component Pattern** ğŸŒˆ

Create themed components that inherit from theme tokens:

```typescript
// Light theme tokens
const LightTheme = cls({
  token: {
    "theme.color.bg": ["surface", "surfaceSecondary", "overlay"],
    "theme.color.text": ["primary", "secondary", "muted"],
    "theme.color.border": ["default", "focus", "error"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "theme.color.bg": {
      surface: ["bg-white"],
      surfaceSecondary: ["bg-gray-50"],
      overlay: ["bg-black", "bg-opacity-50"]
    },
    "theme.color.text": {
      primary: ["text-gray-900"],
      secondary: ["text-gray-600"],
      muted: ["text-gray-500"]
    },
    "theme.color.border": {
      default: ["border-gray-300"],
      focus: ["border-blue-500"],
      error: ["border-red-500"]
    }
  })
}));

// Dark theme tokens
const DarkTheme = cls({
  token: {
    "theme.color.bg": ["surface", "surfaceSecondary", "overlay"],
    "theme.color.text": ["primary", "secondary", "muted"],
    "theme.color.border": ["default", "focus", "error"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "theme.color.bg": {
      surface: ["bg-gray-900"],
      surfaceSecondary: ["bg-gray-800"],
      overlay: ["bg-black", "bg-opacity-75"]
    },
    "theme.color.text": {
      primary: ["text-gray-100"],
      secondary: ["text-gray-400"],
      muted: ["text-gray-500"]
    },
    "theme.color.border": {
      default: ["border-gray-700"],
      focus: ["border-blue-400"],
      error: ["border-red-400"]
    }
  })
}));

// Component inherits from theme
const ThemedButton = LightTheme.extend({
  token: {
    "button.variant": ["primary", "secondary", "outline"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.variant": {
      primary: ["bg-blue-600", "text-white", "hover:bg-blue-700"],
      secondary: ["bg-gray-600", "text-white", "hover:bg-gray-700"],
      outline: ["border", "border-gray-300", "text-gray-700", "hover:bg-gray-50"]
    }
  })
}));
```

### **3. Component â†’ Variant Pattern** ğŸ­

Create specialized variants that inherit from base components:

```typescript
// Base button tokens
const BaseButton = cls({
  token: {
    "button.size": ["sm", "md", "lg"],
    "button.radius": ["sm", "md", "lg"],
    "button.shadow": ["none", "sm", "md"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.size": {
      sm: ["px-3", "py-1.5", "text-sm"],
      md: ["px-4", "py-2", "text-base"],
      lg: ["px-6", "py-3", "text-lg"]
    },
    "button.radius": {
      sm: ["rounded"],
      md: ["rounded-md"],
      lg: ["rounded-lg"]
    },
    "button.shadow": {
      none: ["shadow-none"],
      sm: ["shadow-sm"],
      md: ["shadow"]
    }
  })
}));

// Primary button variant
const PrimaryButton = BaseButton.extend({
  token: {
    "button.color": ["default", "hover", "active", "disabled"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.color": {
      default: ["bg-blue-600", "text-white"],
      hover: ["hover:bg-blue-700"],
      active: ["active:bg-blue-800"],
      disabled: ["opacity-50", "cursor-not-allowed"]
    }
  })
}));

// Secondary button variant
const SecondaryButton = BaseButton.extend({
  token: {
    "button.color": ["default", "hover", "active", "disabled"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.color": {
      default: ["bg-gray-600", "text-white"],
      hover: ["hover:bg-gray-700"],
      active: ["active:bg-gray-800"],
      disabled: ["opacity-50", "cursor-not-allowed"]
    }
  })
}));
```

## **Token Inheritance Best Practices** ğŸ’¡

### **1. Use Semantic Token Names** ğŸ·ï¸

Create meaningful token hierarchies that reflect your design system:

```typescript
// âœ… Good: Semantic hierarchy
const GoodTokens = cls({
  token: {
    "color.bg": ["primary", "secondary", "surface"],
    "color.text": ["primary", "secondary", "muted"],
    "spacing.p": ["xs", "sm", "md", "lg", "xl"]
  }
});

// âŒ Avoid: Non-semantic hierarchy
const BadTokens = cls({
  token: {
    "bg": ["blue", "gray", "white"],
    "text": ["black", "gray", "lightgray"],
    "p": ["1", "2", "4", "6", "8"]
  }
});
```

### **2. Keep Inheritance Shallow** ğŸ“

Avoid deep inheritance chains that become hard to understand:

```typescript
// âœ… Good: Shallow inheritance
const BaseTokens = cls({ /* foundation */ });
const ComponentTokens = BaseTokens.extend({ /* component */ });

// âŒ Avoid: Deep inheritance
const Level1 = cls({ /* foundation */ });
const Level2 = Level1.extend({ /* intermediate */ });
const Level3 = Level2.extend({ /* intermediate */ });
const Level4 = Level3.extend({ /* intermediate */ });
const Level5 = Level4.extend({ /* component */ });
```

### **3. Override Strategically** ğŸ¯

Only override tokens when you need different behavior:

```typescript
// âœ… Good: Strategic overrides
const ThemedButton = BaseButton.extend({
  token: {
    "button.color": ["primary", "secondary"]  // Override for theme
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.color": {
      primary: ["bg-purple-600"],  // Different theme color
      secondary: ["bg-gray-600"]   // Keep same behavior
    }
  })
}));

// âŒ Avoid: Unnecessary overrides
const UnnecessaryButton = BaseButton.extend({
  token: {
    "button.size": ["sm", "md", "lg"]  // Same as parent
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.size": {
      sm: ["px-3", "py-1.5", "text-sm"],  // Same as parent
      md: ["px-4", "py-2", "text-base"],  // Same as parent
      lg: ["px-6", "py-3", "text-lg"]     // Same as parent
    }
  })
}));
```

### **4. Document Token Dependencies** ğŸ“š

Make inheritance relationships clear in your code:

```typescript
// Document the inheritance chain
const BaseTokens = cls({
  token: {
    "color.bg": ["primary", "secondary"],
    "spacing.p": ["sm", "md", "lg"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      primary: ["bg-blue-600"],
      secondary: ["bg-gray-600"]
    },
    "spacing.p": {
      sm: ["p-2"],
      md: ["p-4"],
      lg: ["p-6"]
    }
  })
}));

/**
 * Button tokens that inherit from BaseTokens
 * 
 * Inherited tokens:
 * - color.bg.primary â†’ bg-blue-600
 * - color.bg.secondary â†’ bg-gray-600
 * - spacing.p.sm â†’ p-2
 * - spacing.p.md â†’ p-4
 * - spacing.p.lg â†’ p-6
 * 
 * New tokens:
 * - button.variant.primary
 * - button.variant.secondary
 * - button.size.sm
 * - button.size.md
 * - button.size.lg
 */
const ButtonTokens = BaseTokens.extend({
  token: {
    "button.variant": ["primary", "secondary"],
    "button.size": ["sm", "md", "lg"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.variant": {
      primary: ["bg-blue-600", "text-white"],
      secondary: ["bg-gray-600", "text-white"]
    },
    "button.size": {
      sm: ["px-3", "py-1.5", "text-sm"],
      md: ["px-4", "py-2", "text-base"],
      lg: ["px-6", "py-3", "text-lg"]
    }
  })
}));
```

## **Common Token Inheritance Patterns** ğŸ”„

### **1. Design System Foundation** ğŸ—ï¸

```typescript
// Foundation tokens for entire design system
const DesignSystem = cls({
  token: {
    "color.bg": ["primary", "secondary", "surface", "overlay"],
    "color.text": ["primary", "secondary", "muted", "inverse"],
    "color.border": ["default", "focus", "error", "success"],
    "spacing.p": ["xs", "sm", "md", "lg", "xl", "2xl"],
    "spacing.m": ["xs", "sm", "md", "lg", "xl", "2xl"],
    "typography.size": ["xs", "sm", "base", "lg", "xl", "2xl", "3xl"],
    "typography.weight": ["normal", "medium", "semibold", "bold"],
    "layout.radius": ["none", "sm", "md", "lg", "xl", "full"],
    "layout.shadow": ["none", "sm", "md", "lg", "xl", "2xl"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      primary: ["bg-blue-600"],
      secondary: ["bg-gray-600"],
      surface: ["bg-white"],
      overlay: ["bg-black", "bg-opacity-50"]
    },
    "color.text": {
      primary: ["text-gray-900"],
      secondary: ["text-gray-600"],
      muted: ["text-gray-500"],
      inverse: ["text-white"]
    },
    "color.border": {
      default: ["border-gray-300"],
      focus: ["border-blue-500"],
      error: ["border-red-500"],
      success: ["border-green-500"]
    },
    "spacing.p": {
      xs: ["p-1"],
      sm: ["p-2"],
      md: ["p-4"],
      lg: ["p-6"],
      xl: ["p-8"],
      "2xl": ["p-12"]
    },
    "spacing.m": {
      xs: ["m-1"],
      sm: ["m-2"],
      md: ["m-4"],
      lg: ["m-6"],
      xl: ["m-8"],
      "2xl": ["m-12"]
    },
    "typography.size": {
      xs: ["text-xs"],
      sm: ["text-sm"],
      base: ["text-base"],
      lg: ["text-lg"],
      xl: ["text-xl"],
      "2xl": ["text-2xl"],
      "3xl": ["text-3xl"]
    },
    "typography.weight": {
      normal: ["font-normal"],
      medium: ["font-medium"],
      semibold: ["font-semibold"],
      bold: ["font-bold"]
    },
    "layout.radius": {
      none: ["rounded-none"],
      sm: ["rounded"],
      md: ["rounded-md"],
      lg: ["rounded-lg"],
      xl: ["rounded-xl"],
      full: ["rounded-full"]
    },
    "layout.shadow": {
      none: ["shadow-none"],
      sm: ["shadow-sm"],
      md: ["shadow"],
      lg: ["shadow-lg"],
      xl: ["shadow-xl"],
      "2xl": ["shadow-2xl"]
    }
  })
}));
```

### **2. Component Library** ğŸ“š

```typescript
// Button component inherits from design system
const ButtonTokens = DesignSystem.extend({
  token: {
    "button.variant": ["primary", "secondary", "outline", "ghost", "danger"],
    "button.size": ["xs", "sm", "md", "lg", "xl"],
    "button.state": ["default", "hover", "active", "disabled", "loading"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "button.variant": {
      primary: ["bg-blue-600", "text-white"],
      secondary: ["bg-gray-600", "text-white"],
      outline: ["border", "border-gray-300", "text-gray-700"],
      ghost: ["text-gray-700"],
      danger: ["bg-red-600", "text-white"]
    },
    "button.size": {
      xs: ["px-2", "py-1", "text-xs"],
      sm: ["px-3", "py-1.5", "text-sm"],
      md: ["px-4", "py-2", "text-base"],
      lg: ["px-6", "py-3", "text-lg"],
      xl: ["px-8", "py-4", "text-xl"]
    },
    "button.state": {
      default: [""],
      hover: ["hover:bg-blue-700"],
      active: ["active:bg-blue-800"],
      disabled: ["opacity-50", "cursor-not-allowed"],
      loading: ["opacity-75", "cursor-wait"]
    }
  })
}));
```

### **3. Theme System** ğŸŒˆ

```typescript
// Light theme inherits from design system
const LightTheme = DesignSystem.extend({
  token: {
    "theme.color.bg": ["surface", "surfaceSecondary", "surfaceTertiary"],
    "theme.color.text": ["primary", "secondary", "muted", "inverse"],
    "theme.color.border": ["default", "focus", "error", "success"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "theme.color.bg": {
      surface: ["bg-white"],
      surfaceSecondary: ["bg-gray-50"],
      surfaceTertiary: ["bg-gray-100"]
    },
    "theme.color.text": {
      primary: ["text-gray-900"],
      secondary: ["text-gray-600"],
      muted: ["text-gray-500"],
      inverse: ["text-white"]
    },
    "theme.color.border": {
      default: ["border-gray-300"],
      focus: ["border-blue-500"],
      error: ["border-red-500"],
      success: ["border-green-500"]
    }
  })
}));

// Dark theme overrides light theme
const DarkTheme = LightTheme.extend({
  token: {
    "theme.color.bg": ["surface", "surfaceSecondary", "surfaceTertiary"],
    "theme.color.text": ["primary", "secondary", "muted", "inverse"],
    "theme.color.border": ["default", "focus", "error", "success"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "theme.color.bg": {
      surface: ["bg-gray-900"],
      surfaceSecondary: ["bg-gray-800"],
      surfaceTertiary: ["bg-gray-700"]
    },
    "theme.color.text": {
      primary: ["text-gray-100"],
      secondary: ["text-gray-400"],
      muted: ["text-gray-500"],
      inverse: ["text-gray-900"]
    },
    "theme.color.border": {
      default: ["border-gray-700"],
      focus: ["border-blue-400"],
      error: ["border-red-400"],
      success: ["border-green-400"]
    }
  })
}));
```

## **Token Inheritance Benefits** âœ¨

### **1. Consistency** ğŸ¯

Inherited tokens ensure consistent design values across your system:

```typescript
// All components use the same color tokens
const ButtonTokens = DesignSystem.extend({ /* button tokens */ });
const CardTokens = DesignSystem.extend({ /* card tokens */ });
const InputTokens = DesignSystem.extend({ /* input tokens */ });

// All use the same "color.bg.primary" â†’ "bg-blue-600"
```

### **2. Maintainability** ğŸ”§

Change design values in one place, update everywhere:

```typescript
// Update primary color in design system
const UpdatedDesignSystem = cls({
  token: {
    "color.bg": ["primary", "secondary"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      primary: ["bg-purple-600"],  // Changed from blue to purple
      secondary: ["bg-gray-600"]
    }
  })
}));

// All inherited components automatically get the new color
const ButtonTokens = UpdatedDesignSystem.extend({ /* button tokens */ });
const CardTokens = UpdatedDesignSystem.extend({ /* card tokens */ });
```

### **3. Scalability** ğŸ“ˆ

Build complex systems from simple foundations:

```typescript
// Simple foundation
const Foundation = cls({
  token: {
    "color.bg": ["primary", "secondary"],
    "spacing.p": ["sm", "md", "lg"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "color.bg": {
      primary: ["bg-blue-600"],
      secondary: ["bg-gray-600"]
    },
    "spacing.p": {
      sm: ["p-2"],
      md: ["p-4"],
      lg: ["p-6"]
    }
  })
}));

// Complex component library
const ComponentLibrary = Foundation
  .extend({ /* button tokens */ })
  .extend({ /* card tokens */ })
  .extend({ /* input tokens */ })
  .extend({ /* modal tokens */ })
  .extend({ /* navigation tokens */ });
```

### **4. Type Safety** ğŸ›¡ï¸

TypeScript ensures all inherited tokens are properly typed:

```typescript
// TypeScript knows about all inherited tokens
const ExtendedTokens = BaseTokens.extend({
  token: {
    "new.token": ["value1", "value2"]
  }
}, ({ what, def }) => ({
  token: def.token({
    "new.token": {
      value1: ["new-class-1"],
      value2: ["new-class-2"]
    }
  })
}));

// TypeScript provides autocomplete for:
// - Inherited tokens: "color.bg.primary", "spacing.p.md"
// - New tokens: "new.token.value1", "new.token.value2"
```

## **When to Use Token Inheritance** ğŸ¤”

### **âœ… Use Inheritance When:**

- **Building design systems** with shared design values
- **Creating component libraries** with consistent styling
- **Implementing theme systems** with different color schemes
- **Managing complex applications** with multiple styling contexts
- **Ensuring consistency** across large codebases

### **âŒ Avoid Inheritance When:**

- **Simple components** with no shared design values
- **One-off styling** that won't be reused
- **Prototypes** where consistency isn't important
- **Small applications** where complexity isn't needed

## **Token Inheritance Best Practices Summary** ğŸ“‹

1. **Use semantic token names** that reflect your design system
2. **Keep inheritance shallow** to avoid complexity
3. **Override strategically** only when needed
4. **Document token dependencies** clearly
5. **Build from foundation** to component to theme
6. **Ensure type safety** with proper TypeScript usage
7. **Test inheritance chains** to verify behavior
8. **Consider performance** with large inheritance chains

Token inheritance is the **foundation of scalable design systems**. Use it wisely to build consistent, maintainable, and powerful styling systems! ğŸš€

---

**[â† Previous: Token Definition](./5.2-token-definition.md)** | **[â†’ Next: Runtime Overrides](./5.4-runtime-overrides.md)**
