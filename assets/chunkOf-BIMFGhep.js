var Br=r=>{throw TypeError(r)},Gr=(r,e,t)=>e.has(r)||Br("Cannot "+t),M=(r,e,t)=>(Gr(r,e,"read from private field"),t?t.call(r):e.get(r)),Ee=(r,e,t)=>e.has(r)?Br("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Oe=(r,e,t,n)=>(Gr(r,e,"write to private field"),e.set(r,t),t);const Xr="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHUobil7aWYobj09PSIvIilyZXR1cm57cGFyZW50Om51bGwsbmFtZToiIn07Y29uc3QgZT1uLnNwbGl0KCIvIikuZmlsdGVyKGk9PmkubGVuZ3RoPjApO2lmKGUubGVuZ3RoPT09MCl0aHJvdyBFcnJvcigiSW52YWxpZCBwYXRoIik7Y29uc3QgYT1lW2UubGVuZ3RoLTFdLHI9Ii8iK2Uuc2xpY2UoMCwtMSkuam9pbigiLyIpO3JldHVybntuYW1lOmEscGFyZW50OnJ9fWFzeW5jIGZ1bmN0aW9uIHcobixlKXtjb25zdHtwYXJlbnQ6YSxuYW1lOnJ9PXUobik7aWYoYT09bnVsbClyZXR1cm4gYXdhaXQgbmF2aWdhdG9yLnN0b3JhZ2UuZ2V0RGlyZWN0b3J5KCk7Y29uc3QgaT1hLnNwbGl0KCIvIikuZmlsdGVyKHQ9PnQubGVuZ3RoPjApO3RyeXtsZXQgdD1hd2FpdCBuYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTtmb3IoY29uc3QgcyBvZiBpKXQ9YXdhaXQgdC5nZXREaXJlY3RvcnlIYW5kbGUocyx7Y3JlYXRlOmUuY3JlYXRlfSk7aWYoZS5pc0ZpbGUpcmV0dXJuIGF3YWl0IHQuZ2V0RmlsZUhhbmRsZShyLHtjcmVhdGU6ZS5jcmVhdGV9KX1jYXRjaCh0KXtpZih0Lm5hbWU9PT0iTm90Rm91bmRFcnJvciIpcmV0dXJuIG51bGw7dGhyb3cgdH19Y29uc3QgZj17fTtzZWxmLm9ubWVzc2FnZT1hc3luYyBuPT57dmFyIGk7Y29uc3R7ZXZ0VHlwZTplLGFyZ3M6YX09bi5kYXRhO2xldCByPWZbYS5maWxlSWRdO3RyeXtsZXQgdDtjb25zdCBzPVtdO2lmKGU9PT0icmVnaXN0ZXIiKXtjb25zdCBsPWF3YWl0IHcoYS5maWxlUGF0aCx7Y3JlYXRlOiEwLGlzRmlsZTohMH0pO2lmKGw9PW51bGwpdGhyb3cgRXJyb3IoYG5vdCBmb3VuZCBmaWxlOiAke2EuZmlsZUlkfWApO3I9YXdhaXQgbC5jcmVhdGVTeW5jQWNjZXNzSGFuZGxlKHttb2RlOmEubW9kZX0pLGZbYS5maWxlSWRdPXJ9ZWxzZSBpZihlPT09ImNsb3NlIilhd2FpdCByLmNsb3NlKCksZGVsZXRlIGZbYS5maWxlSWRdO2Vsc2UgaWYoZT09PSJ0cnVuY2F0ZSIpYXdhaXQgci50cnVuY2F0ZShhLm5ld1NpemUpO2Vsc2UgaWYoZT09PSJ3cml0ZSIpe2NvbnN0e2RhdGE6bCxvcHRzOm99PW4uZGF0YS5hcmdzO3Q9YXdhaXQgci53cml0ZShsLG8pfWVsc2UgaWYoZT09PSJyZWFkIil7Y29uc3R7b2Zmc2V0Omwsc2l6ZTpvfT1uLmRhdGEuYXJncyxnPW5ldyBVaW50OEFycmF5KG8pLGQ9YXdhaXQgci5yZWFkKGcse2F0Omx9KSxjPWcuYnVmZmVyO3Q9ZD09PW8/YzooKGk9Yy50cmFuc2Zlcik9PW51bGw/dm9pZCAwOmkuY2FsbChjLGQpKT8/Yy5zbGljZSgwLGQpLHMucHVzaCh0KX1lbHNlIGU9PT0iZ2V0U2l6ZSI/dD1hd2FpdCByLmdldFNpemUoKTplPT09ImZsdXNoIiYmYXdhaXQgci5mbHVzaCgpO3NlbGYucG9zdE1lc3NhZ2Uoe2V2dFR5cGU6ImNhbGxiYWNrIixjYklkOm4uZGF0YS5jYklkLHJldHVyblZhbDp0fSxzKX1jYXRjaCh0KXtjb25zdCBzPXQ7c2VsZi5wb3N0TWVzc2FnZSh7ZXZ0VHlwZToidGhyb3dFcnJvciIsY2JJZDpuLmRhdGEuY2JJZCxlcnJNc2c6cy5uYW1lKyI6ICIrcy5tZXNzYWdlK2AKYCtKU09OLnN0cmluZ2lmeShuLmRhdGEpfSl9fX0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPW9wZnMtd29ya2VyLUY0UldscWNfLmpzLm1hcAo=",ct=r=>Uint8Array.from(atob(r),e=>e.charCodeAt(0)),Pr=typeof self<"u"&&self.Blob&&new Blob([ct(Xr)],{type:"text/javascript;charset=utf-8"});function lt(r){let e;try{if(e=Pr&&(self.URL||self.webkitURL).createObjectURL(Pr),!e)throw"";const t=new Worker(e,{name:r?.name});return t.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:text/javascript;base64,"+Xr,{name:r?.name})}finally{e&&(self.URL||self.webkitURL).revokeObjectURL(e)}}async function ht(r,e,t){const n=dt();return await n("register",{fileId:r,filePath:e,mode:t}),{read:async(i,o)=>await n("read",{fileId:r,offset:i,size:o}),write:async(i,o)=>await n("write",{fileId:r,data:i,opts:o},[ArrayBuffer.isView(i)?i.buffer:i]),close:async()=>await n("close",{fileId:r}),truncate:async i=>await n("truncate",{fileId:r,newSize:i}),getSize:async()=>await n("getSize",{fileId:r}),flush:async()=>await n("flush",{fileId:r})}}const ar=[];let yr=0;function dt(){if(ar.length<3){const e=r();return ar.push(e),e}else{const e=ar[yr];return yr=(yr+1)%ar.length,e}function r(){const e=new lt;let t=0,n={};return e.onmessage=({data:i})=>{var o,f;i.evtType==="callback"?(o=n[i.cbId])==null||o.resolve(i.returnVal):i.evtType==="throwError"&&((f=n[i.cbId])==null||f.reject(Error(i.errMsg))),delete n[i.cbId]},async function(i,o,f=[]){t+=1;const y=new Promise((g,P)=>{n[t]={resolve:g,reject:P}});return e.postMessage({cbId:t,evtType:i,args:o},f),y}}}function pr(r){if(r==="/")return{parent:null,name:""};const e=r.split("/").filter(i=>i.length>0);if(e.length===0)throw Error("Invalid path");const t=e[e.length-1],n="/"+e.slice(0,-1).join("/");return{name:t,parent:n}}async function Ye(r,e){const{parent:t,name:n}=pr(r);if(t==null)return await navigator.storage.getDirectory();const i=t.split("/").filter(o=>o.length>0);try{let o=await navigator.storage.getDirectory();for(const f of i)o=await o.getDirectoryHandle(f,{create:e.create});return e.isFile?await o.getFileHandle(n,{create:e.create}):await o.getDirectoryHandle(n,{create:e.create})}catch(o){if(o.name==="NotFoundError")return null;throw o}}async function Hr(r){const{parent:e,name:t}=pr(r);if(e==null){const i=await navigator.storage.getDirectory();for await(const o of i.keys())await i.removeEntry(o,{recursive:!0});return}const n=await Ye(e,{create:!1,isFile:!1});n!=null&&await n.removeEntry(t,{recursive:!0})}function kr(r,e){return`${r}/${e}`.replace("//","/")}function Ve(r){return new Dr(r)}var Se,sr,er;const pt=class Cr{constructor(e){Ee(this,Se),Ee(this,sr),Ee(this,er),Oe(this,Se,e);const{parent:t,name:n}=pr(e);Oe(this,sr,n),Oe(this,er,t)}get kind(){return"dir"}get name(){return M(this,sr)}get path(){return M(this,Se)}get parent(){return M(this,er)==null?null:Ve(M(this,er))}async create(){return await Ye(M(this,Se),{create:!0,isFile:!1}),Ve(M(this,Se))}async exists(){return await Ye(M(this,Se),{create:!1,isFile:!1})instanceof FileSystemDirectoryHandle}async remove(){for(const e of await this.children())try{await e.remove()}catch(t){console.warn(t)}try{await Hr(M(this,Se))}catch(e){console.warn(e)}}async children(){const e=await Ye(M(this,Se),{create:!1,isFile:!1});if(e==null)return[];const t=[];for await(const n of e.values())t.push((n.kind==="file"?Ke:Ve)(kr(M(this,Se),n.name)));return t}async copyTo(e){if(!await this.exists())throw Error(`dir ${this.path} not exists`);if(e instanceof Cr){const t=await e.exists()?Ve(kr(e.path,this.name)):e;await t.create(),await Promise.all((await this.children()).map(n=>n.copyTo(t)));return}else if(e instanceof FileSystemDirectoryHandle){await Promise.all((await this.children()).map(async t=>{t.kind==="file"?await t.copyTo(await e.getFileHandle(t.name,{create:!0})):await t.copyTo(await e.getDirectoryHandle(t.name,{create:!0}))}));return}throw Error("Illegal target type")}async moveTo(e){await this.copyTo(e),await this.remove()}};Se=new WeakMap,sr=new WeakMap,er=new WeakMap;let Dr=pt;const Ar=new Map;function Ke(r,e="rw"){if(e==="rw"){const t=Ar.get(r)??new hr(r,e);return Ar.set(r,t),t}return new hr(r,e)}async function lr(r,e,t={overwrite:!0}){if(e instanceof hr){await lr(r,await e.stream(),t);return}const n=await(r instanceof hr?r:Ke(r,"rw")).createWriter();try{if(t.overwrite&&await n.truncate(0),e instanceof ReadableStream){const i=e.getReader();for(;;){const{done:o,value:f}=await i.read();if(o)break;await n.write(f)}}else await n.write(e)}catch(i){throw i}finally{await n.close()}}let vt=0;const wt=()=>++vt;var je,rr,ur,tr,fr,Ue,cr,nr;const yt=class Vr{constructor(e,t){Ee(this,je),Ee(this,rr),Ee(this,ur),Ee(this,tr),Ee(this,fr),Ee(this,Ue,0),Ee(this,cr,(()=>{let o=null;return()=>(Oe(this,Ue,M(this,Ue)+1),o??(o=new Promise(async(f,y)=>{try{const g=await ht(M(this,fr),M(this,je),M(this,tr));f([g,async()=>{Oe(this,Ue,M(this,Ue)-1),!(M(this,Ue)>0)&&(o=null,await g.close())}])}catch(g){y(g)}})))})()),Ee(this,nr,!1),Oe(this,fr,wt()),Oe(this,je,e),Oe(this,tr,{r:"read-only",rw:"readwrite","rw-unsafe":"readwrite-unsafe"}[t]);const{parent:n,name:i}=pr(e);if(n==null)throw Error("Invalid path");Oe(this,ur,i),Oe(this,rr,n)}get kind(){return"file"}get path(){return M(this,je)}get name(){return M(this,ur)}get parent(){return M(this,rr)==null?null:Ve(M(this,rr))}async createWriter(){if(M(this,tr)==="read-only")throw Error("file is read-only");if(M(this,nr))throw Error("Other writer have not been closed");Oe(this,nr,!0);const e=new TextEncoder,[t,n]=await M(this,cr).call(this);let i=await t.getSize(),o=!1;return{write:async(f,y={})=>{if(o)throw Error("Writer is closed");const g=typeof f=="string"?e.encode(f):f,P=y.at??i,v=g.byteLength;return i=P+v,await t.write(g,{at:P})},truncate:async f=>{if(o)throw Error("Writer is closed");await t.truncate(f),i>f&&(i=f)},flush:async()=>{if(o)throw Error("Writer is closed");await t.flush()},close:async()=>{if(o)throw Error("Writer is closed");o=!0,Oe(this,nr,!1),await n()}}}async createReader(){const[e,t]=await M(this,cr).call(this);let n=!1,i=0;return{read:async(o,f={})=>{if(n)throw Error("Reader is closed");const y=f.at??i,g=await e.read(y,o);return i=y+g.byteLength,g},getSize:async()=>{if(n)throw Error("Reader is closed");return await e.getSize()},close:async()=>{n||(n=!0,await t())}}}async text(){return new TextDecoder().decode(await this.arrayBuffer())}async arrayBuffer(){const e=await Ye(M(this,je),{create:!1,isFile:!0});return e==null?new ArrayBuffer(0):(await e.getFile()).arrayBuffer()}async stream(){const e=await this.getOriginFile();return e==null?new ReadableStream({pull:t=>{t.close()}}):e.stream()}async getOriginFile(){var e;return(e=await Ye(M(this,je),{create:!1,isFile:!0}))==null?void 0:e.getFile()}async getSize(){const e=await Ye(M(this,je),{create:!1,isFile:!0});return e==null?0:(await e.getFile()).size}async exists(){return await Ye(M(this,je),{create:!1,isFile:!0})instanceof FileSystemFileHandle}async remove(){if(M(this,Ue))throw Error("exists unclosed reader/writer");await Hr(M(this,je))}async copyTo(e){if(e instanceof Vr){if(e.path===this.path)return;await lr(e.path,this);return}else if(e instanceof Dr){if(!await this.exists())throw Error(`file ${this.path} not exists`);return await this.copyTo(Ke(kr(e.path,this.name)))}else if(e instanceof FileSystemFileHandle){await(await this.stream()).pipeTo(await e.createWritable());return}throw Error("Illegal target type")}async moveTo(e){await this.copyTo(e),await this.remove()}};je=new WeakMap,rr=new WeakMap,ur=new WeakMap,tr=new WeakMap,fr=new WeakMap,Ue=new WeakMap,cr=new WeakMap,nr=new WeakMap;let hr=yt;const Kr="/.opfs-tools-temp-dir";async function Qr(r){try{if(r.kind==="file"){if(!await r.exists())return!0;const e=await r.createWriter();await e.truncate(0),await e.close(),await r.remove()}else await r.remove();return!0}catch(e){return console.warn(e),!1}}function mt(){setInterval(async()=>{for(const r of await Ve(Kr).children()){const e=/^\d+-(\d+)$/.exec(r.name);(e==null||Date.now()-Number(e[1])>2592e5)&&await Qr(r)}},60*1e3)}const Ir=[];let Fr=!1;async function gt(){if(globalThis.localStorage==null)return;const r="OPFS_TOOLS_EXPIRES_TMP_FILES";Fr||(Fr=!0,globalThis.addEventListener("unload",()=>{Ir.length!==0&&localStorage.setItem(r,`${localStorage.getItem(r)??""},${Ir.join(",")}`)}));let e=localStorage.getItem(r)??"";for(const t of e.split(","))t.length!==0&&await Qr(Ke(`${Kr}/${t}`))&&(e=e.replace(t,""));localStorage.setItem(r,e.replace(/,{2,}/g,","))}(async function(){var r;globalThis.__opfs_tools_tmpfile_init__!==!0&&(globalThis.__opfs_tools_tmpfile_init__=!0,!(globalThis.FileSystemDirectoryHandle==null||globalThis.FileSystemFileHandle==null||((r=globalThis.navigator)==null?void 0:r.storage.getDirectory)==null)&&(mt(),await gt()))})();function bt(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var ir={exports:{}},kt={},_t=Object.freeze({__proto__:null,default:kt}),Ce=bt(_t);/**
 * workerpool.js
 * https://github.com/josdejong/workerpool
 *
 * Offload tasks to a pool of workers on node.js and in the browser.
 *
 * @version 9.2.0
 * @date    2024-10-11
 *
 * @license
 * Copyright (C) 2014-2022 Jos de Jong <wjosdejong@gmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */var xt=ir.exports,Lr;function Ot(){return Lr||(Lr=1,function(r,e){(function(t,n){n(e)})(xt,function(t){var n={},i={exports:{}};(function(u){var d=function(b){return typeof b<"u"&&b.versions!=null&&b.versions.node!=null&&b+""=="[object process]"};u.exports.isNode=d,u.exports.platform=typeof process<"u"&&d(process)?"node":"browser";var h=u.exports.platform==="node"&&Ce;u.exports.isMainThread=u.exports.platform==="node"?(!h||h.isMainThread)&&!process.connected:typeof Window<"u",u.exports.cpus=u.exports.platform==="browser"?self.navigator.hardwareConcurrency:Ce.cpus().length})(i);var o=i.exports,f={},y;function g(){if(y)return f;y=1;function u(b,R){var a=this;if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator");if(typeof b!="function")throw new SyntaxError("Function parameter handler(resolve, reject) missing");var N=[],F=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var oe=function(s,w){N.push(s),F.push(w)};this.then=function(l,s){return new u(function(w,x){var I=l?d(l,w,x):w,de=s?d(s,w,x):x;oe(I,de)},a)};var fe=function(s){return a.resolved=!0,a.rejected=!1,a.pending=!1,N.forEach(function(w){w(s)}),oe=function(x,I){x(s)},fe=p=function(){},a},p=function(s){return a.resolved=!1,a.rejected=!0,a.pending=!1,F.forEach(function(w){w(s)}),oe=function(x,I){I(s)},fe=p=function(){},a};this.cancel=function(){return R?R.cancel():p(new h),a},this.timeout=function(l){if(R)R.timeout(l);else{var s=setTimeout(function(){p(new W("Promise timed out after "+l+" ms"))},l);a.always(function(){clearTimeout(s)})}return a},b(function(l){fe(l)},function(l){p(l)})}function d(b,R,a){return function(N){try{var F=b(N);F&&typeof F.then=="function"&&typeof F.catch=="function"?F.then(R,a):R(F)}catch(oe){a(oe)}}}u.prototype.catch=function(b){return this.then(null,b)},u.prototype.always=function(b){return this.then(b,b)},u.prototype.finally=function(b){var R=this,a=function(){return new u(function(F){return F()}).then(b).then(function(){return R})};return this.then(a,a)},u.all=function(b){return new u(function(R,a){var N=b.length,F=[];N?b.forEach(function(oe,fe){oe.then(function(p){F[fe]=p,N--,N==0&&R(F)},function(p){N=0,a(p)})}):R(F)})},u.defer=function(){var b={};return b.promise=new u(function(R,a){b.resolve=R,b.reject=a}),b};function h(b){this.message=b||"promise cancelled",this.stack=new Error().stack}h.prototype=new Error,h.prototype.constructor=Error,h.prototype.name="CancellationError",u.CancellationError=h;function W(b){this.message=b||"timeout exceeded",this.stack=new Error().stack}return W.prototype=new Error,W.prototype.constructor=Error,W.prototype.name="TimeoutError",u.TimeoutError=W,f.Promise=u,f}function P(u,d){(d==null||d>u.length)&&(d=u.length);for(var h=0,W=Array(d);h<d;h++)W[h]=u[h];return W}function v(u,d){var h=typeof Symbol<"u"&&u[Symbol.iterator]||u["@@iterator"];if(!h){if(Array.isArray(u)||(h=ye(u))||d){h&&(u=h);var W=0,b=function(){};return{s:b,n:function(){return W>=u.length?{done:!0}:{done:!1,value:u[W++]}},e:function(F){throw F},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var R,a=!0,N=!1;return{s:function(){h=h.call(u)},n:function(){var F=h.next();return a=F.done,F},e:function(F){N=!0,R=F},f:function(){try{a||h.return==null||h.return()}finally{if(N)throw R}}}}function m(u,d,h){return(d=G(d))in u?Object.defineProperty(u,d,{value:h,enumerable:!0,configurable:!0,writable:!0}):u[d]=h,u}function T(u,d){var h=Object.keys(u);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(u);d&&(W=W.filter(function(b){return Object.getOwnPropertyDescriptor(u,b).enumerable})),h.push.apply(h,W)}return h}function U(u){for(var d=1;d<arguments.length;d++){var h=arguments[d]!=null?arguments[d]:{};d%2?T(Object(h),!0).forEach(function(W){m(u,W,h[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(h)):T(Object(h)).forEach(function(W){Object.defineProperty(u,W,Object.getOwnPropertyDescriptor(h,W))})}return u}function re(u,d){if(typeof u!="object"||!u)return u;var h=u[Symbol.toPrimitive];if(h!==void 0){var W=h.call(u,d);if(typeof W!="object")return W;throw new TypeError("@@toPrimitive must return a primitive value.")}return(d==="string"?String:Number)(u)}function G(u){var d=re(u,"string");return typeof d=="symbol"?d:d+""}function V(u){"@babel/helpers - typeof";return V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},V(u)}function ye(u,d){if(u){if(typeof u=="string")return P(u,d);var h={}.toString.call(u).slice(8,-1);return h==="Object"&&u.constructor&&(h=u.constructor.name),h==="Map"||h==="Set"?Array.from(u):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?P(u,d):void 0}}var C={exports:{}},Y={},te;function ne(){return te||(te=1,Y.validateOptions=function(d,h,W){if(d){var b=d?Object.keys(d):[],R=b.find(function(N){return!h.includes(N)});if(R)throw new Error('Object "'+W+'" contains an unknown option "'+R+'"');var a=h.find(function(N){return Object.prototype[N]&&!b.includes(N)});if(a)throw new Error('Object "'+W+'" contains an inherited option "'+a+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return d}},Y.workerOptsNames=["credentials","name","type"],Y.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"],Y.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]),Y}var J,K;function A(){return K||(K=1,J=`!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?u(e,t,r):t,i=n?u(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new s),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function u(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function s(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},s.prototype=new Error,s.prototype.constructor=Error,s.prototype.name="CancellationError",i.CancellationError=s,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,u="__workerpool-cleanup__",s={exit:function(){}},c={addAbortListener:function(e){s.abortListeners.push(e)},emit:s.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)s.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},s.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;s.send=f.postMessage.bind(f),s.on=f.on.bind(f),s.exit=process.exit.bind(process)}else s.on=process.on.bind(process),s.send=function(e){process.send(e)},s.on("disconnect",(function(){process.exit(1)})),s.exit=process.exit.bind(process)}function d(e){return Object.getOwnPropertyNames(e).reduce((function(n,t){return Object.defineProperty(n,t,{value:e[t],enumerable:!0})}),{})}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}s.methods={},s.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},s.methods.methods=function(){return Object.keys(s.methods)},s.terminationHandler=void 0,s.abortListenerTimeout=1e3,s.abortListeners=[],s.terminateAndExit=function(e){var n=function(){s.exit(e)};if(!s.terminationHandler)return n();var t=s.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},s.cleanup=function(e){if(!s.abortListeners.length)return s.send({id:e,method:u,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=s.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),s.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),s.abortListeners.length||(s.abortListeners=[])}),(function(){clearTimeout(n),s.exit()}));return i.all([o,r]).then((function(){s.send({id:e,method:u,error:null})}),(function(n){s.send({id:e,method:u,error:n?d(n):null})}))};var p=null;s.on("message",(function(e){if("__workerpool-terminate__"===e)return s.terminateAndExit(0);if(e.method===u)return s.cleanup(e.id);try{var n=s.methods[e.method];if(!n)throw new Error('Unknown method "'+e.method+'"');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?s.send({id:e.id,result:n.message,error:null},n.transfer):s.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){s.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?s.send({id:e.id,result:r.message,error:null},r.transfer):s.send({id:e.id,result:r,error:null}),p=null)}catch(n){s.send({id:e.id,result:null,error:d(n)})}})),s.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(s.methods[t]=e[t],s.methods[t].worker=c);n&&(s.terminationHandler=n.onTerminate,s.abortListenerTimeout=n.abortListenerTimeout||1e3),s.send("ready")},s.emit=function(e){if(p){if(e instanceof t)return void s.send({id:p,isEvent:!0,payload:e.message},e.transfer);s.send({id:p,isEvent:!0,payload:e})}},n.add=s.register,n.emit=s.emit}(t),n(t)}));
//# sourceMappingURL=worker.min.js.map
`),J}var _;function $(){if(_)return C.exports;_=1;var u=g(),d=u.Promise,h=o,W=ne(),b=W.validateOptions,R=W.forkOptsNames,a=W.workerThreadOptsNames,N=W.workerOptsNames,F="__workerpool-terminate__",oe="__workerpool-cleanup__";function fe(){var k=l();if(!k)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return k}function p(){if(typeof Worker!="function"&&((typeof Worker>"u"?"undefined":V(Worker))!=="object"||typeof Worker.prototype.constructor!="function"))throw new Error("WorkerPool: Web Workers not supported")}function l(){try{return Ce}catch(k){if(V(k)==="object"&&k!==null&&k.code==="MODULE_NOT_FOUND")return null;throw k}}function s(){if(h.platform==="browser"){if(typeof Blob>"u")throw new Error("Blob not supported by the browser");if(!window.URL||typeof window.URL.createObjectURL!="function")throw new Error("URL.createObjectURL not supported by the browser");var k=new Blob([A()],{type:"text/javascript"});return window.URL.createObjectURL(k)}else return __dirname+"/worker.js"}function w(k,E){if(E.workerType==="web")return p(),x(k,E.workerOpts,Worker);if(E.workerType==="thread")return c=fe(),I(k,c,E);if(E.workerType==="process"||!E.workerType)return de(k,ve(E),Ce);if(h.platform==="browser")return p(),x(k,E.workerOpts,Worker);var c=l();return c?I(k,c,E):de(k,ve(E),Ce)}function x(k,E,c){b(E,N,"workerOpts");var O=new c(k,E);return O.isBrowserWorker=!0,O.on=function(S,L){this.addEventListener(S,function(Z){L(Z.data)})},O.send=function(S,L){this.postMessage(S,L)},O}function I(k,E,c){var O,S;b(c?.workerThreadOpts,a,"workerThreadOpts");var L=new E.Worker(k,U({stdout:(O=c?.emitStdStreams)!==null&&O!==void 0?O:!1,stderr:(S=c?.emitStdStreams)!==null&&S!==void 0?S:!1},c?.workerThreadOpts));return L.isWorkerThread=!0,L.send=function(Z,j){this.postMessage(Z,j)},L.kill=function(){return this.terminate(),!0},L.disconnect=function(){this.terminate()},c!=null&&c.emitStdStreams&&(L.stdout.on("data",function(Z){return L.emit("stdout",Z)}),L.stderr.on("data",function(Z){return L.emit("stderr",Z)})),L}function de(k,E,c){b(E.forkOpts,R,"forkOpts");var O=c.fork(k,E.forkArgs,E.forkOpts),S=O.send;return O.send=function(L){return S.call(O,L)},E.emitStdStreams&&(O.stdout.on("data",function(L){return O.emit("stdout",L)}),O.stderr.on("data",function(L){return O.emit("stderr",L)})),O.isChildProcess=!0,O}function ve(k){k=k||{};var E=process.execArgv.join(" "),c=E.indexOf("--inspect")!==-1,O=E.indexOf("--debug-brk")!==-1,S=[];return c&&(S.push("--inspect="+k.debugPort),O&&S.push("--debug-brk")),process.execArgv.forEach(function(L){L.indexOf("--max-old-space-size")>-1&&S.push(L)}),Object.assign({},k,{forkArgs:k.forkArgs,forkOpts:Object.assign({},k.forkOpts,{execArgv:(k.forkOpts&&k.forkOpts.execArgv||[]).concat(S),stdio:k.emitStdStreams?"pipe":void 0})})}function _e(k){for(var E=new Error(""),c=Object.keys(k),O=0;O<c.length;O++)E[c[O]]=k[c[O]];return E}function xe(k,E){if(Object.keys(k.processing).length===1){var c=Object.values(k.processing)[0];c.options&&typeof c.options.on=="function"&&c.options.on(E)}}function Ze(k,E){var c=this,O=E||{};this.script=k||s(),this.worker=w(this.script,O),this.debugPort=O.debugPort,this.forkOpts=O.forkOpts,this.forkArgs=O.forkArgs,this.workerOpts=O.workerOpts,this.workerThreadOpts=O.workerThreadOpts,this.workerTerminateTimeout=O.workerTerminateTimeout,k||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(j){xe(c,{stdout:j.toString()})}),this.worker.on("stderr",function(j){xe(c,{stderr:j.toString()})}),this.worker.on("message",function(j){if(!c.terminated)if(typeof j=="string"&&j==="ready")c.worker.ready=!0,L();else{var pe=j.id,D=c.processing[pe];if(D!==void 0&&(j.isEvent?D.options&&typeof D.options.on=="function"&&D.options.on(j.payload):(delete c.processing[pe],c.terminating===!0&&c.terminate(),j.error?D.resolver.reject(_e(j.error)):D.resolver.resolve(j.result))),j.method===oe){var we=c.tracking[j.id];we!==void 0&&(j.error?(clearTimeout(we.timeoutId),we.resolver.reject(_e(j.error))):(c.tracking&&clearTimeout(we.timeoutId),we.resolver.resolve(we.result))),delete c.tracking[pe]}}});function S(j){c.terminated=!0;for(var pe in c.processing)c.processing[pe]!==void 0&&c.processing[pe].resolver.reject(j);c.processing=Object.create(null)}function L(){var j=v(c.requestQueue.splice(0)),pe;try{for(j.s();!(pe=j.n()).done;){var D=pe.value;c.worker.send(D.message,D.transfer)}}catch(we){j.e(we)}finally{j.f()}}var Z=this.worker;this.worker.on("error",S),this.worker.on("exit",function(j,pe){var D=`Workerpool Worker terminated Unexpectedly
`;D+="    exitCode: `"+j+"`\n",D+="    signalCode: `"+pe+"`\n",D+="    workerpool.script: `"+c.script+"`\n",D+="    spawnArgs: `"+Z.spawnargs+"`\n",D+="    spawnfile: `"+Z.spawnfile+"`\n",D+="    stdout: `"+Z.stdout+"`\n",D+="    stderr: `"+Z.stderr+"`\n",S(new Error(D))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}return Ze.prototype.methods=function(){return this.exec("methods")},Ze.prototype.exec=function(k,E,c,O){c||(c=d.defer());var S=++this.lastId;this.processing[S]={id:S,resolver:c,options:O};var L={message:{id:S,method:k,params:E},transfer:O&&O.transfer};this.terminated?c.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(L.message,L.transfer):this.requestQueue.push(L);var Z=this;return c.promise.catch(function(j){if(j instanceof d.CancellationError||j instanceof d.TimeoutError)return Z.tracking[S]={id:S,resolver:d.defer()},delete Z.processing[S],Z.tracking[S].resolver.promise=Z.tracking[S].resolver.promise.catch(function(pe){delete Z.tracking[S];var D=Z.terminateAndNotify(!0).then(function(){throw pe},function(we){throw we});return D}),Z.worker.send({id:S,method:oe}),Z.tracking[S].timeoutId=setTimeout(function(){Z.tracking[S].resolver.reject(j)},Z.workerTerminateTimeout),Z.tracking[S].resolver.promise;throw j})},Ze.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0},Ze.prototype.terminate=function(k,E){var c=this;if(k){for(var O in this.processing)this.processing[O]!==void 0&&this.processing[O].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var S=0,L=Object.values(c.tracking);S<L.length;S++){var Z=L[S];clearTimeout(Z.timeoutId),Z.resolver.reject(new Error("Worker Terminating"))}if(c.tracking=Object.create(null),typeof E=="function"&&(this.terminationHandler=E),this.busy())this.terminating=!0;else{var j=function(we){if(c.terminated=!0,c.cleaning=!1,c.worker!=null&&c.worker.removeAllListeners&&c.worker.removeAllListeners("message"),c.worker=null,c.terminating=!1,c.terminationHandler)c.terminationHandler(we,c);else if(we)throw we};if(this.worker)if(typeof this.worker.kill=="function"){if(this.worker.killed){j(new Error("worker already killed!"));return}var pe=setTimeout(function(){c.worker&&c.worker.kill()},this.workerTerminateTimeout);this.worker.once("exit",function(){clearTimeout(pe),c.worker&&(c.worker.killed=!0),j()}),this.worker.ready?this.worker.send(F):this.requestQueue.push({message:F}),this.cleaning=!0;return}else if(typeof this.worker.terminate=="function")this.worker.terminate(),this.worker.killed=!0;else throw new Error("Failed to terminate worker");j()}},Ze.prototype.terminateAndNotify=function(k,E){var c=d.defer();return E&&c.promise.timeout(E),this.terminate(k,function(O,S){O?c.reject(O):c.resolve(S)}),c.promise},C.exports=Ze,C.exports._tryRequireWorkerThreads=l,C.exports._setupProcessWorker=de,C.exports._setupBrowserWorker=x,C.exports._setupWorkerThreadWorker=I,C.exports.ensureWorkerThreads=fe,C.exports}var H,q;function We(){if(q)return H;q=1;var u=65535;H=d;function d(){this.ports=Object.create(null),this.length=0}return d.prototype.nextAvailableStartingAt=function(h){for(;this.ports[h]===!0;)h++;if(h>=u)throw new Error("WorkerPool debug port limit reached: "+h+">= "+u);return this.ports[h]=!0,this.length++,h},d.prototype.releasePort=function(h){delete this.ports[h],this.length--},H}var ae,se;function ee(){if(se)return ae;se=1;var u=g(),d=u.Promise,h=$(),W=o,b=We(),R=new b;function a(p,l){typeof p=="string"?this.script=p||null:(this.script=null,l=p),this.workers=[],this.tasks=[],l=l||{},this.forkArgs=Object.freeze(l.forkArgs||[]),this.forkOpts=Object.freeze(l.forkOpts||{}),this.workerOpts=Object.freeze(l.workerOpts||{}),this.workerThreadOpts=Object.freeze(l.workerThreadOpts||{}),this.debugPortStart=l.debugPortStart||43210,this.nodeWorker=l.nodeWorker,this.workerType=l.workerType||l.nodeWorker||"auto",this.maxQueueSize=l.maxQueueSize||1/0,this.workerTerminateTimeout=l.workerTerminateTimeout||1e3,this.onCreateWorker=l.onCreateWorker||function(){return null},this.onTerminateWorker=l.onTerminateWorker||function(){return null},this.emitStdStreams=l.emitStdStreams||!1,l&&"maxWorkers"in l?(N(l.maxWorkers),this.maxWorkers=l.maxWorkers):this.maxWorkers=Math.max((W.cpus||4)-1,1),l&&"minWorkers"in l&&(l.minWorkers==="max"?this.minWorkers=this.maxWorkers:(F(l.minWorkers),this.minWorkers=l.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),this.workerType==="thread"&&h.ensureWorkerThreads()}a.prototype.exec=function(p,l,s){if(l&&!Array.isArray(l))throw new TypeError('Array expected as argument "params"');if(typeof p=="string"){var w=d.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var x=this.tasks,I={method:p,params:l,resolver:w,timeout:null,options:s};x.push(I);var de=w.promise.timeout;return w.promise.timeout=function(_e){return x.indexOf(I)!==-1?(I.timeout=_e,w.promise):de.call(w.promise,_e)},this._next(),w.promise}else{if(typeof p=="function")return this.exec("run",[String(p),l],s);throw new TypeError('Function or string expected as argument "method"')}},a.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var p=this;return this.exec("methods").then(function(l){var s={};return l.forEach(function(w){s[w]=function(){return p.exec(w,Array.prototype.slice.call(arguments))}}),s})},a.prototype._next=function(){if(this.tasks.length>0){var p=this._getWorker();if(p){var l=this,s=this.tasks.shift();if(s.resolver.promise.pending){var w=p.exec(s.method,s.params,s.resolver,s.options).then(l._boundNext).catch(function(){if(p.terminated)return l._removeWorker(p)}).then(function(){l._next()});typeof s.timeout=="number"&&w.timeout(s.timeout)}else l._next()}}},a.prototype._getWorker=function(){for(var p=this.workers,l=0;l<p.length;l++){var s=p[l];if(s.busy()===!1)return s}return p.length<this.maxWorkers?(s=this._createWorkerHandler(),p.push(s),s):null},a.prototype._removeWorker=function(p){var l=this;return R.releasePort(p.debugPort),this._removeWorkerFromList(p),this._ensureMinWorkers(),new d(function(s,w){p.terminate(!1,function(x){l.onTerminateWorker({forkArgs:p.forkArgs,forkOpts:p.forkOpts,workerThreadOpts:p.workerThreadOpts,script:p.script}),x?w(x):s(p)})})},a.prototype._removeWorkerFromList=function(p){var l=this.workers.indexOf(p);l!==-1&&this.workers.splice(l,1)},a.prototype.terminate=function(p,l){var s=this;this.tasks.forEach(function(ve){ve.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var w=function(_e){R.releasePort(_e.debugPort),this._removeWorkerFromList(_e)},x=w.bind(this),I=[],de=this.workers.slice();return de.forEach(function(ve){var _e=ve.terminateAndNotify(p,l).then(x).always(function(){s.onTerminateWorker({forkArgs:ve.forkArgs,forkOpts:ve.forkOpts,workerThreadOpts:ve.workerThreadOpts,script:ve.script})});I.push(_e)}),d.all(I)},a.prototype.stats=function(){var p=this.workers.length,l=this.workers.filter(function(s){return s.busy()}).length;return{totalWorkers:p,busyWorkers:l,idleWorkers:p-l,pendingTasks:this.tasks.length,activeTasks:l}},a.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var p=this.workers.length;p<this.minWorkers;p++)this.workers.push(this._createWorkerHandler())},a.prototype._createWorkerHandler=function(){var p=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new h(p.script||this.script,{forkArgs:p.forkArgs||this.forkArgs,forkOpts:p.forkOpts||this.forkOpts,workerOpts:p.workerOpts||this.workerOpts,workerThreadOpts:p.workerThreadOpts||this.workerThreadOpts,debugPort:R.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})};function N(p){if(!oe(p)||!fe(p)||p<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function F(p){if(!oe(p)||!fe(p)||p<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function oe(p){return typeof p=="number"}function fe(p){return Math.round(p)==p}return ae=a,ae}var z={},ie,Q;function Fe(){if(Q)return ie;Q=1;function u(d,h){this.message=d,this.transfer=h}return ie=u,ie}var ce;function be(){return ce||(ce=1,function(u){var d=Fe(),h=g().Promise,W="__workerpool-terminate__",b="__workerpool-cleanup__",R=1e3,a={exit:function(){}},N={addAbortListener:function(w){a.abortListeners.push(w)},emit:a.emit};if(typeof self<"u"&&typeof postMessage=="function"&&typeof addEventListener=="function")a.on=function(s,w){addEventListener(s,function(x){w(x.data)})},a.send=function(s,w){w?postMessage(s,w):postMessage(s)};else if(typeof process<"u"){var F;try{F=Ce}catch(s){if(!(V(s)==="object"&&s!==null&&s.code==="MODULE_NOT_FOUND"))throw s}if(F&&F.parentPort!==null){var oe=F.parentPort;a.send=oe.postMessage.bind(oe),a.on=oe.on.bind(oe),a.exit=process.exit.bind(process)}else a.on=process.on.bind(process),a.send=function(s){process.send(s)},a.on("disconnect",function(){process.exit(1)}),a.exit=process.exit.bind(process)}else throw new Error("Script must be executed as a worker");function fe(s){return Object.getOwnPropertyNames(s).reduce(function(w,x){return Object.defineProperty(w,x,{value:s[x],enumerable:!0})},{})}function p(s){return s&&typeof s.then=="function"&&typeof s.catch=="function"}a.methods={},a.methods.run=function(w,x){var I=new Function("return ("+w+").apply(this, arguments);");return I.worker=N,I.apply(I,x)},a.methods.methods=function(){return Object.keys(a.methods)},a.terminationHandler=void 0,a.abortListenerTimeout=R,a.abortListeners=[],a.terminateAndExit=function(s){var w=function(){a.exit(s)};if(!a.terminationHandler)return w();var x=a.terminationHandler(s);return p(x)?(x.then(w,w),x):(w(),new h(function(I,de){de(new Error("Worker terminating"))}))},a.cleanup=function(s){if(!a.abortListeners.length)return a.send({id:s,method:b,error:fe(new Error("Worker terminating"))}),new h(function(xe){xe()});var w=function(){a.exit()},x=function(){a.abortListeners.length||(a.abortListeners=[])},I=a.abortListeners.map(function(xe){return xe()}),de,ve=new h(function(xe,Ze){de=setTimeout(function(){Ze(new Error("Timeout occured waiting for abort handler, killing worker"))},a.abortListenerTimeout)}),_e=h.all(I).then(function(){clearTimeout(de),x()},function(){clearTimeout(de),w()});return h.all([_e,ve]).then(function(){a.send({id:s,method:b,error:null})},function(xe){a.send({id:s,method:b,error:xe?fe(xe):null})})};var l=null;a.on("message",function(s){if(s===W)return a.terminateAndExit(0);if(s.method===b)return a.cleanup(s.id);try{var w=a.methods[s.method];if(w){l=s.id;var x=w.apply(w,s.params);p(x)?x.then(function(I){I instanceof d?a.send({id:s.id,result:I.message,error:null},I.transfer):a.send({id:s.id,result:I,error:null}),l=null}).catch(function(I){a.send({id:s.id,result:null,error:fe(I)}),l=null}):(x instanceof d?a.send({id:s.id,result:x.message,error:null},x.transfer):a.send({id:s.id,result:x,error:null}),l=null)}else throw new Error('Unknown method "'+s.method+'"')}catch(I){a.send({id:s.id,result:null,error:fe(I)})}}),a.register=function(s,w){if(s)for(var x in s)s.hasOwnProperty(x)&&(a.methods[x]=s[x],a.methods[x].worker=N);w&&(a.terminationHandler=w.onTerminate,a.abortListenerTimeout=w.abortListenerTimeout||R),a.send("ready")},a.emit=function(s){if(l){if(s instanceof d){a.send({id:l,isEvent:!0,payload:s.message},s.transfer);return}a.send({id:l,isEvent:!0,payload:s})}},u.add=a.register,u.emit=a.emit}(z)),z}var le=o.platform,he=o.isMainThread,X=o.cpus;function ke(u,d){var h=ee();return new h(u,d)}var Le=n.pool=ke;function Me(u,d){var h=be();h.add(u,d)}var Xe=n.worker=Me;function He(u){var d=be();d.emit(u)}var Be=n.workerEmit=He,Ge=g(),Re=Ge.Promise,Je=n.Promise=Re,at=n.Transfer=Fe(),st=n.platform=le,ut=n.isMainThread=he,ft=n.cpus=X;t.Promise=Je,t.Transfer=at,t.cpus=ft,t.default=n,t.isMainThread=ut,t.platform=st,t.pool=Le,t.worker=Xe,t.workerEmit=Be,Object.defineProperty(t,"__esModule",{value:!0})})}(ir,ir.exports)),ir.exports}var Tt=Ot();const Et=[];class dr{constructor(e,t){this.max=e,this._seed=t}cast(e,t){return BigInt.asUintN(t,e)}checkNum(e){if(e>this.max)throw new Error(`Number greater than ${this.max}`)}reset(){if(this.constructor===dr)throw new Error("Method not implemented")}_int(){if(this.constructor===dr)throw new Error("Method not implemented");return BigInt(0)}bool(){return this.float()>=.5}coin(e=.5){return this.float()<e}int(){return Number(this._int())}bigInt(){return this._int()}float(){return this.int()*(1/this.max)}float53(){const e=this.int()>>>5,t=this.int()>>>6;return(e*67108864+t)*(1/9007199254740992)}randRange(e,t){const n=t-e,i=this.max%n;let o=this.int();for(;o<i;)o=this.int();return e+o%n}randBelow(e){return this.randRange(0,e)}choice(e){return e[this.randBelow(e.length)]}shuffle(e,t=!0){let n=e;t||(n=Array.from(n));for(let i=n.length-1;i>0;i--){const o=this.randRange(0,i),f=n[i];n[i]=n[o],n[o]=f}return n}initArray(e,t){return Array.from({length:e},t)}boolArray(e){return this.initArray(e,()=>this.bool())}coinArray(e,t=.5){return this.initArray(e,()=>this.coin(t))}intArray(e){return this.initArray(e,()=>this.int())}bigIntArray(e){return this.initArray(e,()=>this.bigInt())}randRangeArray(e,t,n){return this.initArray(e,()=>this.randRange(t,n))}floatArray(e){return this.initArray(e,()=>this.float())}float53Array(e){return this.initArray(e,()=>this.float53())}}class Wt extends dr{constructor(e,t){super(e,t)}int(){return Number(this._int()>>11n)}float(){return this.int()/this.max}float53(){return this.float()}}const St=2**53;class Jr extends Wt{constructor(e=Date.now(),t=13,n=7,i=17){super(St,BigInt(e)),this.seed=e,this.a=this.cast(BigInt(t),64),this.b=this.cast(BigInt(n),64),this.c=this.cast(BigInt(i),64)}reset(){this.x=this.seed}get seed(){return this._seed}set seed(e){this._seed=this.cast(BigInt(e),64),this.x=this._seed}_int(){let{x:e}=this;return e^=e<<this.a,e=this.cast(e,64),e^=e>>this.b,e^=e<<this.c,e=this.cast(e,64),this.x=e,e}}new Jr(Date.now());new Jr(Date.now());const jt=r=>r.slice().sort((e,t)=>{const n=["biome","heightmap","temperature","moisture","shade"];for(const i of n){const o=t[i]===void 0?[-1/0,1/0]:t[i],f=e[i]===void 0?[-1/0,1/0]:e[i];if(f!==o)return o[0]-f[0]}return 0}),Pt={plotCount:256,chunkSize:16*256,colorMap:jt(Et)};var Er=["u8","u16","u32","u64","u128","i8","i16","i32","i64","i128","f32","f64"],At=function(){function r(){this.offset=0,this.buffer_size=256,this.buffer=new ArrayBuffer(this.buffer_size),this.view=new DataView(this.buffer)}return r.prototype.resize_if_necessary=function(e){if(this.buffer_size-this.offset<e){this.buffer_size=Math.max(this.buffer_size*2,this.buffer_size+e);var t=new ArrayBuffer(this.buffer_size);new Uint8Array(t).set(new Uint8Array(this.buffer)),this.buffer=t,this.view=new DataView(t)}},r.prototype.get_used_buffer=function(){return new Uint8Array(this.buffer).slice(0,this.offset)},r.prototype.store_value=function(e,t){var n=t.substring(1),i=parseInt(n)/8;this.resize_if_necessary(i);var o=t[0]==="f"?"setFloat".concat(n):t[0]==="i"?"setInt".concat(n):"setUint".concat(n);this.view[o](this.offset,e,!0),this.offset+=i},r.prototype.store_bytes=function(e){this.resize_if_necessary(e.length),new Uint8Array(this.buffer).set(new Uint8Array(e),this.offset),this.offset+=e.length},r}(),It=function(){function r(e){this.offset=0,this.buffer_size=e.length,this.buffer=new ArrayBuffer(e.length),new Uint8Array(this.buffer).set(e),this.view=new DataView(this.buffer)}return r.prototype.assert_enough_buffer=function(e){if(this.offset+e>this.buffer.byteLength)throw new Error("Error in schema, the buffer is smaller than expected")},r.prototype.consume_value=function(e){var t=e.substring(1),n=parseInt(t)/8;this.assert_enough_buffer(n);var i=e[0]==="f"?"getFloat".concat(t):e[0]==="i"?"getInt".concat(t):"getUint".concat(t),o=this.view[i](this.offset,!0);return this.offset+=n,o},r.prototype.consume_bytes=function(e){this.assert_enough_buffer(e);var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},r}(),Ft=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();function Lt(r){return Array.isArray(r)||!!r&&typeof r=="object"&&"length"in r&&typeof r.length=="number"&&(r.length===0||r.length>0&&r.length-1 in r)}function De(r,e,t){if(typeof r!==e)throw new Error("Expected ".concat(e," not ").concat(typeof r,"(").concat(r,") at ").concat(t.join(".")))}function Mt(r,e){var t=["number","string","bigint","boolean"].includes(typeof r),n=typeof r=="object"&&r!==null&&"toString"in r;if(!t&&!n)throw new Error("Expected bigint, number, boolean or string not ".concat(typeof r,"(").concat(r,") at ").concat(e.join(".")))}function Mr(r,e,t){if(r!==e)throw new Error("Array length ".concat(r," does not match schema length ").concat(e," at ").concat(t.join(".")))}function Rt(r,e){if(typeof r!="object"||r===null)throw new Error("Expected object not ".concat(typeof r,"(").concat(r,") at ").concat(e.join(".")))}var Rr=Er.concat(["bool","string"]),Zr=["option","enum","array","set","map","struct"],Qe=function(r){Ft(e,r);function e(t,n){var i="Invalid schema: ".concat(JSON.stringify(t)," expected ").concat(n);return r.call(this,i)||this}return e}(Error);function Ie(r){if(!(typeof r=="string"&&Rr.includes(r))){if(r&&typeof r=="object"){var e=Object.keys(r);if(e.length===1&&Zr.includes(e[0])){var t=e[0];if(t==="option")return Ie(r[t]);if(t==="enum")return Zt(r[t]);if(t==="array")return zt(r[t]);if(t==="set")return Ie(r[t]);if(t==="map")return Ut(r[t]);if(t==="struct")return Yt(r[t])}}throw new Qe(r,Zr.join(", ")+" or "+Rr.join(", "))}}function Zt(r){if(!Array.isArray(r))throw new Qe(r,"Array");for(var e=0,t=r;e<t.length;e++){var n=t[e];if(typeof n!="object"||!("struct"in n))throw new Error('Missing "struct" key in enum schema');if(typeof n.struct!="object"||Object.keys(n.struct).length!==1)throw new Error('The "struct" in each enum must have a single key');Ie({struct:n.struct})}}function zt(r){if(typeof r!="object")throw new Qe(r,"{ type, len? }");if(r.len&&typeof r.len!="number")throw new Error("Invalid schema: ".concat(r));if("type"in r)return Ie(r.type);throw new Qe(r,"{ type, len? }")}function Ut(r){if(typeof r=="object"&&"key"in r&&"value"in r)Ie(r.key),Ie(r.value);else throw new Qe(r,"{ key, value }")}function Yt(r){if(typeof r!="object")throw new Qe(r,"object");for(var e in r)Ie(r[e])}var Nt=function(){function r(e){this.encoded=new At,this.fieldPath=["value"],this.checkTypes=e}return r.prototype.encode=function(e,t){return this.encode_value(e,t),this.encoded.get_used_buffer()},r.prototype.encode_value=function(e,t){if(typeof t=="string"){if(Er.includes(t))return this.encode_integer(e,t);if(t==="string")return this.encode_string(e);if(t==="bool")return this.encode_boolean(e)}if(typeof t=="object"){if("option"in t)return this.encode_option(e,t);if("enum"in t)return this.encode_enum(e,t);if("array"in t)return this.encode_array(e,t);if("set"in t)return this.encode_set(e,t);if("map"in t)return this.encode_map(e,t);if("struct"in t)return this.encode_struct(e,t)}},r.prototype.encode_integer=function(e,t){var n=parseInt(t.substring(1));n<=32||t=="f64"?(this.checkTypes&&De(e,"number",this.fieldPath),this.encoded.store_value(e,t)):(this.checkTypes&&Mt(e,this.fieldPath),this.encode_bigint(BigInt(e),n))},r.prototype.encode_bigint=function(e,t){for(var n=t/8,i=new Uint8Array(n),o=0;o<n;o++)i[o]=Number(e&BigInt(255)),e=e>>BigInt(8);this.encoded.store_bytes(new Uint8Array(i))},r.prototype.encode_string=function(e){this.checkTypes&&De(e,"string",this.fieldPath);for(var t=e,n=[],i=0;i<t.length;i++){var o=t.charCodeAt(i);o<128?n.push(o):o<2048?n.push(192|o>>6,128|o&63):o<55296||o>=57344?n.push(224|o>>12,128|o>>6&63,128|o&63):(i++,o=65536+((o&1023)<<10|t.charCodeAt(i)&1023),n.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63))}this.encoded.store_value(n.length,"u32"),this.encoded.store_bytes(new Uint8Array(n))},r.prototype.encode_boolean=function(e){this.checkTypes&&De(e,"boolean",this.fieldPath),this.encoded.store_value(e?1:0,"u8")},r.prototype.encode_option=function(e,t){e==null?this.encoded.store_value(0,"u8"):(this.encoded.store_value(1,"u8"),this.encode_value(e,t.option))},r.prototype.encode_enum=function(e,t){this.checkTypes&&Rt(e,this.fieldPath);for(var n=Object.keys(e)[0],i=0;i<t.enum.length;i++){var o=t.enum[i];if(n===Object.keys(o.struct)[0])return this.encoded.store_value(i,"u8"),this.encode_struct(e,o)}throw new Error("Enum key (".concat(n,") not found in enum schema: ").concat(JSON.stringify(t)," at ").concat(this.fieldPath.join(".")))},r.prototype.encode_array=function(e,t){if(Lt(e))return this.encode_arraylike(e,t);if(e instanceof ArrayBuffer)return this.encode_buffer(e,t);throw new Error("Expected Array-like not ".concat(typeof e,"(").concat(e,") at ").concat(this.fieldPath.join(".")))},r.prototype.encode_arraylike=function(e,t){t.array.len?Mr(e.length,t.array.len,this.fieldPath):this.encoded.store_value(e.length,"u32");for(var n=0;n<e.length;n++)this.encode_value(e[n],t.array.type)},r.prototype.encode_buffer=function(e,t){t.array.len?Mr(e.byteLength,t.array.len,this.fieldPath):this.encoded.store_value(e.byteLength,"u32"),this.encoded.store_bytes(new Uint8Array(e))},r.prototype.encode_set=function(e,t){this.checkTypes&&De(e,"object",this.fieldPath);var n=e instanceof Set,i=n?Array.from(e.values()):Object.values(e);this.encoded.store_value(i.length,"u32");for(var o=0,f=i;o<f.length;o++){var y=f[o];this.encode_value(y,t.set)}},r.prototype.encode_map=function(e,t){this.checkTypes&&De(e,"object",this.fieldPath);var n=e instanceof Map,i=n?Array.from(e.keys()):Object.keys(e);this.encoded.store_value(i.length,"u32");for(var o=0,f=i;o<f.length;o++){var y=f[o];this.encode_value(y,t.map.key),this.encode_value(n?e.get(y):e[y],t.map.value)}},r.prototype.encode_struct=function(e,t){this.checkTypes&&De(e,"object",this.fieldPath);for(var n=0,i=Object.keys(t.struct);n<i.length;n++){var o=i[n];this.fieldPath.push(o),this.encode_value(e[o],t.struct[o]),this.fieldPath.pop()}},r}(),Bt=function(){function r(e){this.buffer=new It(e)}return r.prototype.decode=function(e){return this.decode_value(e)},r.prototype.decode_value=function(e){if(typeof e=="string"){if(Er.includes(e))return this.decode_integer(e);if(e==="string")return this.decode_string();if(e==="bool")return this.decode_boolean()}if(typeof e=="object"){if("option"in e)return this.decode_option(e);if("enum"in e)return this.decode_enum(e);if("array"in e)return this.decode_array(e);if("set"in e)return this.decode_set(e);if("map"in e)return this.decode_map(e);if("struct"in e)return this.decode_struct(e)}throw new Error("Unsupported type: ".concat(e))},r.prototype.decode_integer=function(e){var t=parseInt(e.substring(1));return t<=32||e=="f64"?this.buffer.consume_value(e):this.decode_bigint(t,e.startsWith("i"))},r.prototype.decode_bigint=function(e,t){t===void 0&&(t=!1);var n=e/8,i=new Uint8Array(this.buffer.consume_bytes(n)),o=i.reduceRight(function(f,y){return f+y.toString(16).padStart(2,"0")},"");return t&&i[n-1]?BigInt.asIntN(e,BigInt("0x".concat(o))):BigInt("0x".concat(o))},r.prototype.decode_string=function(){for(var e=this.decode_integer("u32"),t=new Uint8Array(this.buffer.consume_bytes(e)),n=[],i=0;i<e;++i){var o=t[i];if(o<128)n.push(o);else if(o<224)n.push((o&31)<<6|t[++i]&63);else if(o<240)n.push((o&15)<<12|(t[++i]&63)<<6|t[++i]&63);else{var f=(o&7)<<18|(t[++i]&63)<<12|(t[++i]&63)<<6|t[++i]&63;n.push(f)}}return String.fromCodePoint.apply(String,n)},r.prototype.decode_boolean=function(){return this.buffer.consume_value("u8")>0},r.prototype.decode_option=function(e){var t=this.buffer.consume_value("u8");if(t===1)return this.decode_value(e.option);if(t!==0)throw new Error("Invalid option ".concat(t));return null},r.prototype.decode_enum=function(e){var t,n=this.buffer.consume_value("u8");if(n>e.enum.length)throw new Error("Enum option ".concat(n," is not available"));var i=e.enum[n].struct,o=Object.keys(i)[0];return t={},t[o]=this.decode_value(i[o]),t},r.prototype.decode_array=function(e){for(var t=[],n=e.array.len?e.array.len:this.decode_integer("u32"),i=0;i<n;++i)t.push(this.decode_value(e.array.type));return t},r.prototype.decode_set=function(e){for(var t=this.decode_integer("u32"),n=new Set,i=0;i<t;++i)n.add(this.decode_value(e.set));return n},r.prototype.decode_map=function(e){for(var t=this.decode_integer("u32"),n=new Map,i=0;i<t;++i){var o=this.decode_value(e.map.key),f=this.decode_value(e.map.value);n.set(o,f)}return n},r.prototype.decode_struct=function(e){var t={};for(var n in e.struct)t[n]=this.decode_value(e.struct[n]);return t},r}();function Gt(r,e,t){t===void 0&&(t=!0),t&&Ie(r);var n=new Nt(t);return n.encode(e,r)}function Xt(r,e,t){t===void 0&&(t=!0),t&&Ie(r);var n=new Bt(e);return n.decode(r)}var ue=Uint8Array,ge=Uint16Array,Wr=Int32Array,vr=new ue([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wr=new ue([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_r=new ue([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$r=function(r,e){for(var t=new ge(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Wr(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},qr=$r(vr,2),et=qr.b,xr=qr.r;et[28]=258,xr[258]=28;var rt=$r(wr,0),Ht=rt.b,zr=rt.r,Or=new ge(32768);for(var B=0;B<32768;++B){var ze=(B&43690)>>1|(B&21845)<<1;ze=(ze&52428)>>2|(ze&13107)<<2,ze=(ze&61680)>>4|(ze&3855)<<4,Or[B]=((ze&65280)>>8|(ze&255)<<8)>>1}var Pe=function(r,e,t){for(var n=r.length,i=0,o=new ge(e);i<n;++i)r[i]&&++o[r[i]-1];var f=new ge(e);for(i=1;i<e;++i)f[i]=f[i-1]+o[i-1]<<1;var y;if(t){y=new ge(1<<e);var g=15-e;for(i=0;i<n;++i)if(r[i])for(var P=i<<4|r[i],v=e-r[i],m=f[r[i]-1]++<<v,T=m|(1<<v)-1;m<=T;++m)y[Or[m]>>g]=P}else for(y=new ge(n),i=0;i<n;++i)r[i]&&(y[i]=Or[f[r[i]-1]++]>>15-r[i]);return y},Ne=new ue(288);for(var B=0;B<144;++B)Ne[B]=8;for(var B=144;B<256;++B)Ne[B]=9;for(var B=256;B<280;++B)Ne[B]=7;for(var B=280;B<288;++B)Ne[B]=8;var or=new ue(32);for(var B=0;B<32;++B)or[B]=5;var Ct=Pe(Ne,9,0),Dt=Pe(Ne,9,1),Vt=Pe(or,5,0),Kt=Pe(or,5,1),mr=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},Te=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},gr=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Sr=function(r){return(r+7)/8|0},tt=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new ue(r.subarray(e,t))},Qt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],me=function(r,e,t){var n=new Error(e||Qt[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,me),!t)throw n;return n},jr=function(r,e,t,n){var i=r.length,o=0;if(!i||e.f&&!e.l)return t||new ue(0);var f=!t,y=f||e.i!=2,g=e.i;f&&(t=new ue(i*3));var P=function(Be){var Ge=t.length;if(Be>Ge){var Re=new ue(Math.max(Ge*2,Be));Re.set(t),t=Re}},v=e.f||0,m=e.p||0,T=e.b||0,U=e.l,re=e.d,G=e.m,V=e.n,ye=i*8;do{if(!U){v=Te(r,m,1);var C=Te(r,m+1,3);if(m+=3,C)if(C==1)U=Dt,re=Kt,G=9,V=5;else if(C==2){var J=Te(r,m,31)+257,K=Te(r,m+10,15)+4,A=J+Te(r,m+5,31)+1;m+=14;for(var _=new ue(A),$=new ue(19),H=0;H<K;++H)$[_r[H]]=Te(r,m+H*3,7);m+=K*3;for(var q=mr($),We=(1<<q)-1,ae=Pe($,q,1),H=0;H<A;){var se=ae[Te(r,m,We)];m+=se&15;var Y=se>>4;if(Y<16)_[H++]=Y;else{var ee=0,z=0;for(Y==16?(z=3+Te(r,m,3),m+=2,ee=_[H-1]):Y==17?(z=3+Te(r,m,7),m+=3):Y==18&&(z=11+Te(r,m,127),m+=7);z--;)_[H++]=ee}}var ie=_.subarray(0,J),Q=_.subarray(J);G=mr(ie),V=mr(Q),U=Pe(ie,G,1),re=Pe(Q,V,1)}else me(1);else{var Y=Sr(m)+4,te=r[Y-4]|r[Y-3]<<8,ne=Y+te;if(ne>i){g&&me(0);break}y&&P(T+te),t.set(r.subarray(Y,ne),T),e.b=T+=te,e.p=m=ne*8,e.f=v;continue}if(m>ye){g&&me(0);break}}y&&P(T+131072);for(var Fe=(1<<G)-1,ce=(1<<V)-1,be=m;;be=m){var ee=U[gr(r,m)&Fe],le=ee>>4;if(m+=ee&15,m>ye){g&&me(0);break}if(ee||me(2),le<256)t[T++]=le;else if(le==256){be=m,U=null;break}else{var he=le-254;if(le>264){var H=le-257,X=vr[H];he=Te(r,m,(1<<X)-1)+et[H],m+=X}var ke=re[gr(r,m)&ce],Le=ke>>4;ke||me(3),m+=ke&15;var Q=Ht[Le];if(Le>3){var X=wr[Le];Q+=gr(r,m)&(1<<X)-1,m+=X}if(m>ye){g&&me(0);break}y&&P(T+131072);var Me=T+he;if(T<Q){var Xe=o-Q,He=Math.min(Q,Me);for(Xe+T<0&&me(3);T<He;++T)t[T]=n[Xe+T]}for(;T<Me;++T)t[T]=t[T-Q]}}e.l=U,e.p=be,e.b=T,e.f=v,U&&(v=1,e.m=G,e.d=re,e.n=V)}while(!v);return T!=t.length&&f?tt(t,0,T):t.subarray(0,T)},Ae=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8},$e=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8,r[n+2]|=t>>16},br=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var i=t.length,o=t.slice();if(!i)return{t:it,l:0};if(i==1){var f=new ue(t[0].s+1);return f[t[0].s]=1,{t:f,l:1}}t.sort(function(ne,J){return ne.f-J.f}),t.push({s:-1,f:25001});var y=t[0],g=t[1],P=0,v=1,m=2;for(t[0]={s:-1,f:y.f+g.f,l:y,r:g};v!=i-1;)y=t[t[P].f<t[m].f?P++:m++],g=t[P!=v&&t[P].f<t[m].f?P++:m++],t[v++]={s:-1,f:y.f+g.f,l:y,r:g};for(var T=o[0].s,n=1;n<i;++n)o[n].s>T&&(T=o[n].s);var U=new ge(T+1),re=Tr(t[v-1],U,0);if(re>e){var n=0,G=0,V=re-e,ye=1<<V;for(o.sort(function(J,K){return U[K.s]-U[J.s]||J.f-K.f});n<i;++n){var C=o[n].s;if(U[C]>e)G+=ye-(1<<re-U[C]),U[C]=e;else break}for(G>>=V;G>0;){var Y=o[n].s;U[Y]<e?G-=1<<e-U[Y]++-1:++n}for(;n>=0&&G;--n){var te=o[n].s;U[te]==e&&(--U[te],++G)}re=e}return{t:new ue(U),l:re}},Tr=function(r,e,t){return r.s==-1?Math.max(Tr(r.l,e,t+1),Tr(r.r,e,t+1)):e[r.s]=t},Ur=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new ge(++e),n=0,i=r[0],o=1,f=function(g){t[n++]=g},y=1;y<=e;++y)if(r[y]==i&&y!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)f(32754);o>2&&(f(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(f(i),--o;o>6;o-=6)f(8304);o>2&&(f(o-3<<5|8208),o=0)}for(;o--;)f(i);o=1,i=r[y]}return{c:t.subarray(0,n),n:e}},qe=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},nt=function(r,e,t){var n=t.length,i=Sr(e+2);r[i]=n&255,r[i+1]=n>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var o=0;o<n;++o)r[i+o+4]=t[o];return(i+4+n)*8},Yr=function(r,e,t,n,i,o,f,y,g,P,v){Ae(e,v++,t),++i[256];for(var m=br(i,15),T=m.t,U=m.l,re=br(o,15),G=re.t,V=re.l,ye=Ur(T),C=ye.c,Y=ye.n,te=Ur(G),ne=te.c,J=te.n,K=new ge(19),A=0;A<C.length;++A)++K[C[A]&31];for(var A=0;A<ne.length;++A)++K[ne[A]&31];for(var _=br(K,7),$=_.t,H=_.l,q=19;q>4&&!$[_r[q-1]];--q);var We=P+5<<3,ae=qe(i,Ne)+qe(o,or)+f,se=qe(i,T)+qe(o,G)+f+14+3*q+qe(K,$)+2*K[16]+3*K[17]+7*K[18];if(g>=0&&We<=ae&&We<=se)return nt(e,v,r.subarray(g,g+P));var ee,z,ie,Q;if(Ae(e,v,1+(se<ae)),v+=2,se<ae){ee=Pe(T,U,0),z=T,ie=Pe(G,V,0),Q=G;var Fe=Pe($,H,0);Ae(e,v,Y-257),Ae(e,v+5,J-1),Ae(e,v+10,q-4),v+=14;for(var A=0;A<q;++A)Ae(e,v+3*A,$[_r[A]]);v+=3*q;for(var ce=[C,ne],be=0;be<2;++be)for(var le=ce[be],A=0;A<le.length;++A){var he=le[A]&31;Ae(e,v,Fe[he]),v+=$[he],he>15&&(Ae(e,v,le[A]>>5&127),v+=le[A]>>12)}}else ee=Ct,z=Ne,ie=Vt,Q=or;for(var A=0;A<y;++A){var X=n[A];if(X>255){var he=X>>18&31;$e(e,v,ee[he+257]),v+=z[he+257],he>7&&(Ae(e,v,X>>23&31),v+=vr[he]);var ke=X&31;$e(e,v,ie[ke]),v+=Q[ke],ke>3&&($e(e,v,X>>5&8191),v+=wr[ke])}else $e(e,v,ee[X]),v+=z[X]}return $e(e,v,ee[256]),v+z[256]},Jt=new Wr([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),it=new ue(0),$t=function(r,e,t,n,i,o){var f=o.z||r.length,y=new ue(n+f+5*(1+Math.ceil(f/7e3))+i),g=y.subarray(n,y.length-i),P=o.l,v=(o.r||0)&7;if(e){v&&(g[0]=o.r>>3);for(var m=Jt[e-1],T=m>>13,U=m&8191,re=(1<<t)-1,G=o.p||new ge(32768),V=o.h||new ge(re+1),ye=Math.ceil(t/3),C=2*ye,Y=function(Je){return(r[Je]^r[Je+1]<<ye^r[Je+2]<<C)&re},te=new Wr(25e3),ne=new ge(288),J=new ge(32),K=0,A=0,_=o.i||0,$=0,H=o.w||0,q=0;_+2<f;++_){var We=Y(_),ae=_&32767,se=V[We];if(G[ae]=se,V[We]=ae,H<=_){var ee=f-_;if((K>7e3||$>24576)&&(ee>423||!P)){v=Yr(r,g,0,te,ne,J,A,$,q,_-q,v),$=K=A=0,q=_;for(var z=0;z<286;++z)ne[z]=0;for(var z=0;z<30;++z)J[z]=0}var ie=2,Q=0,Fe=U,ce=ae-se&32767;if(ee>2&&We==Y(_-ce))for(var be=Math.min(T,ee)-1,le=Math.min(32767,_),he=Math.min(258,ee);ce<=le&&--Fe&&ae!=se;){if(r[_+ie]==r[_+ie-ce]){for(var X=0;X<he&&r[_+X]==r[_+X-ce];++X);if(X>ie){if(ie=X,Q=ce,X>be)break;for(var ke=Math.min(ce,X-2),Le=0,z=0;z<ke;++z){var Me=_-ce+z&32767,Xe=G[Me],He=Me-Xe&32767;He>Le&&(Le=He,se=Me)}}}ae=se,se=G[ae],ce+=ae-se&32767}if(Q){te[$++]=268435456|xr[ie]<<18|zr[Q];var Be=xr[ie]&31,Ge=zr[Q]&31;A+=vr[Be]+wr[Ge],++ne[257+Be],++J[Ge],H=_+ie,++K}else te[$++]=r[_],++ne[r[_]]}}for(_=Math.max(_,H);_<f;++_)te[$++]=r[_],++ne[r[_]];v=Yr(r,g,P,te,ne,J,A,$,q,_-q,v),P||(o.r=v&7|g[v/8|0]<<3,v-=7,o.h=V,o.p=G,o.i=_,o.w=H)}else{for(var _=o.w||0;_<f+P;_+=65535){var Re=_+65535;Re>=f&&(g[v/8|0]=P,Re=f),v=nt(g,v+1,r.subarray(_,Re))}o.i=f}return tt(y,0,n+Sr(v)+i)},qt=function(r,e,t,n,i){if(!i&&(i={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),f=new ue(o.length+r.length);f.set(o),f.set(r,o.length),r=f,i.w=o.length}return $t(r,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,t,n,i)},en=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&me(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},rn=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},tn=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&me(6,"invalid zlib data"),(r[1]>>5&1)==1&&me(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function nn(r,e){return qt(r,e||{},0,0)}function on(r,e){return jr(r,{i:2},e,e)}function an(r,e){var t=en(r);return t+8>r.length&&me(6,"invalid gzip data"),jr(r.subarray(t,-8),{i:2},new ue(rn(r)),e)}function sn(r,e){return jr(r.subarray(tn(r),-4),{i:2},e,e)}function un(r,e){return r[0]==31&&r[1]==139&&r[2]==8?an(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?on(r,e):sn(r,e)}var fn=typeof TextDecoder<"u"&&new TextDecoder,cn=0;try{fn.decode(it,{stream:!0}),cn=1}catch{}const ot=Object.freeze({struct:{id:"string",size:"i32",x:"i32",z:"i32",level:"u8",texture:{struct:{size:"i32",data:{array:{type:"u8"}}}}}}),Nr=r=>nn(Gt(ot,r),{level:9}),ln=r=>Xt(ot,un(r)),hn=r=>({type:"rgba",color:r}),dn=({seed:r,gameConfig:e,level:t})=>(1/(e.plotCount*(1/t.layer.level)),({x:n,z:i})=>{const o=e.plotCount**2,f=new Uint8Array(o*4);for(let P=0;P<o;P++){const v=P%e.plotCount,m=Math.floor(P/e.plotCount),T=hn([0,0,0,255]);f.set(T.color,((e.plotCount-1-m)*e.plotCount+v)*4)}const y=e.chunkSize*t.layer.level,g=e.chunkSize*(t.layer.level-1)/2;return{id:`${n}:${i}:${t.layer.level}`,x:n*y+g,z:i*y+g,size:y,level:t.layer.level,texture:{size:e.plotCount,data:f}}});async function pn({id:r,mapId:e,level:t,x:n,z:i}){const o=dn({gameConfig:Pt,seed:e,level:t}),f=`/chunk/${e}/${r}.bin`;return new Promise(y=>{Ke(f).exists().then(g=>{(g?lr(f,Nr(o({x:n,z:i}))).then(()=>!1):lr(f,Nr(o({x:n,z:i}))).then(()=>!1)).then(P=>{Ke(f).arrayBuffer().then(v=>{y({hit:P,chunk:ln(new Uint8Array(v))})})})})})}Tt.worker({chunkOf:pn});
