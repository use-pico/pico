var Or=r=>{throw TypeError(r)},Mr=(r,e,t)=>e.has(r)||Or("Cannot "+t),me=(r,e,t)=>(Mr(r,e,"read from private field"),t?t.call(r):e.get(r)),nt=(r,e,t)=>e.has(r)?Or("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),tt=(r,e,t,i)=>(Mr(r,e,"write to private field"),e.set(r,t),t);const Wr="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHUobil7aWYobj09PSIvIilyZXR1cm57cGFyZW50Om51bGwsbmFtZToiIn07Y29uc3QgZT1uLnNwbGl0KCIvIikuZmlsdGVyKGk9PmkubGVuZ3RoPjApO2lmKGUubGVuZ3RoPT09MCl0aHJvdyBFcnJvcigiSW52YWxpZCBwYXRoIik7Y29uc3QgYT1lW2UubGVuZ3RoLTFdLHI9Ii8iK2Uuc2xpY2UoMCwtMSkuam9pbigiLyIpO3JldHVybntuYW1lOmEscGFyZW50OnJ9fWFzeW5jIGZ1bmN0aW9uIHcobixlKXtjb25zdHtwYXJlbnQ6YSxuYW1lOnJ9PXUobik7aWYoYT09bnVsbClyZXR1cm4gYXdhaXQgbmF2aWdhdG9yLnN0b3JhZ2UuZ2V0RGlyZWN0b3J5KCk7Y29uc3QgaT1hLnNwbGl0KCIvIikuZmlsdGVyKHQ9PnQubGVuZ3RoPjApO3RyeXtsZXQgdD1hd2FpdCBuYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTtmb3IoY29uc3QgcyBvZiBpKXQ9YXdhaXQgdC5nZXREaXJlY3RvcnlIYW5kbGUocyx7Y3JlYXRlOmUuY3JlYXRlfSk7aWYoZS5pc0ZpbGUpcmV0dXJuIGF3YWl0IHQuZ2V0RmlsZUhhbmRsZShyLHtjcmVhdGU6ZS5jcmVhdGV9KX1jYXRjaCh0KXtpZih0Lm5hbWU9PT0iTm90Rm91bmRFcnJvciIpcmV0dXJuIG51bGw7dGhyb3cgdH19Y29uc3QgZj17fTtzZWxmLm9ubWVzc2FnZT1hc3luYyBuPT57dmFyIGk7Y29uc3R7ZXZ0VHlwZTplLGFyZ3M6YX09bi5kYXRhO2xldCByPWZbYS5maWxlSWRdO3RyeXtsZXQgdDtjb25zdCBzPVtdO2lmKGU9PT0icmVnaXN0ZXIiKXtjb25zdCBsPWF3YWl0IHcoYS5maWxlUGF0aCx7Y3JlYXRlOiEwLGlzRmlsZTohMH0pO2lmKGw9PW51bGwpdGhyb3cgRXJyb3IoYG5vdCBmb3VuZCBmaWxlOiAke2EuZmlsZUlkfWApO3I9YXdhaXQgbC5jcmVhdGVTeW5jQWNjZXNzSGFuZGxlKHttb2RlOmEubW9kZX0pLGZbYS5maWxlSWRdPXJ9ZWxzZSBpZihlPT09ImNsb3NlIilhd2FpdCByLmNsb3NlKCksZGVsZXRlIGZbYS5maWxlSWRdO2Vsc2UgaWYoZT09PSJ0cnVuY2F0ZSIpYXdhaXQgci50cnVuY2F0ZShhLm5ld1NpemUpO2Vsc2UgaWYoZT09PSJ3cml0ZSIpe2NvbnN0e2RhdGE6bCxvcHRzOm99PW4uZGF0YS5hcmdzO3Q9YXdhaXQgci53cml0ZShsLG8pfWVsc2UgaWYoZT09PSJyZWFkIil7Y29uc3R7b2Zmc2V0Omwsc2l6ZTpvfT1uLmRhdGEuYXJncyxnPW5ldyBVaW50OEFycmF5KG8pLGQ9YXdhaXQgci5yZWFkKGcse2F0Omx9KSxjPWcuYnVmZmVyO3Q9ZD09PW8/YzooKGk9Yy50cmFuc2Zlcik9PW51bGw/dm9pZCAwOmkuY2FsbChjLGQpKT8/Yy5zbGljZSgwLGQpLHMucHVzaCh0KX1lbHNlIGU9PT0iZ2V0U2l6ZSI/dD1hd2FpdCByLmdldFNpemUoKTplPT09ImZsdXNoIiYmYXdhaXQgci5mbHVzaCgpO3NlbGYucG9zdE1lc3NhZ2Uoe2V2dFR5cGU6ImNhbGxiYWNrIixjYklkOm4uZGF0YS5jYklkLHJldHVyblZhbDp0fSxzKX1jYXRjaCh0KXtjb25zdCBzPXQ7c2VsZi5wb3N0TWVzc2FnZSh7ZXZ0VHlwZToidGhyb3dFcnJvciIsY2JJZDpuLmRhdGEuY2JJZCxlcnJNc2c6cy5uYW1lKyI6ICIrcy5tZXNzYWdlK2AKYCtKU09OLnN0cmluZ2lmeShuLmRhdGEpfSl9fX0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPW9wZnMtd29ya2VyLUY0UldscWNfLmpzLm1hcAo=",Yr=r=>Uint8Array.from(atob(r),e=>e.charCodeAt(0)),hr=typeof self<"u"&&self.Blob&&new Blob([Yr(Wr)],{type:"text/javascript;charset=utf-8"});function Ur(r){let e;try{if(e=hr&&(self.URL||self.webkitURL).createObjectURL(hr),!e)throw"";const t=new Worker(e,{name:r?.name});return t.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:text/javascript;base64,"+Wr,{name:r?.name})}finally{e&&(self.URL||self.webkitURL).revokeObjectURL(e)}}async function Vr(r,e,t){const i=Hr();return await i("register",{fileId:r,filePath:e,mode:t}),{read:async(o,n)=>await i("read",{fileId:r,offset:o,size:n}),write:async(o,n)=>await i("write",{fileId:r,data:o,opts:n},[ArrayBuffer.isView(o)?o.buffer:o]),close:async()=>await i("close",{fileId:r}),truncate:async o=>await i("truncate",{fileId:r,newSize:o}),getSize:async()=>await i("getSize",{fileId:r}),flush:async()=>await i("flush",{fileId:r})}}const Zt=[];let Kt=0;function Hr(){if(Zt.length<3){const e=r();return Zt.push(e),e}else{const e=Zt[Kt];return Kt=(Kt+1)%Zt.length,e}function r(){const e=new Ur;let t=0,i={};return e.onmessage=({data:o})=>{var n,s;o.evtType==="callback"?(n=i[o.cbId])==null||n.resolve(o.returnVal):o.evtType==="throwError"&&((s=i[o.cbId])==null||s.reject(Error(o.errMsg))),delete i[o.cbId]},async function(o,n,s=[]){t+=1;const a=new Promise((c,h)=>{i[t]={resolve:c,reject:h}});return e.postMessage({cbId:t,evtType:o,args:n},s),a}}}function qt(r){if(r==="/")return{parent:null,name:""};const e=r.split("/").filter(o=>o.length>0);if(e.length===0)throw Error("Invalid path");const t=e[e.length-1],i="/"+e.slice(0,-1).join("/");return{name:t,parent:i}}async function gt(r,e){const{parent:t,name:i}=qt(r);if(t==null)return await navigator.storage.getDirectory();const o=t.split("/").filter(n=>n.length>0);try{let n=await navigator.storage.getDirectory();for(const s of o)n=await n.getDirectoryHandle(s,{create:e.create});return e.isFile?await n.getFileHandle(i,{create:e.create}):await n.getDirectoryHandle(i,{create:e.create})}catch(n){if(n.name==="NotFoundError")return null;throw n}}async function Pr(r){const{parent:e,name:t}=qt(r);if(e==null){const o=await navigator.storage.getDirectory();for await(const n of o.keys())await o.removeEntry(n,{recursive:!0});return}const i=await gt(e,{create:!1,isFile:!1});i!=null&&await i.removeEntry(t,{recursive:!0})}function nr(r,e){return`${r}/${e}`.replace("//","/")}function St(r){return new Rr(r)}var st,Xt,jt;const Qr=class Fr{constructor(e){nt(this,st),nt(this,Xt),nt(this,jt),tt(this,st,e);const{parent:t,name:i}=qt(e);tt(this,Xt,i),tt(this,jt,t)}get kind(){return"dir"}get name(){return me(this,Xt)}get path(){return me(this,st)}get parent(){return me(this,jt)==null?null:St(me(this,jt))}async create(){return await gt(me(this,st),{create:!0,isFile:!1}),St(me(this,st))}async exists(){return await gt(me(this,st),{create:!1,isFile:!1})instanceof FileSystemDirectoryHandle}async remove(){for(const e of await this.children())try{await e.remove()}catch(t){console.warn(t)}try{await Pr(me(this,st))}catch(e){console.warn(e)}}async children(){const e=await gt(me(this,st),{create:!1,isFile:!1});if(e==null)return[];const t=[];for await(const i of e.values())t.push((i.kind==="file"?Tt:St)(nr(me(this,st),i.name)));return t}async copyTo(e){if(!await this.exists())throw Error(`dir ${this.path} not exists`);if(e instanceof Fr){const t=await e.exists()?St(nr(e.path,this.name)):e;await t.create(),await Promise.all((await this.children()).map(i=>i.copyTo(t)));return}else if(e instanceof FileSystemDirectoryHandle){await Promise.all((await this.children()).map(async t=>{t.kind==="file"?await t.copyTo(await e.getFileHandle(t.name,{create:!0})):await t.copyTo(await e.getDirectoryHandle(t.name,{create:!0}))}));return}throw Error("Illegal target type")}async moveTo(e){await this.copyTo(e),await this.remove()}};st=new WeakMap,Xt=new WeakMap,jt=new WeakMap;let Rr=Qr;const pr=new Map;function Tt(r,e="rw"){if(e==="rw"){const t=pr.get(r)??new Qt(r,e);return pr.set(r,t),t}return new Qt(r,e)}async function Ht(r,e,t={overwrite:!0}){if(e instanceof Qt){await Ht(r,await e.stream(),t);return}const i=await(r instanceof Qt?r:Tt(r,"rw")).createWriter();try{if(t.overwrite&&await i.truncate(0),e instanceof ReadableStream){const o=e.getReader();for(;;){const{done:n,value:s}=await o.read();if(n)break;await i.write(s)}}else await i.write(e)}catch(o){throw o}finally{await i.close()}}let qr=0;const $r=()=>++qr;var at,At,Yt,It,Ut,vt,Vt,Lt;const Jr=class Er{constructor(e,t){nt(this,at),nt(this,At),nt(this,Yt),nt(this,It),nt(this,Ut),nt(this,vt,0),nt(this,Vt,(()=>{let n=null;return()=>(tt(this,vt,me(this,vt)+1),n??(n=new Promise(async(s,a)=>{try{const c=await Vr(me(this,Ut),me(this,at),me(this,It));s([c,async()=>{tt(this,vt,me(this,vt)-1),!(me(this,vt)>0)&&(n=null,await c.close())}])}catch(c){a(c)}})))})()),nt(this,Lt,!1),tt(this,Ut,$r()),tt(this,at,e),tt(this,It,{r:"read-only",rw:"readwrite","rw-unsafe":"readwrite-unsafe"}[t]);const{parent:i,name:o}=qt(e);if(i==null)throw Error("Invalid path");tt(this,Yt,o),tt(this,At,i)}get kind(){return"file"}get path(){return me(this,at)}get name(){return me(this,Yt)}get parent(){return me(this,At)==null?null:St(me(this,At))}async createWriter(){if(me(this,It)==="read-only")throw Error("file is read-only");if(me(this,Lt))throw Error("Other writer have not been closed");tt(this,Lt,!0);const e=new TextEncoder,[t,i]=await me(this,Vt).call(this);let o=await t.getSize(),n=!1;return{write:async(s,a={})=>{if(n)throw Error("Writer is closed");const c=typeof s=="string"?e.encode(s):s,h=a.at??o,f=c.byteLength;return o=h+f,await t.write(c,{at:h})},truncate:async s=>{if(n)throw Error("Writer is closed");await t.truncate(s),o>s&&(o=s)},flush:async()=>{if(n)throw Error("Writer is closed");await t.flush()},close:async()=>{if(n)throw Error("Writer is closed");n=!0,tt(this,Lt,!1),await i()}}}async createReader(){const[e,t]=await me(this,Vt).call(this);let i=!1,o=0;return{read:async(n,s={})=>{if(i)throw Error("Reader is closed");const a=s.at??o,c=await e.read(a,n);return o=a+c.byteLength,c},getSize:async()=>{if(i)throw Error("Reader is closed");return await e.getSize()},close:async()=>{i||(i=!0,await t())}}}async text(){return new TextDecoder().decode(await this.arrayBuffer())}async arrayBuffer(){const e=await gt(me(this,at),{create:!1,isFile:!0});return e==null?new ArrayBuffer(0):(await e.getFile()).arrayBuffer()}async stream(){const e=await this.getOriginFile();return e==null?new ReadableStream({pull:t=>{t.close()}}):e.stream()}async getOriginFile(){var e;return(e=await gt(me(this,at),{create:!1,isFile:!0}))==null?void 0:e.getFile()}async getSize(){const e=await gt(me(this,at),{create:!1,isFile:!0});return e==null?0:(await e.getFile()).size}async exists(){return await gt(me(this,at),{create:!1,isFile:!0})instanceof FileSystemFileHandle}async remove(){if(me(this,vt))throw Error("exists unclosed reader/writer");await Pr(me(this,at))}async copyTo(e){if(e instanceof Er){if(e.path===this.path)return;await Ht(e.path,this);return}else if(e instanceof Rr){if(!await this.exists())throw Error(`file ${this.path} not exists`);return await this.copyTo(Tt(nr(e.path,this.name)))}else if(e instanceof FileSystemFileHandle){await(await this.stream()).pipeTo(await e.createWritable());return}throw Error("Illegal target type")}async moveTo(e){await this.copyTo(e),await this.remove()}};at=new WeakMap,At=new WeakMap,Yt=new WeakMap,It=new WeakMap,Ut=new WeakMap,vt=new WeakMap,Vt=new WeakMap,Lt=new WeakMap;let Qt=Jr;const Dr="/.opfs-tools-temp-dir";async function jr(r){try{if(r.kind==="file"){if(!await r.exists())return!0;const e=await r.createWriter();await e.truncate(0),await e.close(),await r.remove()}else await r.remove();return!0}catch(e){return console.warn(e),!1}}function Kr(){setInterval(async()=>{for(const r of await St(Dr).children()){const e=/^\d+-(\d+)$/.exec(r.name);(e==null||Date.now()-Number(e[1])>2592e5)&&await jr(r)}},60*1e3)}const dr=[];let mr=!1;async function en(){if(globalThis.localStorage==null)return;const r="OPFS_TOOLS_EXPIRES_TMP_FILES";mr||(mr=!0,globalThis.addEventListener("unload",()=>{dr.length!==0&&localStorage.setItem(r,`${localStorage.getItem(r)??""},${dr.join(",")}`)}));let e=localStorage.getItem(r)??"";for(const t of e.split(","))t.length!==0&&await jr(Tt(`${Dr}/${t}`))&&(e=e.replace(t,""));localStorage.setItem(r,e.replace(/,{2,}/g,","))}(async function(){var r;globalThis.__opfs_tools_tmpfile_init__!==!0&&(globalThis.__opfs_tools_tmpfile_init__=!0,!(globalThis.FileSystemDirectoryHandle==null||globalThis.FileSystemFileHandle==null||((r=globalThis.navigator)==null?void 0:r.storage.getDirectory)==null)&&(Kr(),await en()))})();function tn(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var o=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:function(){return r[i]}})}),t}var Nt={exports:{}},rn={},nn=Object.freeze({__proto__:null,default:rn}),bt=tn(nn);/**
 * workerpool.js
 * https://github.com/josdejong/workerpool
 *
 * Offload tasks to a pool of workers on node.js and in the browser.
 *
 * @version 9.2.0
 * @date    2024-10-11
 *
 * @license
 * Copyright (C) 2014-2022 Jos de Jong <wjosdejong@gmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */var on=Nt.exports,yr;function sn(){return yr||(yr=1,function(r,e){(function(t,i){i(e)})(on,function(t){var i={},o={exports:{}};(function(O){var F=function(Q){return typeof Q<"u"&&Q.versions!=null&&Q.versions.node!=null&&Q+""=="[object process]"};O.exports.isNode=F,O.exports.platform=typeof process<"u"&&F(process)?"node":"browser";var E=O.exports.platform==="node"&&bt;O.exports.isMainThread=O.exports.platform==="node"?(!E||E.isMainThread)&&!process.connected:typeof Window<"u",O.exports.cpus=O.exports.platform==="browser"?self.navigator.hardwareConcurrency:bt.cpus().length})(o);var n=o.exports,s={},a;function c(){if(a)return s;a=1;function O(Q,ye){var S=this;if(!(this instanceof O))throw new SyntaxError("Constructor must be called with the new operator");if(typeof Q!="function")throw new SyntaxError("Function parameter handler(resolve, reject) missing");var _e=[],he=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var Fe=function(T,B){_e.push(T),he.push(B)};this.then=function(R,T){return new O(function(B,re){var fe=R?F(R,B,re):B,Ce=T?F(T,B,re):re;Fe(fe,Ce)},S)};var ze=function(T){return S.resolved=!0,S.rejected=!1,S.pending=!1,_e.forEach(function(B){B(T)}),Fe=function(re,fe){re(T)},ze=D=function(){},S},D=function(T){return S.resolved=!1,S.rejected=!0,S.pending=!1,he.forEach(function(B){B(T)}),Fe=function(re,fe){fe(T)},ze=D=function(){},S};this.cancel=function(){return ye?ye.cancel():D(new E),S},this.timeout=function(R){if(ye)ye.timeout(R);else{var T=setTimeout(function(){D(new oe("Promise timed out after "+R+" ms"))},R);S.always(function(){clearTimeout(T)})}return S},Q(function(R){ze(R)},function(R){D(R)})}function F(Q,ye,S){return function(_e){try{var he=Q(_e);he&&typeof he.then=="function"&&typeof he.catch=="function"?he.then(ye,S):ye(he)}catch(Fe){S(Fe)}}}O.prototype.catch=function(Q){return this.then(null,Q)},O.prototype.always=function(Q){return this.then(Q,Q)},O.prototype.finally=function(Q){var ye=this,S=function(){return new O(function(he){return he()}).then(Q).then(function(){return ye})};return this.then(S,S)},O.all=function(Q){return new O(function(ye,S){var _e=Q.length,he=[];_e?Q.forEach(function(Fe,ze){Fe.then(function(D){he[ze]=D,_e--,_e==0&&ye(he)},function(D){_e=0,S(D)})}):ye(he)})},O.defer=function(){var Q={};return Q.promise=new O(function(ye,S){Q.resolve=ye,Q.reject=S}),Q};function E(Q){this.message=Q||"promise cancelled",this.stack=new Error().stack}E.prototype=new Error,E.prototype.constructor=Error,E.prototype.name="CancellationError",O.CancellationError=E;function oe(Q){this.message=Q||"timeout exceeded",this.stack=new Error().stack}return oe.prototype=new Error,oe.prototype.constructor=Error,oe.prototype.name="TimeoutError",O.TimeoutError=oe,s.Promise=O,s}function h(O,F){(F==null||F>O.length)&&(F=O.length);for(var E=0,oe=Array(F);E<F;E++)oe[E]=O[E];return oe}function f(O,F){var E=typeof Symbol<"u"&&O[Symbol.iterator]||O["@@iterator"];if(!E){if(Array.isArray(O)||(E=x(O))||F){E&&(O=E);var oe=0,Q=function(){};return{s:Q,n:function(){return oe>=O.length?{done:!0}:{done:!1,value:O[oe++]}},e:function(he){throw he},f:Q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ye,S=!0,_e=!1;return{s:function(){E=E.call(O)},n:function(){var he=E.next();return S=he.done,he},e:function(he){_e=!0,ye=he},f:function(){try{S||E.return==null||E.return()}finally{if(_e)throw ye}}}}function u(O,F,E){return(F=y(F))in O?Object.defineProperty(O,F,{value:E,enumerable:!0,configurable:!0,writable:!0}):O[F]=E,O}function l(O,F){var E=Object.keys(O);if(Object.getOwnPropertySymbols){var oe=Object.getOwnPropertySymbols(O);F&&(oe=oe.filter(function(Q){return Object.getOwnPropertyDescriptor(O,Q).enumerable})),E.push.apply(E,oe)}return E}function p(O){for(var F=1;F<arguments.length;F++){var E=arguments[F]!=null?arguments[F]:{};F%2?l(Object(E),!0).forEach(function(oe){u(O,oe,E[oe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(E)):l(Object(E)).forEach(function(oe){Object.defineProperty(O,oe,Object.getOwnPropertyDescriptor(E,oe))})}return O}function d(O,F){if(typeof O!="object"||!O)return O;var E=O[Symbol.toPrimitive];if(E!==void 0){var oe=E.call(O,F);if(typeof oe!="object")return oe;throw new TypeError("@@toPrimitive must return a primitive value.")}return(F==="string"?String:Number)(O)}function y(O){var F=d(O,"string");return typeof F=="symbol"?F:F+""}function v(O){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},v(O)}function x(O,F){if(O){if(typeof O=="string")return h(O,F);var E={}.toString.call(O).slice(8,-1);return E==="Object"&&O.constructor&&(E=O.constructor.name),E==="Map"||E==="Set"?Array.from(O):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?h(O,F):void 0}}var w={exports:{}},m={},b;function _(){return b||(b=1,m.validateOptions=function(F,E,oe){if(F){var Q=F?Object.keys(F):[],ye=Q.find(function(_e){return!E.includes(_e)});if(ye)throw new Error('Object "'+oe+'" contains an unknown option "'+ye+'"');var S=E.find(function(_e){return Object.prototype[_e]&&!Q.includes(_e)});if(S)throw new Error('Object "'+oe+'" contains an inherited option "'+S+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return F}},m.workerOptsNames=["credentials","name","type"],m.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"],m.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]),m}var k,g;function j(){return g||(g=1,k=`!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?u(e,t,r):t,i=n?u(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new s),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function u(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function s(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},s.prototype=new Error,s.prototype.constructor=Error,s.prototype.name="CancellationError",i.CancellationError=s,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,u="__workerpool-cleanup__",s={exit:function(){}},c={addAbortListener:function(e){s.abortListeners.push(e)},emit:s.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)s.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},s.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;s.send=f.postMessage.bind(f),s.on=f.on.bind(f),s.exit=process.exit.bind(process)}else s.on=process.on.bind(process),s.send=function(e){process.send(e)},s.on("disconnect",(function(){process.exit(1)})),s.exit=process.exit.bind(process)}function d(e){return Object.getOwnPropertyNames(e).reduce((function(n,t){return Object.defineProperty(n,t,{value:e[t],enumerable:!0})}),{})}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}s.methods={},s.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},s.methods.methods=function(){return Object.keys(s.methods)},s.terminationHandler=void 0,s.abortListenerTimeout=1e3,s.abortListeners=[],s.terminateAndExit=function(e){var n=function(){s.exit(e)};if(!s.terminationHandler)return n();var t=s.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},s.cleanup=function(e){if(!s.abortListeners.length)return s.send({id:e,method:u,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=s.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),s.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),s.abortListeners.length||(s.abortListeners=[])}),(function(){clearTimeout(n),s.exit()}));return i.all([o,r]).then((function(){s.send({id:e,method:u,error:null})}),(function(n){s.send({id:e,method:u,error:n?d(n):null})}))};var p=null;s.on("message",(function(e){if("__workerpool-terminate__"===e)return s.terminateAndExit(0);if(e.method===u)return s.cleanup(e.id);try{var n=s.methods[e.method];if(!n)throw new Error('Unknown method "'+e.method+'"');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?s.send({id:e.id,result:n.message,error:null},n.transfer):s.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){s.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?s.send({id:e.id,result:r.message,error:null},r.transfer):s.send({id:e.id,result:r,error:null}),p=null)}catch(n){s.send({id:e.id,result:null,error:d(n)})}})),s.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(s.methods[t]=e[t],s.methods[t].worker=c);n&&(s.terminationHandler=n.onTerminate,s.abortListenerTimeout=n.abortListenerTimeout||1e3),s.send("ready")},s.emit=function(e){if(p){if(e instanceof t)return void s.send({id:p,isEvent:!0,payload:e.message},e.transfer);s.send({id:p,isEvent:!0,payload:e})}},n.add=s.register,n.emit=s.emit}(t),n(t)}));
//# sourceMappingURL=worker.min.js.map
`),k}var M;function $(){if(M)return w.exports;M=1;var O=c(),F=O.Promise,E=n,oe=_(),Q=oe.validateOptions,ye=oe.forkOptsNames,S=oe.workerThreadOptsNames,_e=oe.workerOptsNames,he="__workerpool-terminate__",Fe="__workerpool-cleanup__";function ze(){var q=R();if(!q)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return q}function D(){if(typeof Worker!="function"&&((typeof Worker>"u"?"undefined":v(Worker))!=="object"||typeof Worker.prototype.constructor!="function"))throw new Error("WorkerPool: Web Workers not supported")}function R(){try{return bt}catch(q){if(v(q)==="object"&&q!==null&&q.code==="MODULE_NOT_FOUND")return null;throw q}}function T(){if(E.platform==="browser"){if(typeof Blob>"u")throw new Error("Blob not supported by the browser");if(!window.URL||typeof window.URL.createObjectURL!="function")throw new Error("URL.createObjectURL not supported by the browser");var q=new Blob([j()],{type:"text/javascript"});return window.URL.createObjectURL(q)}else return __dirname+"/worker.js"}function B(q,ie){if(ie.workerType==="web")return D(),re(q,ie.workerOpts,Worker);if(ie.workerType==="thread")return P=ze(),fe(q,P,ie);if(ie.workerType==="process"||!ie.workerType)return Ce(q,Ve(ie),bt);if(E.platform==="browser")return D(),re(q,ie.workerOpts,Worker);var P=R();return P?fe(q,P,ie):Ce(q,Ve(ie),bt)}function re(q,ie,P){Q(ie,_e,"workerOpts");var ne=new P(q,ie);return ne.isBrowserWorker=!0,ne.on=function(se,pe){this.addEventListener(se,function(ve){pe(ve.data)})},ne.send=function(se,pe){this.postMessage(se,pe)},ne}function fe(q,ie,P){var ne,se;Q(P?.workerThreadOpts,S,"workerThreadOpts");var pe=new ie.Worker(q,p({stdout:(ne=P?.emitStdStreams)!==null&&ne!==void 0?ne:!1,stderr:(se=P?.emitStdStreams)!==null&&se!==void 0?se:!1},P?.workerThreadOpts));return pe.isWorkerThread=!0,pe.send=function(ve,ce){this.postMessage(ve,ce)},pe.kill=function(){return this.terminate(),!0},pe.disconnect=function(){this.terminate()},P!=null&&P.emitStdStreams&&(pe.stdout.on("data",function(ve){return pe.emit("stdout",ve)}),pe.stderr.on("data",function(ve){return pe.emit("stderr",ve)})),pe}function Ce(q,ie,P){Q(ie.forkOpts,ye,"forkOpts");var ne=P.fork(q,ie.forkArgs,ie.forkOpts),se=ne.send;return ne.send=function(pe){return se.call(ne,pe)},ie.emitStdStreams&&(ne.stdout.on("data",function(pe){return ne.emit("stdout",pe)}),ne.stderr.on("data",function(pe){return ne.emit("stderr",pe)})),ne.isChildProcess=!0,ne}function Ve(q){q=q||{};var ie=process.execArgv.join(" "),P=ie.indexOf("--inspect")!==-1,ne=ie.indexOf("--debug-brk")!==-1,se=[];return P&&(se.push("--inspect="+q.debugPort),ne&&se.push("--debug-brk")),process.execArgv.forEach(function(pe){pe.indexOf("--max-old-space-size")>-1&&se.push(pe)}),Object.assign({},q,{forkArgs:q.forkArgs,forkOpts:Object.assign({},q.forkOpts,{execArgv:(q.forkOpts&&q.forkOpts.execArgv||[]).concat(se),stdio:q.emitStdStreams?"pipe":void 0})})}function $e(q){for(var ie=new Error(""),P=Object.keys(q),ne=0;ne<P.length;ne++)ie[P[ne]]=q[P[ne]];return ie}function Je(q,ie){if(Object.keys(q.processing).length===1){var P=Object.values(q.processing)[0];P.options&&typeof P.options.on=="function"&&P.options.on(ie)}}function mt(q,ie){var P=this,ne=ie||{};this.script=q||T(),this.worker=B(this.script,ne),this.debugPort=ne.debugPort,this.forkOpts=ne.forkOpts,this.forkArgs=ne.forkArgs,this.workerOpts=ne.workerOpts,this.workerThreadOpts=ne.workerThreadOpts,this.workerTerminateTimeout=ne.workerTerminateTimeout,q||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(ce){Je(P,{stdout:ce.toString()})}),this.worker.on("stderr",function(ce){Je(P,{stderr:ce.toString()})}),this.worker.on("message",function(ce){if(!P.terminated)if(typeof ce=="string"&&ce==="ready")P.worker.ready=!0,pe();else{var Xe=ce.id,Me=P.processing[Xe];if(Me!==void 0&&(ce.isEvent?Me.options&&typeof Me.options.on=="function"&&Me.options.on(ce.payload):(delete P.processing[Xe],P.terminating===!0&&P.terminate(),ce.error?Me.resolver.reject($e(ce.error)):Me.resolver.resolve(ce.result))),ce.method===Fe){var He=P.tracking[ce.id];He!==void 0&&(ce.error?(clearTimeout(He.timeoutId),He.resolver.reject($e(ce.error))):(P.tracking&&clearTimeout(He.timeoutId),He.resolver.resolve(He.result))),delete P.tracking[Xe]}}});function se(ce){P.terminated=!0;for(var Xe in P.processing)P.processing[Xe]!==void 0&&P.processing[Xe].resolver.reject(ce);P.processing=Object.create(null)}function pe(){var ce=f(P.requestQueue.splice(0)),Xe;try{for(ce.s();!(Xe=ce.n()).done;){var Me=Xe.value;P.worker.send(Me.message,Me.transfer)}}catch(He){ce.e(He)}finally{ce.f()}}var ve=this.worker;this.worker.on("error",se),this.worker.on("exit",function(ce,Xe){var Me=`Workerpool Worker terminated Unexpectedly
`;Me+="    exitCode: `"+ce+"`\n",Me+="    signalCode: `"+Xe+"`\n",Me+="    workerpool.script: `"+P.script+"`\n",Me+="    spawnArgs: `"+ve.spawnargs+"`\n",Me+="    spawnfile: `"+ve.spawnfile+"`\n",Me+="    stdout: `"+ve.stdout+"`\n",Me+="    stderr: `"+ve.stderr+"`\n",se(new Error(Me))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}return mt.prototype.methods=function(){return this.exec("methods")},mt.prototype.exec=function(q,ie,P,ne){P||(P=F.defer());var se=++this.lastId;this.processing[se]={id:se,resolver:P,options:ne};var pe={message:{id:se,method:q,params:ie},transfer:ne&&ne.transfer};this.terminated?P.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(pe.message,pe.transfer):this.requestQueue.push(pe);var ve=this;return P.promise.catch(function(ce){if(ce instanceof F.CancellationError||ce instanceof F.TimeoutError)return ve.tracking[se]={id:se,resolver:F.defer()},delete ve.processing[se],ve.tracking[se].resolver.promise=ve.tracking[se].resolver.promise.catch(function(Xe){delete ve.tracking[se];var Me=ve.terminateAndNotify(!0).then(function(){throw Xe},function(He){throw He});return Me}),ve.worker.send({id:se,method:Fe}),ve.tracking[se].timeoutId=setTimeout(function(){ve.tracking[se].resolver.reject(ce)},ve.workerTerminateTimeout),ve.tracking[se].resolver.promise;throw ce})},mt.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0},mt.prototype.terminate=function(q,ie){var P=this;if(q){for(var ne in this.processing)this.processing[ne]!==void 0&&this.processing[ne].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var se=0,pe=Object.values(P.tracking);se<pe.length;se++){var ve=pe[se];clearTimeout(ve.timeoutId),ve.resolver.reject(new Error("Worker Terminating"))}if(P.tracking=Object.create(null),typeof ie=="function"&&(this.terminationHandler=ie),this.busy())this.terminating=!0;else{var ce=function(He){if(P.terminated=!0,P.cleaning=!1,P.worker!=null&&P.worker.removeAllListeners&&P.worker.removeAllListeners("message"),P.worker=null,P.terminating=!1,P.terminationHandler)P.terminationHandler(He,P);else if(He)throw He};if(this.worker)if(typeof this.worker.kill=="function"){if(this.worker.killed){ce(new Error("worker already killed!"));return}var Xe=setTimeout(function(){P.worker&&P.worker.kill()},this.workerTerminateTimeout);this.worker.once("exit",function(){clearTimeout(Xe),P.worker&&(P.worker.killed=!0),ce()}),this.worker.ready?this.worker.send(he):this.requestQueue.push({message:he}),this.cleaning=!0;return}else if(typeof this.worker.terminate=="function")this.worker.terminate(),this.worker.killed=!0;else throw new Error("Failed to terminate worker");ce()}},mt.prototype.terminateAndNotify=function(q,ie){var P=F.defer();return ie&&P.promise.timeout(ie),this.terminate(q,function(ne,se){ne?P.reject(ne):P.resolve(se)}),P.promise},w.exports=mt,w.exports._tryRequireWorkerThreads=R,w.exports._setupProcessWorker=Ce,w.exports._setupBrowserWorker=re,w.exports._setupWorkerThreadWorker=fe,w.exports.ensureWorkerThreads=ze,w.exports}var C,H;function X(){if(H)return C;H=1;var O=65535;C=F;function F(){this.ports=Object.create(null),this.length=0}return F.prototype.nextAvailableStartingAt=function(E){for(;this.ports[E]===!0;)E++;if(E>=O)throw new Error("WorkerPool debug port limit reached: "+E+">= "+O);return this.ports[E]=!0,this.length++,E},F.prototype.releasePort=function(E){delete this.ports[E],this.length--},C}var Z,K;function ee(){if(K)return Z;K=1;var O=c(),F=O.Promise,E=$(),oe=n,Q=X(),ye=new Q;function S(D,R){typeof D=="string"?this.script=D||null:(this.script=null,R=D),this.workers=[],this.tasks=[],R=R||{},this.forkArgs=Object.freeze(R.forkArgs||[]),this.forkOpts=Object.freeze(R.forkOpts||{}),this.workerOpts=Object.freeze(R.workerOpts||{}),this.workerThreadOpts=Object.freeze(R.workerThreadOpts||{}),this.debugPortStart=R.debugPortStart||43210,this.nodeWorker=R.nodeWorker,this.workerType=R.workerType||R.nodeWorker||"auto",this.maxQueueSize=R.maxQueueSize||1/0,this.workerTerminateTimeout=R.workerTerminateTimeout||1e3,this.onCreateWorker=R.onCreateWorker||function(){return null},this.onTerminateWorker=R.onTerminateWorker||function(){return null},this.emitStdStreams=R.emitStdStreams||!1,R&&"maxWorkers"in R?(_e(R.maxWorkers),this.maxWorkers=R.maxWorkers):this.maxWorkers=Math.max((oe.cpus||4)-1,1),R&&"minWorkers"in R&&(R.minWorkers==="max"?this.minWorkers=this.maxWorkers:(he(R.minWorkers),this.minWorkers=R.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),this.workerType==="thread"&&E.ensureWorkerThreads()}S.prototype.exec=function(D,R,T){if(R&&!Array.isArray(R))throw new TypeError('Array expected as argument "params"');if(typeof D=="string"){var B=F.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var re=this.tasks,fe={method:D,params:R,resolver:B,timeout:null,options:T};re.push(fe);var Ce=B.promise.timeout;return B.promise.timeout=function($e){return re.indexOf(fe)!==-1?(fe.timeout=$e,B.promise):Ce.call(B.promise,$e)},this._next(),B.promise}else{if(typeof D=="function")return this.exec("run",[String(D),R],T);throw new TypeError('Function or string expected as argument "method"')}},S.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var D=this;return this.exec("methods").then(function(R){var T={};return R.forEach(function(B){T[B]=function(){return D.exec(B,Array.prototype.slice.call(arguments))}}),T})},S.prototype._next=function(){if(this.tasks.length>0){var D=this._getWorker();if(D){var R=this,T=this.tasks.shift();if(T.resolver.promise.pending){var B=D.exec(T.method,T.params,T.resolver,T.options).then(R._boundNext).catch(function(){if(D.terminated)return R._removeWorker(D)}).then(function(){R._next()});typeof T.timeout=="number"&&B.timeout(T.timeout)}else R._next()}}},S.prototype._getWorker=function(){for(var D=this.workers,R=0;R<D.length;R++){var T=D[R];if(T.busy()===!1)return T}return D.length<this.maxWorkers?(T=this._createWorkerHandler(),D.push(T),T):null},S.prototype._removeWorker=function(D){var R=this;return ye.releasePort(D.debugPort),this._removeWorkerFromList(D),this._ensureMinWorkers(),new F(function(T,B){D.terminate(!1,function(re){R.onTerminateWorker({forkArgs:D.forkArgs,forkOpts:D.forkOpts,workerThreadOpts:D.workerThreadOpts,script:D.script}),re?B(re):T(D)})})},S.prototype._removeWorkerFromList=function(D){var R=this.workers.indexOf(D);R!==-1&&this.workers.splice(R,1)},S.prototype.terminate=function(D,R){var T=this;this.tasks.forEach(function(Ve){Ve.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var B=function($e){ye.releasePort($e.debugPort),this._removeWorkerFromList($e)},re=B.bind(this),fe=[],Ce=this.workers.slice();return Ce.forEach(function(Ve){var $e=Ve.terminateAndNotify(D,R).then(re).always(function(){T.onTerminateWorker({forkArgs:Ve.forkArgs,forkOpts:Ve.forkOpts,workerThreadOpts:Ve.workerThreadOpts,script:Ve.script})});fe.push($e)}),F.all(fe)},S.prototype.stats=function(){var D=this.workers.length,R=this.workers.filter(function(T){return T.busy()}).length;return{totalWorkers:D,busyWorkers:R,idleWorkers:D-R,pendingTasks:this.tasks.length,activeTasks:R}},S.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var D=this.workers.length;D<this.minWorkers;D++)this.workers.push(this._createWorkerHandler())},S.prototype._createWorkerHandler=function(){var D=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new E(D.script||this.script,{forkArgs:D.forkArgs||this.forkArgs,forkOpts:D.forkOpts||this.forkOpts,workerOpts:D.workerOpts||this.workerOpts,workerThreadOpts:D.workerThreadOpts||this.workerThreadOpts,debugPort:ye.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})};function _e(D){if(!Fe(D)||!ze(D)||D<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function he(D){if(!Fe(D)||!ze(D)||D<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function Fe(D){return typeof D=="number"}function ze(D){return Math.round(D)==D}return Z=S,Z}var z={},Y,V;function W(){if(V)return Y;V=1;function O(F,E){this.message=F,this.transfer=E}return Y=O,Y}var I;function U(){return I||(I=1,function(O){var F=W(),E=c().Promise,oe="__workerpool-terminate__",Q="__workerpool-cleanup__",ye=1e3,S={exit:function(){}},_e={addAbortListener:function(B){S.abortListeners.push(B)},emit:S.emit};if(typeof self<"u"&&typeof postMessage=="function"&&typeof addEventListener=="function")S.on=function(T,B){addEventListener(T,function(re){B(re.data)})},S.send=function(T,B){B?postMessage(T,B):postMessage(T)};else if(typeof process<"u"){var he;try{he=bt}catch(T){if(!(v(T)==="object"&&T!==null&&T.code==="MODULE_NOT_FOUND"))throw T}if(he&&he.parentPort!==null){var Fe=he.parentPort;S.send=Fe.postMessage.bind(Fe),S.on=Fe.on.bind(Fe),S.exit=process.exit.bind(process)}else S.on=process.on.bind(process),S.send=function(T){process.send(T)},S.on("disconnect",function(){process.exit(1)}),S.exit=process.exit.bind(process)}else throw new Error("Script must be executed as a worker");function ze(T){return Object.getOwnPropertyNames(T).reduce(function(B,re){return Object.defineProperty(B,re,{value:T[re],enumerable:!0})},{})}function D(T){return T&&typeof T.then=="function"&&typeof T.catch=="function"}S.methods={},S.methods.run=function(B,re){var fe=new Function("return ("+B+").apply(this, arguments);");return fe.worker=_e,fe.apply(fe,re)},S.methods.methods=function(){return Object.keys(S.methods)},S.terminationHandler=void 0,S.abortListenerTimeout=ye,S.abortListeners=[],S.terminateAndExit=function(T){var B=function(){S.exit(T)};if(!S.terminationHandler)return B();var re=S.terminationHandler(T);return D(re)?(re.then(B,B),re):(B(),new E(function(fe,Ce){Ce(new Error("Worker terminating"))}))},S.cleanup=function(T){if(!S.abortListeners.length)return S.send({id:T,method:Q,error:ze(new Error("Worker terminating"))}),new E(function(Je){Je()});var B=function(){S.exit()},re=function(){S.abortListeners.length||(S.abortListeners=[])},fe=S.abortListeners.map(function(Je){return Je()}),Ce,Ve=new E(function(Je,mt){Ce=setTimeout(function(){mt(new Error("Timeout occured waiting for abort handler, killing worker"))},S.abortListenerTimeout)}),$e=E.all(fe).then(function(){clearTimeout(Ce),re()},function(){clearTimeout(Ce),B()});return E.all([$e,Ve]).then(function(){S.send({id:T,method:Q,error:null})},function(Je){S.send({id:T,method:Q,error:Je?ze(Je):null})})};var R=null;S.on("message",function(T){if(T===oe)return S.terminateAndExit(0);if(T.method===Q)return S.cleanup(T.id);try{var B=S.methods[T.method];if(B){R=T.id;var re=B.apply(B,T.params);D(re)?re.then(function(fe){fe instanceof F?S.send({id:T.id,result:fe.message,error:null},fe.transfer):S.send({id:T.id,result:fe,error:null}),R=null}).catch(function(fe){S.send({id:T.id,result:null,error:ze(fe)}),R=null}):(re instanceof F?S.send({id:T.id,result:re.message,error:null},re.transfer):S.send({id:T.id,result:re,error:null}),R=null)}else throw new Error('Unknown method "'+T.method+'"')}catch(fe){S.send({id:T.id,result:null,error:ze(fe)})}}),S.register=function(T,B){if(T)for(var re in T)T.hasOwnProperty(re)&&(S.methods[re]=T[re],S.methods[re].worker=_e);B&&(S.terminationHandler=B.onTerminate,S.abortListenerTimeout=B.abortListenerTimeout||ye),S.send("ready")},S.emit=function(T){if(R){if(T instanceof F){S.send({id:R,isEvent:!0,payload:T.message},T.transfer);return}S.send({id:R,isEvent:!0,payload:T})}},O.add=S.register,O.emit=S.emit}(z)),z}var J=n.platform,ue=n.isMainThread,ae=n.cpus;function ke(O,F){var E=ee();return new E(O,F)}var Se=i.pool=ke;function We(O,F){var E=U();E.add(O,F)}var Ye=i.worker=We;function Ue(O){var F=U();F.emit(O)}var Oe=i.workerEmit=Ue,Ze=c(),Ne=Ze.Promise,ut=i.Promise=Ne,Mt=i.Transfer=W(),Wt=i.platform=J,ft=i.isMainThread=ue,Pt=i.cpus=ae;t.Promise=ut,t.Transfer=Mt,t.cpus=Pt,t.default=i,t.isMainThread=ft,t.platform=Wt,t.pool=Se,t.worker=Ye,t.workerEmit=Oe,Object.defineProperty(t,"__esModule",{value:!0})})}(Nt,Nt.exports)),Nt.exports}var an=sn();const Ar=r=>({type:"rgba",color:r}),De=r=>({type:"hsla",color:r}),Be={DeepOcean:{name:"deep-ocean",color:De([220,85,18,1]),length:.15,steps:5,transition:6},Ocean:{name:"ocean",color:De([215,75,25,1]),length:.15,steps:5,transition:4},ShallowWater:{name:"shallow-water",color:De([195,65,35,1]),length:.125,steps:6,transition:6},Foam:{name:"foam",color:De([190,25,85,1]),length:.025,steps:5,transition:6},Coast:{name:"coast",color:De([180,40,45,1]),length:.05,steps:6,transition:8},Beach:{name:"beach",color:De([45,65,70,1]),length:.05,steps:6,transition:5},Wetland:{name:"wetland",color:De([85,45,40,1]),length:.1,steps:6,transition:5},Lowland:{name:"lowland",color:De([65,55,45,1]),length:.15,steps:8,transition:4},Valley:{name:"valley",color:De([35,50,40,1]),length:.15,steps:8,transition:6},Grassland:{name:"grassland",color:De([90,40,35,1]),length:.2,steps:8,transition:6},Midland:{name:"midland",color:De([25,40,32,1]),length:.2,steps:10,transition:6},Highland:{name:"highland",color:De([15,35,28,1]),length:.2,steps:10,transition:4},Foothills:{name:"foothills",color:De([10,30,25,1]),length:.15,steps:10,transition:6},Mountain:{name:"mountain",color:De([5,20,35,1]),length:.15,steps:10,transition:4},HighMountain:{name:"high-mountain",color:De([0,10,45,1]),length:.1,steps:8,transition:5},MountainPeak:{name:"mountain-peak",color:De([0,5,85,1]),length:.05,steps:8}};function cn(r,e,t){let[i]=r.color,[o]=e.color;Math.abs(o-i)>180&&(i<o?i+=360:o+=360);const n=(i+t*(o-i))%360,s=r.color[1]+t*(e.color[1]-r.color[1]),a=r.color[2]+t*(e.color[2]-r.color[2]),c=r.color[3]+t*(e.color[3]-r.color[3]);return De([n,s,a,c])}function Ct(r,e,t){const i=e/(t-1),o=10*(i-.5),n=5*(.5-i);return De([r.color[0],Math.max(0,Math.min(100,r.color[1]+n)),Math.max(0,Math.min(100,r.color[2]+o)),r.color[3]])}function ln(r){let e=-1;return r.map(t=>{const i={...t,level:e};return e+=t.length,i})}function un(r){const e=ln(r),t=[],i=r.reduce((o,n)=>o+n.length,0);if(i<2&&console.warn(`Warning: Total layer coverage (${i.toFixed(3)}) is less than the full range of 2 (-1 to 1). Some noise values will not be mapped.`),i>2)return console.error(`Total layer coverage (${i.toFixed(3)}) exceeds maximum range of 2 (-1 to 1).`),t;for(let o=0;o<e.length;o++){const n=e[o],{color:s,level:a,length:c,steps:h}=n,f=o<e.length-1?e[o+1]:null,u=f!==null,l=n.transition??4,p=Math.max(8,h);for(let d=0;d<p-1;d++){const y=a+c*d/p,v=a+c*(d+1)/p;t.push({level:[y,v],color:Ct(s,d,p)})}if(u&&f){const d=a+c*(p-1)/p,y=a+c,v=Ct(s,p-1,p),x=Ct(f.color,0,Math.max(8,f.steps)),w=(y-d)/(l+1);for(let m=0;m<=l;m++){const b=(m+1)/(l+2),_=d+m*w,k=d+(m+1)*w;t.push({level:[_,k],color:cn(v,x,b)})}}else if(!u){const d=a+c*(p-1)/p,y=a+c;t.push({level:[d,y],color:Ct(s,p-1,p)})}}return t}const Ke=Object.freeze({Euclidean:"Euclidean",EuclideanSq:"EuclideanSq",Manhattan:"Manhattan",Hybrid:"Hybrid"}),Re=Object.freeze({CellValue:"CellValue",Distance:"Distance",Distance2:"Distance2",Distance2Add:"Distance2Add",Distance2Sub:"Distance2Sub",Distance2Mul:"Distance2Mul",Distance2Div:"Distance2Div"}),Ge=Object.freeze({OpenSimplex2:"OpenSimplex2",OpenSimplex2Reduced:"OpenSimplex2Reduced",BasicGrid:"BasicGrid"}),it=Object.freeze({None:"None",FBm:"FBm",Ridged:"Ridged",PingPong:"PingPong",DomainWarpProgressive:"DomainWarpProgressive",DomainWarpIndependent:"DomainWarpIndependent"}),ct=[.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.38268343236509,.923879532511287,.923879532511287,.38268343236509,.923879532511287,-.38268343236509,.38268343236509,-.923879532511287,-.38268343236509,-.923879532511287,-.923879532511287,-.38268343236509,-.923879532511287,.38268343236509,-.38268343236509,.923879532511287],pt=[0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,1,1,0,0,0,-1,1,0,-1,1,0,0,0,-1,-1,0],Ee=Object.freeze({OpenSimplex2:"OpenSimplex2",OpenSimplex2S:"OpenSimplex2S",Cellular:"Cellular",Perlin:"Perlin",ValueCubic:"ValueCubic",Value:"Value"}),L=501125321,N=1136930381,le=1720413743,de=[-.2700222198,-.9628540911,.3863092627,-.9223693152,.04444859006,-.999011673,-.5992523158,-.8005602176,-.7819280288,.6233687174,.9464672271,.3227999196,-.6514146797,-.7587218957,.9378472289,.347048376,-.8497875957,-.5271252623,-.879042592,.4767432447,-.892300288,-.4514423508,-.379844434,-.9250503802,-.9951650832,.0982163789,.7724397808,-.6350880136,.7573283322,-.6530343002,-.9928004525,-.119780055,-.0532665713,.9985803285,.9754253726,-.2203300762,-.7665018163,.6422421394,.991636706,.1290606184,-.994696838,.1028503788,-.5379205513,-.84299554,.5022815471,-.8647041387,.4559821461,-.8899889226,-.8659131224,-.5001944266,.0879458407,-.9961252577,-.5051684983,.8630207346,.7753185226,-.6315704146,-.6921944612,.7217110418,-.5191659449,-.8546734591,.8978622882,-.4402764035,-.1706774107,.9853269617,-.9353430106,-.3537420705,-.9992404798,.03896746794,-.2882064021,-.9575683108,-.9663811329,.2571137995,-.8759714238,-.4823630009,-.8303123018,-.5572983775,.05110133755,-.9986934731,-.8558373281,-.5172450752,.09887025282,.9951003332,.9189016087,.3944867976,-.2439375892,-.9697909324,-.8121409387,-.5834613061,-.9910431363,.1335421355,.8492423985,-.5280031709,-.9717838994,-.2358729591,.9949457207,.1004142068,.6241065508,-.7813392434,.662910307,.7486988212,-.7197418176,.6942418282,-.8143370775,-.5803922158,.104521054,-.9945226741,-.1065926113,-.9943027784,.445799684,-.8951327509,.105547406,.9944142724,-.992790267,.1198644477,-.8334366408,.552615025,.9115561563,-.4111755999,.8285544909,-.5599084351,.7217097654,-.6921957921,.4940492677,-.8694339084,-.3652321272,-.9309164803,-.9696606758,.2444548501,.08925509731,-.996008799,.5354071276,-.8445941083,-.1053576186,.9944343981,-.9890284586,.1477251101,.004856104961,.9999882091,.9885598478,.1508291331,.9286129562,-.3710498316,-.5832393863,-.8123003252,.3015207509,.9534596146,-.9575110528,.2883965738,.9715802154,-.2367105511,.229981792,.9731949318,.955763816,-.2941352207,.740956116,.6715534485,-.9971513787,-.07542630764,.6905710663,-.7232645452,-.290713703,-.9568100872,.5912777791,-.8064679708,-.9454592212,-.325740481,.6664455681,.74555369,.6236134912,.7817328275,.9126993851,-.4086316587,-.8191762011,.5735419353,-.8812745759,-.4726046147,.9953313627,.09651672651,.9855650846,-.1692969699,-.8495980887,.5274306472,.6174853946,-.7865823463,.8508156371,.52546432,.9985032451,-.05469249926,.1971371563,-.9803759185,.6607855748,-.7505747292,-.03097494063,.9995201614,-.6731660801,.739491331,-.7195018362,-.6944905383,.9727511689,.2318515979,.9997059088,-.0242506907,.4421787429,-.8969269532,.9981350961,-.061043673,-.9173660799,-.3980445648,-.8150056635,-.5794529907,-.8789331304,.4769450202,.0158605829,.999874213,-.8095464474,.5870558317,-.9165898907,-.3998286786,-.8023542565,.5968480938,-.5176737917,.8555780767,-.8154407307,-.5788405779,.4022010347,-.9155513791,-.9052556868,-.4248672045,.7317445619,.6815789728,-.5647632201,-.8252529947,-.8403276335,-.5420788397,-.9314281527,.363925262,.5238198472,.8518290719,.7432803869,-.6689800195,-.985371561,-.1704197369,.4601468731,.88784281,.825855404,.5638819483,.6182366099,.7859920446,.8331502863,-.553046653,.1500307506,.9886813308,-.662330369,-.7492119075,-.668598664,.743623444,.7025606278,.7116238924,-.5419389763,-.8404178401,-.3388616456,.9408362159,.8331530315,.5530425174,-.2989720662,-.9542618632,.2638522993,.9645630949,.124108739,-.9922686234,-.7282649308,-.6852956957,.6962500149,.7177993569,-.9183535368,.3957610156,-.6326102274,-.7744703352,-.9331891859,-.359385508,-.1153779357,-.9933216659,.9514974788,-.3076565421,-.08987977445,-.9959526224,.6678496916,.7442961705,.7952400393,-.6062947138,-.6462007402,-.7631674805,-.2733598753,.9619118351,.9669590226,-.254931851,-.9792894595,.2024651934,-.5369502995,-.8436138784,-.270036471,-.9628500944,-.6400277131,.7683518247,-.7854537493,-.6189203566,.06005905383,-.9981948257,-.02455770378,.9996984141,-.65983623,.751409442,-.6253894466,-.7803127835,-.6210408851,-.7837781695,.8348888491,.5504185768,-.1592275245,.9872419133,.8367622488,.5475663786,-.8675753916,-.4973056806,-.2022662628,-.9793305667,.9399189937,.3413975472,.9877404807,-.1561049093,-.9034455656,.4287028224,.1269804218,-.9919052235,-.3819600854,.924178821,.9754625894,.2201652486,-.3204015856,-.9472818081,-.9874760884,.1577687387,.02535348474,-.9996785487,.4835130794,-.8753371362,-.2850799925,-.9585037287,-.06805516006,-.99768156,-.7885244045,-.6150034663,.3185392127,-.9479096845,.8880043089,.4598351306,.6476921488,-.7619021462,.9820241299,.1887554194,.9357275128,-.3527237187,-.8894895414,.4569555293,.7922791302,.6101588153,.7483818261,.6632681526,-.7288929755,-.6846276581,.8729032783,-.4878932944,.8288345784,.5594937369,.08074567077,.9967347374,.9799148216,-.1994165048,-.580730673,-.8140957471,-.4700049791,-.8826637636,.2409492979,.9705377045,.9437816757,-.3305694308,-.8927998638,-.4504535528,-.8069622304,.5906030467,.06258973166,.9980393407,-.9312597469,.3643559849,.5777449785,.8162173362,-.3360095855,-.941858566,.697932075,-.7161639607,-.002008157227,-.9999979837,-.1827294312,-.9831632392,-.6523911722,.7578824173,-.4302626911,-.9027037258,-.9985126289,-.05452091251,-.01028102172,-.9999471489,-.4946071129,.8691166802,-.2999350194,.9539596344,.8165471961,.5772786819,.2697460475,.962931498,-.7306287391,-.6827749597,-.7590952064,-.6509796216,-.907053853,.4210146171,-.5104861064,-.8598860013,.8613350597,.5080373165,.5007881595,-.8655698812,-.654158152,.7563577938,-.8382755311,-.545246856,.6940070834,.7199681717,.06950936031,.9975812994,.1702942185,-.9853932612,.2695973274,.9629731466,.5519612192,-.8338697815,.225657487,-.9742067022,.4215262855,-.9068161835,.4881873305,-.8727388672,-.3683854996,-.9296731273,-.9825390578,.1860564427,.81256471,.5828709909,.3196460933,-.9475370046,.9570913859,.2897862643,-.6876655497,-.7260276109,-.9988770922,-.047376731,-.1250179027,.992154486,-.8280133617,.560708367,.9324863769,-.3612051451,.6394653183,.7688199442,-.01623847064,-.9998681473,-.9955014666,-.09474613458,-.81453315,.580117012,.4037327978,-.9148769469,.9944263371,.1054336766,-.1624711654,.9867132919,-.9949487814,-.100383875,-.6995302564,.7146029809,.5263414922,-.85027327,-.5395221479,.841971408,.6579370318,.7530729462,.01426758847,-.9998982128,-.6734383991,.7392433447,.639412098,-.7688642071,.9211571421,.3891908523,-.146637214,-.9891903394,-.782318098,.6228791163,-.5039610839,-.8637263605,-.7743120191,-.6328039957],te=[-.7292736885,-.6618439697,.1735581948,0,.790292081,-.5480887466,-.2739291014,0,.7217578935,.6226212466,-.3023380997,0,.565683137,-.8208298145,-.0790000257,0,.760049034,-.5555979497,-.3370999617,0,.3713945616,.5011264475,.7816254623,0,-.1277062463,-.4254438999,-.8959289049,0,-.2881560924,-.5815838982,.7607405838,0,.5849561111,-.662820239,-.4674352136,0,.3307171178,.0391653737,.94291689,0,.8712121778,-.4113374369,-.2679381538,0,.580981015,.7021915846,.4115677815,0,.503756873,.6330056931,-.5878203852,0,.4493712205,.601390195,.6606022552,0,-.6878403724,.09018890807,-.7202371714,0,-.5958956522,-.6469350577,.475797649,0,-.5127052122,.1946921978,-.8361987284,0,-.9911507142,-.05410276466,-.1212153153,0,-.2149721042,.9720882117,-.09397607749,0,-.7518650936,-.5428057603,.3742469607,0,.5237068895,.8516377189,-.02107817834,0,.6333504779,.1926167129,-.7495104896,0,-.06788241606,.3998305789,.9140719259,0,-.5538628599,-.4729896695,-.6852128902,0,-.7261455366,-.5911990757,.3509933228,0,-.9229274737,-.1782808786,.3412049336,0,-.6968815002,.6511274338,.3006480328,0,.9608044783,-.2098363234,-.1811724921,0,.06817146062,-.9743405129,.2145069156,0,-.3577285196,-.6697087264,-.6507845481,0,-.1868621131,.7648617052,-.6164974636,0,-.6541697588,.3967914832,.6439087246,0,.6993340405,-.6164538506,.3618239211,0,-.1546665739,.6291283928,.7617583057,0,-.6841612949,-.2580482182,-.6821542638,0,.5383980957,.4258654885,.7271630328,0,-.5026987823,-.7939832935,-.3418836993,0,.3202971715,.2834415347,.9039195862,0,.8683227101,-.0003762656404,-.4959995258,0,.791120031,-.08511045745,.6057105799,0,-.04011016052,-.4397248749,.8972364289,0,.9145119872,.3579346169,-.1885487608,0,-.9612039066,-.2756484276,.01024666929,0,.6510361721,-.2877799159,-.7023778346,0,-.2041786351,.7365237271,.644859585,0,-.7718263711,.3790626912,.5104855816,0,-.3060082741,-.7692987727,.5608371729,0,.454007341,-.5024843065,.7357899537,0,.4816795475,.6021208291,-.6367380315,0,.6961980369,-.3222197429,.641469197,0,-.6532160499,-.6781148932,.3368515753,0,.5089301236,-.6154662304,-.6018234363,0,-.1635919754,-.9133604627,-.372840892,0,.52408019,-.8437664109,.1157505864,0,.5902587356,.4983817807,-.6349883666,0,.5863227872,.494764745,.6414307729,0,.6779335087,.2341345225,.6968408593,0,.7177054546,-.6858979348,.120178631,0,-.5328819713,-.5205125012,.6671608058,0,-.8654874251,-.0700727088,-.4960053754,0,-.2861810166,.7952089234,.5345495242,0,-.04849529634,.9810836427,-.1874115585,0,-.6358521667,.6058348682,.4781800233,0,.6254794696,-.2861619734,.7258696564,0,-.2585259868,.5061949264,-.8227581726,0,.02136306781,.5064016808,-.8620330371,0,.200111773,.8599263484,.4695550591,0,.4743561372,.6014985084,-.6427953014,0,.6622993731,-.5202474575,-.5391679918,0,.08084972818,-.6532720452,.7527940996,0,-.6893687501,.0592860349,.7219805347,0,-.1121887082,-.9673185067,.2273952515,0,.7344116094,.5979668656,-.3210532909,0,.5789393465,-.2488849713,.7764570201,0,.6988182827,.3557169806,-.6205791146,0,-.8636845529,-.2748771249,-.4224826141,0,-.4247027957,-.4640880967,.777335046,0,.5257722489,-.8427017621,.1158329937,0,.9343830603,.316302472,-.1639543925,0,-.1016836419,-.8057303073,-.5834887393,0,-.6529238969,.50602126,-.5635892736,0,-.2465286165,-.9668205684,-.06694497494,0,-.9776897119,-.2099250524,-.007368825344,0,.7736893337,.5734244712,.2694238123,0,-.6095087895,.4995678998,.6155736747,0,.5794535482,.7434546771,.3339292269,0,-.8226211154,.08142581855,.5627293636,0,-.510385483,.4703667658,.7199039967,0,-.5764971849,-.07231656274,-.8138926898,0,.7250628871,.3949971505,-.5641463116,0,-.1525424005,.4860840828,-.8604958341,0,-.5550976208,-.4957820792,.667882296,0,-.1883614327,.9145869398,.357841725,0,.7625556724,-.5414408243,-.3540489801,0,-.5870231946,-.3226498013,-.7424963803,0,.3051124198,.2262544068,-.9250488391,0,.6379576059,.577242424,-.5097070502,0,-.5966775796,.1454852398,-.7891830656,0,-.658330573,.6555487542,-.3699414651,0,.7434892426,.2351084581,.6260573129,0,.5562114096,.8264360377,-.0873632843,0,-.3028940016,-.8251527185,.4768419182,0,.1129343818,-.985888439,-.1235710781,0,.5937652891,-.5896813806,.5474656618,0,.6757964092,-.5835758614,-.4502648413,0,.7242302609,-.1152719764,.6798550586,0,-.9511914166,.0753623979,-.2992580792,0,.2539470961,-.1886339355,.9486454084,0,.571433621,-.1679450851,-.8032795685,0,-.06778234979,.3978269256,.9149531629,0,.6074972649,.733060024,-.3058922593,0,-.5435478392,.1675822484,.8224791405,0,-.5876678086,-.3380045064,-.7351186982,0,-.7967562402,.04097822706,-.6029098428,0,-.1996350917,.8706294745,.4496111079,0,-.02787660336,-.9106232682,-.4122962022,0,-.7797625996,-.6257634692,.01975775581,0,-.5211232846,.7401644346,-.4249554471,0,.8575424857,.4053272873,-.3167501783,0,.1045223322,.8390195772,-.5339674439,0,.3501822831,.9242524096,-.1520850155,0,.1987849858,.07647613266,.9770547224,0,.7845996363,.6066256811,-.1280964233,0,.09006737436,-.9750989929,-.2026569073,0,-.8274343547,-.542299559,.1458203587,0,-.3485797732,-.415802277,.840000362,0,-.2471778936,-.7304819962,-.6366310879,0,-.3700154943,.8577948156,.3567584454,0,.5913394901,-.548311967,-.5913303597,0,.1204873514,-.7626472379,-.6354935001,0,.616959265,.03079647928,.7863922953,0,.1258156836,-.6640829889,-.7369967419,0,-.6477565124,-.1740147258,-.7417077429,0,.6217889313,-.7804430448,-.06547655076,0,.6589943422,-.6096987708,.4404473475,0,-.2689837504,-.6732403169,-.6887635427,0,-.3849775103,.5676542638,.7277093879,0,.5754444408,.8110471154,-.1051963504,0,.9141593684,.3832947817,.131900567,0,-.107925319,.9245493968,.3654593525,0,.377977089,.3043148782,.8743716458,0,-.2142885215,-.8259286236,.5214617324,0,.5802544474,.4148098596,-.7008834116,0,-.1982660881,.8567161266,-.4761596756,0,-.03381553704,.3773180787,-.9254661404,0,-.6867922841,-.6656597827,.2919133642,0,.7731742607,-.2875793547,-.5652430251,0,-.09655941928,.9193708367,-.3813575004,0,.2715702457,-.9577909544,-.09426605581,0,.2451015704,-.6917998565,-.6792188003,0,.977700782,-.1753855374,.1155036542,0,-.5224739938,.8521606816,.02903615945,0,-.7734880599,-.5261292347,.3534179531,0,-.7134492443,-.269547243,.6467878011,0,.1644037271,.5105846203,-.8439637196,0,.6494635788,.05585611296,.7583384168,0,-.4711970882,.5017280509,-.7254255765,0,-.6335764307,-.2381686273,-.7361091029,0,-.9021533097,-.270947803,-.3357181763,0,-.3793711033,.872258117,.3086152025,0,-.6855598966,-.3250143309,.6514394162,0,.2900942212,-.7799057743,-.5546100667,0,-.2098319339,.85037073,.4825351604,0,-.4592603758,.6598504336,-.5947077538,0,.8715945488,.09616365406,-.4807031248,0,-.6776666319,.7118504878,-.1844907016,0,.7044377633,.312427597,.637304036,0,-.7052318886,-.2401093292,-.6670798253,0,.081921007,-.7207336136,-.6883545647,0,-.6993680906,-.5875763221,-.4069869034,0,-.1281454481,.6419895885,.7559286424,0,-.6337388239,-.6785471501,-.3714146849,0,.5565051903,-.2168887573,-.8020356851,0,-.5791554484,.7244372011,-.3738578718,0,.1175779076,-.7096451073,.6946792478,0,-.6134619607,.1323631078,.7785527795,0,.6984635305,-.02980516237,-.715024719,0,.8318082963,-.3930171956,.3919597455,0,.1469576422,.05541651717,-.9875892167,0,.708868575,-.2690503865,.6520101478,0,.2726053183,.67369766,-.68688995,0,-.6591295371,.3035458599,-.6880466294,0,.4815131379,-.7528270071,.4487723203,0,.9430009463,.1675647412,-.2875261255,0,.434802957,.7695304522,-.4677277752,0,.3931996188,.594473625,.7014236729,0,.7254336655,-.603925654,.3301814672,0,.7590235227,-.6506083235,.02433313207,0,-.8552768592,-.3430042733,.3883935666,0,-.6139746835,.6981725247,.3682257648,0,-.7465905486,-.5752009504,.3342849376,0,.5730065677,.810555537,-.1210916791,0,-.9225877367,-.3475211012,-.167514036,0,-.7105816789,-.4719692027,-.5218416899,0,-.08564609717,.3583001386,.929669703,0,-.8279697606,-.2043157126,.5222271202,0,.427944023,.278165994,.8599346446,0,.5399079671,-.7857120652,-.3019204161,0,.5678404253,-.5495413974,-.6128307303,0,-.9896071041,.1365639107,-.04503418428,0,-.6154342638,-.6440875597,.4543037336,0,.1074204368,-.7946340692,.5975094525,0,-.3595449969,-.8885529948,.28495784,0,-.2180405296,.1529888965,.9638738118,0,-.7277432317,-.6164050508,-.3007234646,0,.7249729114,-.00669719484,.6887448187,0,-.5553659455,-.5336586252,.6377908264,0,.5137558015,.7976208196,-.3160000073,0,-.3794024848,.9245608561,-.03522751494,0,.8229248658,.2745365933,-.4974176556,0,-.5404114394,.6091141441,.5804613989,0,.8036581901,-.2703029469,.5301601931,0,.6044318879,.6832968393,.4095943388,0,.06389988817,.9658208605,-.2512108074,0,.1087113286,.7402471173,-.6634877936,0,-.713427712,-.6926784018,.1059128479,0,.6458897819,-.5724548511,-.5050958653,0,-.6553931414,.7381471625,.159995615,0,.3910961323,.9188871375,-.05186755998,0,-.4879022471,-.5904376907,.6429111375,0,.6014790094,.7707441366,-.2101820095,0,-.5677173047,.7511360995,.3368851762,0,.7858573506,.226674665,.5753666838,0,-.4520345543,-.604222686,-.6561857263,0,.002272116345,.4132844051,-.9105991643,0,-.5815751419,-.5162925989,.6286591339,0,-.03703704785,.8273785755,.5604221175,0,-.5119692504,.7953543429,-.3244980058,0,-.2682417366,-.9572290247,-.1084387619,0,-.2322482736,-.9679131102,-.09594243324,0,.3554328906,-.8881505545,.2913006227,0,.7346520519,-.4371373164,.5188422971,0,.9985120116,.04659011161,-.02833944577,0,-.3727687496,-.9082481361,.1900757285,0,.91737377,-.3483642108,.1925298489,0,.2714911074,.4147529736,-.8684886582,0,.5131763485,-.7116334161,.4798207128,0,-.8737353606,.18886992,-.4482350644,0,.8460043821,-.3725217914,.3814499973,0,.8978727456,-.1780209141,-.4026575304,0,.2178065647,-.9698322841,-.1094789531,0,-.1518031304,-.7788918132,-.6085091231,0,-.2600384876,-.4755398075,-.8403819825,0,.572313509,-.7474340931,-.3373418503,0,-.7174141009,.1699017182,-.6756111411,0,-.684180784,.02145707593,-.7289967412,0,-.2007447902,.06555605789,-.9774476623,0,-.1148803697,-.8044887315,.5827524187,0,-.7870349638,.03447489231,.6159443543,0,-.2015596421,.6859872284,.6991389226,0,-.08581082512,-.10920836,-.9903080513,0,.5532693395,.7325250401,-.396610771,0,-.1842489331,-.9777375055,-.1004076743,0,.0775473789,-.9111505856,.4047110257,0,.1399838409,.7601631212,-.6344734459,0,.4484419361,-.845289248,.2904925424,0],Ft=Object.freeze({None:"None",ImproveXYPlanes:"ImproveXYPlanes",ImproveXZPlanes:"ImproveXZPlanes"}),Te=Object.freeze({None:"None",ImproveXYPlanes:"ImproveXYPlanes",ImproveXZPlanes:"ImproveXZPlanes",DefaultOpenSimplex2:"DefaultOpenSimplex2"});class _t{x;y;constructor(e,t){this.x=e,this.y=t}}class xt{x;y;z;constructor(e,t,i){this.x=e,this.y=t,this.z=i}}const ge=(r,e,t,i,o)=>{const n=i-t-(r-e);return o*o*o*n+o*o*(r-e-n)+o*(t-r)+e},Ae=(r,e,t)=>{let i=r^e^t;return i=Math.imul(i,668265261),i},je=(r,e,t,i,o)=>{let n=Ae(r,e,t);n^=n>>15,n&=254;const s=ct[n],a=ct[n|1];return i*s+o*a},Ie=(r,e,t,i)=>{let o=r^e^t^i;return o=Math.imul(o,668265261),o},we=(r,e,t,i,o,n,s)=>{let a=Ie(r,e,t,i);a^=a>>15,a&=252;const c=pt[a],h=pt[a|1],f=pt[a|2];return o*c+n*h+s*f},ot=r=>r*r*(3-2*r),zt=r=>r*r*r*(r*(r*6-15)+10),G=(r,e,t)=>r+t*(e-r),vr=r=>(r-=Math.trunc(r*.5)*2,r<1?r:2-r),fn=(r,e,t)=>{let i=Math.floor(e),o=Math.floor(t);const n=e-i,s=t-o,a=n-1,c=s-1,h=zt(n),f=zt(s);i=Math.imul(i,L),o=Math.imul(o,N);const u=i+L,l=o+N,p=G(je(r,i,o,n,s),je(r,u,o,a,s),h),d=G(je(r,i,l,n,c),je(r,u,l,a,c),h);return G(p,d,f)*1.4247691104677813},Pe=(r,e,t)=>{let i=Ae(r,e,t);return i=Math.imul(i,i),i^=i<<19,i*(1/2147483648)},A=(r,e,t,i)=>{let o=Ie(r,e,t,i);return o=Math.imul(o,o),o^=o<<19,o*(1/2147483648)};class be{_Seed;_Frequency=.01;_NoiseType=Ee.OpenSimplex2;_RotationType3D=Ft.None;_TransformType3D=Te.DefaultOpenSimplex2;_DomainWarpAmp=1;_FractalType=it.None;_Octaves=3;_Lacunarity=2;_Gain=.5;_WeightedStrength=0;_PingPongStrength=2;_FractalBounding=1/1.75;_CellularDistanceFunction=Ke.EuclideanSq;_CellularReturnType=Re.Distance;_CellularJitterModifier=1;_DomainWarpType=Ge.OpenSimplex2;_WarpTransformType3D=Te.DefaultOpenSimplex2;static NoiseType=Ee;static FractalType=it;static CellularDistanceFunction=Ke;static CellularReturnType=Re;static DomainWarpType=Ge;constructor(e){this._Seed=e}SetFrequency(e){this._Frequency=e}SetNoiseType(e){this._NoiseType=e,this._UpdateTransformType3D()}SetRotationType3D(e){this._RotationType3D=e,this._UpdateTransformType3D(),this._UpdateWarpTransformType3D()}SetFractalType(e){this._FractalType=e}SetFractalOctaves(e){this._Octaves=e,this._CalculateFractalBounding()}SetFractalLacunarity(e){this._Lacunarity=e}SetFractalGain(e){this._Gain=e,this._CalculateFractalBounding()}SetFractalWeightedStrength(e){this._WeightedStrength=e}SetFractalPingPongStrength(e){this._PingPongStrength=e}SetCellularDistanceFunction(e){this._CellularDistanceFunction=e}SetCellularReturnType(e){this._CellularReturnType=e}SetCellularJitter(e){this._CellularJitterModifier=e}SetDomainWarpType(e){this._DomainWarpType=e,this._UpdateWarpTransformType3D()}SetDomainWarpAmp(e){this._DomainWarpAmp=e}GetNoise(e,t,i){const o=(s,a)=>{switch(s*=this._Frequency,a*=this._Frequency,this._NoiseType){case Ee.OpenSimplex2:case Ee.OpenSimplex2S:{const h=.5*(1.7320508075688772-1),f=(s+a)*h;s+=f,a+=f;break}}switch(this._FractalType){case it.FBm:return this._GenFractalFBmR2(s,a);case it.Ridged:return this._GenFractalRidgedR2(s,a);case it.PingPong:return this._GenFractalPingPongR2(s,a);default:return this._GenNoiseSingleR2(this._Seed,s,a)}},n=(s,a,c)=>{switch(s*=this._Frequency,a*=this._Frequency,c*=this._Frequency,this._TransformType3D){case Te.ImproveXYPlanes:{const h=s+a,f=h*-.211324865405187;c*=.577350269189626,s+=f-c,a+=f-c,c+=h*.577350269189626;break}case Te.ImproveXZPlanes:{const h=s+c,f=h*-.211324865405187;a*=.577350269189626,s+=f-a,c+=f-a,a+=h*.577350269189626;break}case Te.DefaultOpenSimplex2:{const f=(s+a+c)*.6666666666666666;s=f-s,a=f-a,c=f-c;break}}switch(this._FractalType){case it.FBm:return this._GenFractalFBmR3(s,a,c);case it.Ridged:return this._GenFractalRidgedR3(s,a,c);case it.PingPong:return this._GenFractalPingPongR3(s,a,c);default:return this._GenNoiseSingleR3(this._Seed,s,a,c)}};return arguments.length===2?o(e,t):arguments.length===3&&i!==void 0?n(e,t,i):0}DomainWrap(e){switch(this._FractalType){case it.DomainWarpProgressive:this._DomainWarpFractalProgressive(e);break;case it.DomainWarpIndependent:this._DomainWarpFractalIndependent(e);break;default:this._DomainWarpSingle(e);break}}_CalculateFractalBounding(){const e=Math.abs(this._Gain);let t=e,i=1;for(let o=1;o<this._Octaves;o++)i+=t,t*=e;this._FractalBounding=1/i}_GenNoiseSingleR2(e,t,i){switch(this._NoiseType){case Ee.OpenSimplex2:return this._SingleOpenSimplex2R2(e,t,i);case Ee.OpenSimplex2S:return this._SingleOpenSimplex2SR2(e,t,i);case Ee.Cellular:return this._SingleCellularR2(e,t,i);case Ee.Perlin:return fn(e,t,i);case Ee.ValueCubic:return this._SingleValueCubicR2(e,t,i);case Ee.Value:return this._SingleValueR2(e,t,i);default:return 0}}_GenNoiseSingleR3(e,t,i,o){switch(this._NoiseType){case Ee.OpenSimplex2:return this._SingleOpenSimplex2R3(e,t,i,o);case Ee.OpenSimplex2S:return this._SingleOpenSimplex2SR3(e,t,i,o);case Ee.Cellular:return this._SingleCellularR3(e,t,i,o);case Ee.Perlin:return this._SinglePerlinR3(e,t,i,o);case Ee.ValueCubic:return this._SingleValueCubicR3(e,t,i,o);case Ee.Value:return this._SingleValueR3(e,t,i,o);default:return 0}}_UpdateTransformType3D(){switch(this._RotationType3D){case Ft.ImproveXYPlanes:this._TransformType3D=Te.ImproveXYPlanes;break;case Ft.ImproveXZPlanes:this._TransformType3D=Te.ImproveXZPlanes;break;default:switch(this._NoiseType){case Ee.OpenSimplex2:case Ee.OpenSimplex2S:this._TransformType3D=Te.DefaultOpenSimplex2;break;default:this._TransformType3D=Te.None;break}break}}_UpdateWarpTransformType3D(){switch(this._RotationType3D){case Ft.ImproveXYPlanes:this._WarpTransformType3D=Te.ImproveXYPlanes;break;case Ft.ImproveXZPlanes:this._WarpTransformType3D=Te.ImproveXZPlanes;break;default:switch(this._DomainWarpType){case Ge.OpenSimplex2:case Ge.OpenSimplex2Reduced:this._WarpTransformType3D=Te.DefaultOpenSimplex2;break;default:this._WarpTransformType3D=Te.None;break}break}}_GenFractalFBmR2(e,t){let i=this._Seed,o=0,n=this._FractalBounding;for(let s=0;s<this._Octaves;s++){const a=this._GenNoiseSingleR2(i++,e,t);o+=a*n,n*=G(1,Math.min(a+1,2)*.5,this._WeightedStrength),e*=this._Lacunarity,t*=this._Lacunarity,n*=this._Gain}return o}_GenFractalFBmR3(e,t,i){let o=this._Seed,n=0,s=this._FractalBounding;for(let a=0;a<this._Octaves;a++){const c=this._GenNoiseSingleR3(o++,e,t,i);n+=c*s,s*=G(1,(c+1)*.5,this._WeightedStrength),e*=this._Lacunarity,t*=this._Lacunarity,i*=this._Lacunarity,s*=this._Gain}return n}_GenFractalRidgedR2(e,t){let i=this._Seed,o=0,n=this._FractalBounding;for(let s=0;s<this._Octaves;s++){const a=Math.abs(this._GenNoiseSingleR2(i++,e,t));o+=(a*-2+1)*n,n*=G(1,1-a,this._WeightedStrength),e*=this._Lacunarity,t*=this._Lacunarity,n*=this._Gain}return o}_GenFractalRidgedR3(e,t,i){let o=this._Seed,n=0,s=this._FractalBounding;for(let a=0;a<this._Octaves;a++){const c=Math.abs(this._GenNoiseSingleR3(o++,e,t,i));n+=(c*-2+1)*s,s*=G(1,1-c,this._WeightedStrength),e*=this._Lacunarity,t*=this._Lacunarity,i*=this._Lacunarity,s*=this._Gain}return n}_GenFractalPingPongR2(e,t){let i=this._Seed,o=0,n=this._FractalBounding;for(let s=0;s<this._Octaves;s++){const a=vr((this._GenNoiseSingleR2(i++,e,t)+1)*this._PingPongStrength);o+=(a-.5)*2*n,n*=G(1,a,this._WeightedStrength),e*=this._Lacunarity,t*=this._Lacunarity,n*=this._Gain}return o}_GenFractalPingPongR3(e,t,i){let o=this._Seed,n=0,s=this._FractalBounding;for(let a=0;a<this._Octaves;a++){const c=vr((this._GenNoiseSingleR3(o++,e,t,i)+1)*this._PingPongStrength);n+=(c-.5)*2*s,s*=G(1,c,this._WeightedStrength),e*=this._Lacunarity,t*=this._Lacunarity,i*=this._Lacunarity,s*=this._Gain}return n}_SingleOpenSimplex2R2(e,t,i){const n=(3-1.7320508075688772)/6;let s=Math.floor(t),a=Math.floor(i);const c=t-s,h=i-a,f=(c+h)*n,u=c-f,l=h-f;s=Math.imul(s,L),a=Math.imul(a,N);let p,d,y;const v=.5-u*u-l*l;v<=0?p=0:p=v*v*(v*v)*je(e,s,a,u,l);const x=2*(1-2*n)*(1/n-2)*f+(-2*(1-2*n)*(1-2*n)+v);if(x<=0)y=0;else{const w=u+(2*n-1),m=l+(2*n-1);y=x*x*(x*x)*je(e,s+L,a+N,w,m)}if(l>u){const w=u+n,m=l+(n-1),b=.5-w*w-m*m;b<=0?d=0:d=b*b*(b*b)*je(e,s,a+N,w,m)}else{const w=u+(n-1),m=l+n,b=.5-w*w-m*m;b<=0?d=0:d=b*b*(b*b)*je(e,s+L,a,w,m)}return(p+d+y)*99.83685446303647}_SingleOpenSimplex2R3(e,t,i,o){let n=Math.round(t),s=Math.round(i),a=Math.round(o),c=t-n,h=i-s,f=o-a,u=Math.trunc(-1-h|1),l=Math.trunc(-1-c|1),p=Math.trunc(-1-f|1),d=l*-c,y=u*-h,v=p*-f;n=Math.imul(n,L),s=Math.imul(s,N),a=Math.imul(a,le);let x=0,w=.6-c*c-(h*h+f*f);for(let m=0;;m++){if(w>0&&(x+=w*w*(w*w)*we(e,n,s,a,c,h,f)),d>=y&&d>=v){let b=w+d+d;b>1&&(b-=1,x+=b*b*(b*b)*we(e,n-l*L,s,a,c+l,h,f))}else if(y>d&&y>=v){let b=w+y+y;b>1&&(b-=1,x+=b*b*(b*b)*we(e,n,s-u*N,a,c,h+u,f))}else{let b=w+v+v;b>1&&(b-=1,x+=b*b*(b*b)*we(e,n,s,a-p*le,c,h,f+p))}if(m===1)break;d=.5-d,y=.5-y,v=.5-v,c=l*d,h=u*y,f=p*v,w+=.75-d-(y+v),n+=l>>1&L,s+=u>>1&N,a+=p>>1&le,l=-l,u=-u,p=-p,e=~e}return x*32.69428253173828}_SingleOpenSimplex2SR2(e,t,i){const n=(3-1.7320508075688772)/6;let s=Math.floor(t),a=Math.floor(i);const c=t-s,h=i-a;s=Math.imul(s,L),a=Math.imul(a,N);const f=s+L,u=a+N,l=(c+h)*n,p=c-l,d=h-l,y=2/3-p*p-d*d;let v=y*y*(y*y)*je(e,s,a,p,d);const x=2*(1-2*n)*(1/n-2)*l+(-2*(1-2*n)*(1-2*n)+y),w=p-(1-2*n),m=d-(1-2*n);v+=x*x*(x*x)*je(e,f,u,w,m);const b=c-h;if(l>n){if(c+b>1){const _=p+(3*n-2),k=d+(3*n-1),g=2/3-_*_-k*k;g>0&&(v+=g*g*(g*g)*je(e,s+(L<<1),a+N,_,k))}else{const _=p+n,k=d+(n-1),g=2/3-_*_-k*k;g>0&&(v+=g*g*(g*g)*je(e,s,a+N,_,k))}if(h-b>1){const _=p+(3*n-1),k=d+(3*n-2),g=2/3-_*_-k*k;g>0&&(v+=g*g*(g*g)*je(e,s+L,a+(N<<1),_,k))}else{const _=p+(n-1),k=d+n,g=2/3-_*_-k*k;g>0&&(v+=g*g*(g*g)*je(e,s+L,a,_,k))}}else{if(c+b<0){const _=p+(1-n),k=d-n,g=2/3-_*_-k*k;g>0&&(v+=g*g*(g*g)*je(e,s-L,a,_,k))}else{const _=p+(n-1),k=d+n,g=2/3-_*_-k*k;g>0&&(v+=g*g*(g*g)*je(e,s+L,a,_,k))}if(h<b){const _=p-n,k=d-(n-1),g=2/3-_*_-k*k;g>0&&(v+=g*g*(g*g)*je(e,s,a-N,_,k))}else{const _=p+n,k=d+(n-1),g=2/3-_*_-k*k;g>0&&(v+=g*g*(g*g)*je(e,s,a+N,_,k))}}return v*18.24196194486065}_SingleOpenSimplex2SR3(e,t,i,o){let n=Math.floor(t),s=Math.floor(i),a=Math.floor(o);const c=t-n,h=i-s,f=o-a;n=Math.imul(n,L),s=Math.imul(s,N),a=Math.imul(a,le);const u=e+1293373,l=Math.trunc(-.5-c),p=Math.trunc(-.5-h),d=Math.trunc(-.5-f),y=c+l,v=h+p,x=f+d,w=.75-y*y-v*v-x*x;let m=w*w*(w*w)*we(e,n+(l&L),s+(p&N),a+(d&le),y,v,x);const b=c-.5,_=h-.5,k=f-.5,g=.75-b*b-_*_-k*k;m+=g*g*(g*g)*we(u,n+L,s+N,a+le,b,_,k);const j=((l|1)<<1)*b,M=((p|1)<<1)*_,$=((d|1)<<1)*k,C=(-2-(l<<2))*b-1,H=(-2-(p<<2))*_-1,X=(-2-(d<<2))*k-1;let Z=!1;const K=j+w;if(K>0){const W=y-(l|1);m+=K*K*(K*K)*we(e,n+(~l&L),s+(p&N),a+(d&le),W,v,x)}else{const W=M+$+w;if(W>0){const U=y,J=v-(p|1),ue=x-(d|1);m+=W*W*(W*W)*we(e,n+(l&L),s+(~p&N),a+(~d&le),U,J,ue)}const I=C+g;if(I>0){const U=(l|1)+b;m+=I*I*(I*I)*we(u,n+(l&L*2),s+N,a+le,U,_,k),Z=!0}}let ee=!1;const z=M+w;if(z>0){const W=y,I=v-(p|1);m+=z*z*(z*z)*we(e,n+(l&L),s+(~p&N),a+(d&le),W,I,x)}else{const W=j+$+w;if(W>0){const U=y-(l|1),J=v,ue=x-(d|1);m+=W*W*(W*W)*we(e,n+(~l&L),s+(p&N),a+(~d&le),U,J,ue)}const I=H+g;if(I>0){const U=b,J=(p|1)+_;m+=I*I*(I*I)*we(u,n+L,s+(p&N<<1),a+le,U,J,k),ee=!0}}let Y=!1;const V=$+w;if(V>0){const W=y,I=v,U=x-(d|1);m+=V*V*(V*V)*we(e,n+(l&L),s+(p&N),a+(~d&le),W,I,U)}else{const W=j+M+w;if(W>0){const U=y-(l|1),J=v-(p|1);m+=W*W*(W*W)*we(e,n+(~l&L),s+(~p&N),a+(d&le),U,J,x)}const I=X+g;if(I>0){const U=b,J=_,ue=(d|1)+k;m+=I*I*(I*I)*we(u,n+L,s+N,a+(d&le<<1),U,J,ue),Y=!0}}if(!Z){const W=H+X+g;if(W>0){const I=b,U=(p|1)+_,J=(d|1)+k;m+=W*W*(W*W)*we(u,n+L,s+(p&N<<1),a+(d&le<<1),I,U,J)}}if(!ee){const W=C+X+g;if(W>0){const I=(l|1)+b,U=_,J=(d|1)+k;m+=W*W*(W*W)*we(u,n+(l&L*2),s+N,a+(d&le<<1),I,U,J)}}if(!Y){const W=C+H+g;if(W>0){const I=(l|1)+b,U=(p|1)+_;m+=W*W*(W*W)*we(u,n+(l&L<<1),s+(p&N<<1),a+le,I,U,k)}}return m*9.046026385208288}_SingleCellularR2(e,t,i){const o=Math.round(t),n=Math.round(i);let s=Number.MAX_VALUE,a=Number.MAX_VALUE,c=0;const h=.43701595*this._CellularJitterModifier;let f=(o-1)*L;const u=(n-1)*N;switch(this._CellularDistanceFunction){default:case Ke.Euclidean:case Ke.EuclideanSq:for(let l=o-1;l<=o+1;l++){let p=u;for(let d=n-1;d<=n+1;d++){const y=Ae(e,f,p),v=y&510,x=l-t+de[v]*h,w=d-i+de[v|1]*h,m=x*x+w*w;a=Math.max(Math.min(a,m),s),m<s&&(s=m,c=y),p+=N}f+=L}break;case Ke.Manhattan:for(let l=o-1;l<=o+1;l++){let p=u;for(let d=n-1;d<=n+1;d++){const y=Ae(e,f,p),v=y&510,x=l-t+de[v]*h,w=d-i+de[v|1]*h,m=Math.abs(x)+Math.abs(w);a=Math.max(Math.min(a,m),s),m<s&&(s=m,c=y),p+=N}f+=L}break;case Ke.Hybrid:for(let l=o-1;l<=o+1;l++){let p=u;for(let d=n-1;d<=n+1;d++){const y=Ae(e,f,p),v=y&510,x=l-t+de[v]*h,w=d-i+de[v|1]*h,m=Math.abs(x)+Math.abs(w)+(x*x+w*w);a=Math.max(Math.min(a,m),s),m<s&&(s=m,c=y),p+=N}f+=L}break}switch(this._CellularDistanceFunction===Ke.Euclidean&&this._CellularReturnType!==Re.CellValue&&(s=Math.sqrt(s),a=Math.sqrt(a)),this._CellularReturnType){case Re.CellValue:return c*(1/2147483648);case Re.Distance:return s-1;case Re.Distance2:return a-1;case Re.Distance2Add:return(a+s)*.5-1;case Re.Distance2Sub:return a-s-1;case Re.Distance2Mul:return a*s*.5-1;case Re.Distance2Div:return s/a-1;default:return 0}}_SingleCellularR3(e,t,i,o){const n=Math.round(t),s=Math.round(i),a=Math.round(o);let c=Number.MAX_VALUE,h=Number.MAX_VALUE,f=0;const u=.39614353*this._CellularJitterModifier;let l=(n-1)*L;const p=(s-1)*N,d=(a-1)*le;switch(this._CellularDistanceFunction){case Ke.Euclidean:case Ke.EuclideanSq:for(let y=n-1;y<=n+1;y++){let v=p;for(let x=s-1;x<=s+1;x++){let w=d;for(let m=a-1;m<=a+1;m++){const b=Ie(e,l,v,w),_=b&1020,k=y-t+te[_]*u,g=x-i+te[_|1]*u,j=m-o+te[_|2]*u,M=k*k+g*g+j*j;h=Math.max(Math.min(h,M),c),M<c&&(c=M,f=b),w+=le}v+=N}l+=L}break;case Ke.Manhattan:for(let y=n-1;y<=n+1;y++){let v=p;for(let x=s-1;x<=s+1;x++){let w=d;for(let m=a-1;m<=a+1;m++){const b=Ie(e,l,v,w),_=b&1020,k=y-t+te[_]*u,g=x-i+te[_|1]*u,j=m-o+te[_|2]*u,M=Math.abs(k)+Math.abs(g)+Math.abs(j);h=Math.max(Math.min(h,M),c),M<c&&(c=M,f=b),w+=le}v+=N}l+=L}break;case Ke.Hybrid:for(let y=n-1;y<=n+1;y++){let v=p;for(let x=s-1;x<=s+1;x++){let w=d;for(let m=a-1;m<=a+1;m++){const b=Ie(e,l,v,w),_=b&1020,k=y-t+te[_]*u,g=x-i+te[_|1]*u,j=m-o+te[_|2]*u,M=Math.abs(k)+Math.abs(g)+Math.abs(j)+(k*k+g*g+j*j);h=Math.max(Math.min(h,M),c),M<c&&(c=M,f=b),w+=le}v+=N}l+=L}break}switch(this._CellularDistanceFunction===Ke.Euclidean&&this._CellularReturnType!==Re.CellValue&&(c=Math.sqrt(c),h=Math.sqrt(h)),this._CellularReturnType){case Re.CellValue:return f*(1/2147483648);case Re.Distance:return c-1;case Re.Distance2:return h-1;case Re.Distance2Add:return(h+c)*.5-1;case Re.Distance2Sub:return h-c-1;case Re.Distance2Mul:return h*c*.5-1;case Re.Distance2Div:return c/h-1;default:return 0}}_SinglePerlinR3(e,t,i,o){let n=Math.floor(t),s=Math.floor(i),a=Math.floor(o);const c=t-n,h=i-s,f=o-a,u=c-1,l=h-1,p=f-1,d=zt(c),y=zt(h),v=zt(f);n=Math.imul(n,L),s=Math.imul(s,N),a=Math.imul(a,le);const x=n+L,w=s+N,m=a+le,b=G(we(e,n,s,a,c,h,f),we(e,x,s,a,u,h,f),d),_=G(we(e,n,w,a,c,l,f),we(e,x,w,a,u,l,f),d),k=G(we(e,n,s,m,c,h,p),we(e,x,s,m,u,h,p),d),g=G(we(e,n,w,m,c,l,p),we(e,x,w,m,u,l,p),d),j=G(b,_,y),M=G(k,g,y);return G(j,M,v)*.9649214148521423}_SingleValueCubicR2(e,t,i){let o=Math.floor(t),n=Math.floor(i);const s=t-o,a=i-n;o=Math.imul(o,L),n=Math.imul(n,N);const c=o-L,h=n-N,f=o+L,u=n+N,l=o+(L<<1),p=n+(N<<1);return ge(ge(Pe(e,c,h),Pe(e,o,h),Pe(e,f,h),Pe(e,l,h),s),ge(Pe(e,c,n),Pe(e,o,n),Pe(e,f,n),Pe(e,l,n),s),ge(Pe(e,c,u),Pe(e,o,u),Pe(e,f,u),Pe(e,l,u),s),ge(Pe(e,c,p),Pe(e,o,p),Pe(e,f,p),Pe(e,l,p),s),a)*(1/(1.5*1.5))}_SingleValueCubicR3(e,t,i,o){let n=Math.floor(t),s=Math.floor(i),a=Math.floor(o);const c=t-n,h=i-s,f=o-a;n=Math.imul(n,L),s=Math.imul(s,N),a=Math.imul(a,le);const u=n-L,l=s-N,p=a-le,d=n+L,y=s+N,v=a+le,x=n+(L<<1),w=s+(N<<1),m=a+(le<<1);return ge(ge(ge(A(e,u,l,p),A(e,n,l,p),A(e,d,l,p),A(e,x,l,p),c),ge(A(e,u,s,p),A(e,n,s,p),A(e,d,s,p),A(e,x,s,p),c),ge(A(e,u,y,p),A(e,n,y,p),A(e,d,y,p),A(e,x,y,p),c),ge(A(e,u,w,p),A(e,n,w,p),A(e,d,w,p),A(e,x,w,p),c),h),ge(ge(A(e,u,l,a),A(e,n,l,a),A(e,d,l,a),A(e,x,l,a),c),ge(A(e,u,s,a),A(e,n,s,a),A(e,d,s,a),A(e,x,s,a),c),ge(A(e,u,y,a),A(e,n,y,a),A(e,d,y,a),A(e,x,y,a),c),ge(A(e,u,w,a),A(e,n,w,a),A(e,d,w,a),A(e,x,w,a),c),h),ge(ge(A(e,u,l,v),A(e,n,l,v),A(e,d,l,v),A(e,x,l,v),c),ge(A(e,u,s,v),A(e,n,s,v),A(e,d,s,v),A(e,x,s,v),c),ge(A(e,u,y,v),A(e,n,y,v),A(e,d,y,v),A(e,x,y,v),c),ge(A(e,u,w,v),A(e,n,w,v),A(e,d,w,v),A(e,x,w,v),c),h),ge(ge(A(e,u,l,m),A(e,n,l,m),A(e,d,l,m),A(e,x,l,m),c),ge(A(e,u,s,m),A(e,n,s,m),A(e,d,s,m),A(e,x,s,m),c),ge(A(e,u,y,m),A(e,n,y,m),A(e,d,y,m),A(e,x,y,m),c),ge(A(e,u,w,m),A(e,n,w,m),A(e,d,w,m),A(e,x,w,m),c),h),f)*(1/(1.5*1.5*1.5))}_SingleValueR2(e,t,i){let o=Math.floor(t),n=Math.floor(i);const s=ot(t-o),a=ot(i-n);o=Math.imul(o,L),n=Math.imul(n,N);const c=o+L,h=n+N,f=G(Pe(e,o,n),Pe(e,c,n),s),u=G(Pe(e,o,h),Pe(e,c,h),s);return G(f,u,a)}_SingleValueR3(e,t,i,o){let n=Math.floor(t),s=Math.floor(i),a=Math.floor(o);const c=ot(t-n),h=ot(i-s),f=ot(o-a);n=Math.imul(n,L),s=Math.imul(s,N),a=Math.imul(a,le);const u=n+L,l=s+N,p=a+le,d=G(A(e,n,s,a),A(e,u,s,a),c),y=G(A(e,n,l,a),A(e,u,l,a),c),v=G(A(e,n,s,p),A(e,u,s,p),c),x=G(A(e,n,l,p),A(e,u,l,p),c),w=G(d,y,h),m=G(v,x,h);return G(w,m,f)}_DoSingleDomainWarp(e,t,i,o,n,s,a){const c=(f,u,l,p,d,y)=>{switch(this._DomainWarpType){case Ge.OpenSimplex2:this._SingleDomainWarpOpenSimplex2Gradient(f,u*38.283687591552734,l,p,!1,d,y);break;case Ge.OpenSimplex2Reduced:this._SingleDomainWarpOpenSimplex2Gradient(f,u*16,l,p,!0,d,y);break;case Ge.BasicGrid:this._SingleDomainWarpBasicGrid(f,u,l,p,d,y);break}},h=(f,u,l,p,d,y,v)=>{switch(this._DomainWarpType){case Ge.OpenSimplex2:this._SingleDomainWarpOpenSimplex2Gradient(f,u*32.69428253173828,l,p,!1,d,y,v);break;case Ge.OpenSimplex2Reduced:this._SingleDomainWarpOpenSimplex2Gradient(f,u*7.71604938271605,l,p,!0,d,y,v);break;case Ge.BasicGrid:this._SingleDomainWarpBasicGrid(f,u,l,p,d,y,v);break}};if(o instanceof _t)return c(e,t,i,o,n,s);if(o instanceof xt&&a!==void 0)return h(e,t,i,o,n,s,a)}_DomainWarpSingle(e){const t=o=>{const n=this._Seed,s=this._DomainWarpAmp*this._FractalBounding,a=this._Frequency;let c=o.x,h=o.y;switch(this._DomainWarpType){case Ge.OpenSimplex2:case Ge.OpenSimplex2Reduced:{const u=.5*(1.7320508075688772-1),l=(c+h)*u;c+=l,h+=l;break}}this._DoSingleDomainWarp(n,s,a,o,c,h)},i=o=>{const n=this._Seed,s=this._DomainWarpAmp*this._FractalBounding,a=this._Frequency;let c=o.x,h=o.y,f=o.z;switch(this._WarpTransformType3D){case Te.ImproveXYPlanes:{const u=c+h,l=u*-.211324865405187;f*=.577350269189626,c+=l-f,h=h+l-f,f+=u*.577350269189626}break;case Te.ImproveXZPlanes:{const u=c+f,l=u*-.211324865405187;h*=.577350269189626,c+=l-h,f+=l-h,h+=u*.577350269189626}break;case Te.DefaultOpenSimplex2:{const l=(c+h+f)*.6666666666666666;c=l-c,h=l-h,f=l-f;break}}this._DoSingleDomainWarp(n,s,a,o,c,h,f)};if(e instanceof _t)return t(e);if(e instanceof xt)return i(e)}_DomainWarpFractalProgressive(e){const t=o=>{let n=this._Seed,s=this._DomainWarpAmp*this._FractalBounding,a=this._Frequency;for(let c=0;c<this._Octaves;c++){let h=o.x,f=o.y;switch(this._DomainWarpType){case Ge.OpenSimplex2:case Ge.OpenSimplex2Reduced:{const l=.5*(1.7320508075688772-1),p=(h+f)*l;h+=p,f+=p;break}}this._DoSingleDomainWarp(n,s,a,o,h,f),n++,s*=this._Gain,a*=this._Lacunarity}},i=o=>{let n=this._Seed,s=this._DomainWarpAmp*this._FractalBounding,a=this._Frequency;for(let c=0;c<this._Octaves;c++){let h=o.x,f=o.y,u=o.z;switch(this._WarpTransformType3D){case Te.ImproveXYPlanes:{const l=h+f,p=l*-.211324865405187;u*=.577350269189626,h+=p-u,f=f+p-u,u+=l*.577350269189626}break;case Te.ImproveXZPlanes:{const l=h+u,p=l*-.211324865405187;f*=.577350269189626,h+=p-f,u+=p-f,f+=l*.577350269189626}break;case Te.DefaultOpenSimplex2:{const p=(h+f+u)*.6666666666666666;h=p-h,f=p-f,u=p-u}break}this._DoSingleDomainWarp(n,s,a,o,h,f,u),n++,s*=this._Gain,a*=this._Lacunarity}};if(e instanceof _t)return t(e);if(e instanceof xt)return i(e)}_DomainWarpFractalIndependent(e){const t=o=>{let n=o.x,s=o.y;switch(this._DomainWarpType){case Ge.OpenSimplex2:case Ge.OpenSimplex2Reduced:{const u=.5*(1.7320508075688772-1),l=(n+s)*u;n+=l,s+=l;break}}let a=this._Seed,c=this._DomainWarpAmp*this._FractalBounding,h=this._Frequency;for(let f=0;f<this._Octaves;f++)this._DoSingleDomainWarp(a,c,h,o,n,s),a++,c*=this._Gain,h*=this._Lacunarity},i=o=>{let n=o.x,s=o.y,a=o.z;switch(this._WarpTransformType3D){case Te.ImproveXYPlanes:{const u=n+s,l=u*-.211324865405187;a*=.577350269189626,n+=l-a,s=s+l-a,a+=u*.577350269189626}break;case Te.ImproveXZPlanes:{const u=n+a,l=u*-.211324865405187;s*=.577350269189626,n+=l-s,a+=l-s,s+=u*.577350269189626}break;case Te.DefaultOpenSimplex2:{const l=(n+s+a)*.6666666666666666;n=l-n,s=l-s,a=l-a}break}let c=this._Seed,h=this._DomainWarpAmp*this._FractalBounding,f=this._Frequency;for(let u=0;u<this._Octaves;u++)this._DoSingleDomainWarp(c,h,f,o,n,s,a),c++,h*=this._Gain,f*=this._Lacunarity};if(e instanceof _t)return t(e);if(e instanceof xt)return i(e)}_SingleDomainWarpBasicGrid(e,t,i,o,n,s,a){const c=(f,u,l,p,d,y)=>{const v=d*l,x=y*l;let w=Math.floor(v),m=Math.floor(x);const b=ot(v-w),_=ot(x-m);w=Math.imul(w,L),m=Math.imul(m,N);const k=w+L,g=m+N;let j=Ae(f,w,m)&510,M=Ae(f,k,m)&510;const $=G(de[j],de[M],b),C=G(de[j|1],de[M|1],b);j=Ae(f,w,g)&510,M=Ae(f,k,g)&510;const H=G(de[j],de[M],b),X=G(de[j|1],de[M|1],b);p.x+=G($,H,_)*u,p.y+=G(C,X,_)*u},h=(f,u,l,p,d,y,v)=>{const x=d*l,w=y*l,m=v*l;let b=Math.floor(x),_=Math.floor(w),k=Math.floor(m);const g=ot(x-b),j=ot(w-_),M=ot(m-k);b=Math.imul(b,L),_=Math.imul(_,N),k=Math.imul(k,le);const $=b+L,C=_+N,H=k+le;let X=Ie(f,b,_,k)&1020,Z=Ie(f,$,_,k)&1020,K=G(te[X],te[Z],g),ee=G(te[X|1],te[Z|1],g),z=G(te[X|2],te[Z|2],g);X=Ie(f,b,C,k)&1020,Z=Ie(f,$,C,k)&1020;let Y=G(te[X],te[Z],g),V=G(te[X|1],te[Z|1],g),W=G(te[X|2],te[Z|2],g);const I=G(K,Y,j),U=G(ee,V,j),J=G(z,W,j);X=Ie(f,b,_,H)&1020,Z=Ie(f,$,_,H)&1020,K=G(te[X],te[Z],g),ee=G(te[X|1],te[Z|1],g),z=G(te[X|2],te[Z|2],g),X=Ie(f,b,C,H)&1020,Z=Ie(f,$,C,H)&1020,Y=G(te[X],te[Z],g),V=G(te[X|1],te[Z|1],g),W=G(te[X|2],te[Z|2],g),p.x+=G(I,G(K,Y,j),M)*u,p.y+=G(U,G(ee,V,j),M)*u,p.z+=G(J,G(z,W,j),M)*u};o instanceof _t&&c(e,t,i,o,n,s),o instanceof xt&&a!==void 0&&h(e,t,i,o,n,s,a)}_SingleDomainWarpOpenSimplex2Gradient(e,t,i,o,n,s,a,c){const h=(u,l,p,d,y,v,x)=>{const m=(3-1.7320508075688772)/6;v*=p,x*=p;let b=Math.floor(v),_=Math.floor(x);const k=v-b,g=x-_,j=(k+g)*m,M=k-j,$=g-j;b=Math.imul(b,L),_=Math.imul(_,N);let C,H;C=H=0;const X=.5-M*M-$*$;if(X>0){const K=X*X*(X*X);let ee,z;if(y){const Y=Ae(u,b,_)&510;ee=de[Y],z=de[Y|1]}else{const Y=Ae(u,b,_),V=Y&254,W=Y>>7&510,I=ct[V],U=ct[V|1],J=M*I+$*U,ue=de[W],ae=de[W|1];ee=J*ue,z=J*ae}C+=K*ee,H+=K*z}const Z=2*(1-2*m)*(1/m-2)*j+(-2*(1-2*m)*(1-2*m)+X);if(Z>0){const K=M+(2*m-1),ee=$+(2*m-1),z=Z*Z*(Z*Z);let Y,V;if(y){const W=Ae(u,b+L,_+N)&510;Y=de[W],V=de[W|1]}else{const W=Ae(u,b+L,_+N),I=W&254,U=W>>7&510,J=ct[I],ue=ct[I|1],ae=K*J+ee*ue,ke=de[U],Se=de[U|1];Y=ae*ke,V=ae*Se}C+=z*Y,H+=z*V}if($>M){const K=M+m,ee=$+(m-1),z=.5-K*K-ee*ee;if(z>0){const Y=z*z*(z*z);let V,W;if(y){const I=Ae(u,b,_+N)&510;V=de[I],W=de[I|1]}else{const I=Ae(u,b,_+N),U=I&254,J=I>>7&510,ue=ct[U],ae=ct[U|1],ke=K*ue+ee*ae,Se=de[J],We=de[J|1];V=ke*Se,W=ke*We}C+=Y*V,H+=Y*W}}else{const K=M+(m-1),ee=$+m,z=.5-K*K-ee*ee;if(z>0){const Y=z*z*(z*z);let V,W;if(y){const I=Ae(u,b+L,_)&510;V=de[I],W=de[I|1]}else{const I=Ae(u,b+L,_),U=I&254,J=I>>7&510,ue=ct[U],ae=ct[U|1],ke=K*ue+ee*ae,Se=de[J],We=de[J|1];V=ke*Se,W=ke*We}C+=Y*V,H+=Y*W}}d.x+=C*l,d.y+=H*l},f=(u,l,p,d,y,v,x,w)=>{v*=p,x*=p,w*=p;let m=Math.round(v),b=Math.round(x),_=Math.round(w),k=v-m,g=x-b,j=w-_,M=-k-1|1,$=-g-1|1,C=-j-1|1,H=M*-k,X=$*-g,Z=C*-j;m=Math.imul(m,L),b=Math.imul(b,N),_=Math.imul(_,le);let K,ee,z;K=ee=z=0;let Y=.6-k*k-(g*g+j*j);for(let V=0;;V++){if(Y>0){const Se=Y*Y*(Y*Y);let We,Ye,Ue;if(y){const Oe=Ie(u,m,b,_)&1020;We=te[Oe],Ye=te[Oe|1],Ue=te[Oe|2]}else{const Oe=Ie(u,m,b,_),Ze=Oe&252,Ne=Oe>>6&1020,ut=pt[Ze],Mt=pt[Ze|1],Wt=pt[Ze|2],ft=k*ut+g*Mt+j*Wt,Pt=te[Ne],O=te[Ne|1],F=te[Ne|2];We=ft*Pt,Ye=ft*O,Ue=ft*F}K+=Se*We,ee+=Se*Ye,z+=Se*Ue}let W=Y,I=m,U=b,J=_,ue=k,ae=g,ke=j;if(H>=X&&H>=Z?(ue+=M,W=W+H+H,I-=M*L):X>H&&X>=Z?(ae+=$,W=W+X+X,U-=$*N):(ke+=C,W=W+Z+Z,J-=C*le),W>1){W-=1;const Se=W*W*(W*W);let We,Ye,Ue;if(y){const Oe=Ie(u,I,U,J)&1020;We=te[Oe],Ye=te[Oe|1],Ue=te[Oe|2]}else{const Oe=Ie(u,I,U,J),Ze=Oe&252,Ne=Oe>>6&1020,ut=pt[Ze],Mt=pt[Ze|1],Wt=pt[Ze|2],ft=ue*ut+ae*Mt+ke*Wt,Pt=te[Ne],O=te[Ne|1],F=te[Ne|2];We=ft*Pt,Ye=ft*O,Ue=ft*F}K+=Se*We,ee+=Se*Ye,z+=Se*Ue}if(V===1)break;H=.5-H,X=.5-X,Z=.5-Z,k=M*H,g=$*X,j=C*Z,Y+=.75-H-(X+Z),m+=M>>1&L,b+=$>>1&N,_+=C>>1&le,M=-M,$=-$,C=-C,u+=1293373}d.x+=K*l,d.y+=ee*l,d.z+=z*l};o instanceof _t&&h(e,t,i,o,n,s,a),o instanceof xt&&c!==void 0&&f(e,t,i,o,n,s,a,c)}}const hn=({value:r,input:e,output:t})=>(r-e.min)/(e.max-e.min)*(t.max-t.min)+t.min,pn=r=>{let e=0;for(let t=0;t<r.length;t++)e=(e<<5)-e+r.charCodeAt(t),e|=0;return Math.abs(e)};class Bt{constructor(e,t){this.max=e,this._seed=t}cast(e,t){return BigInt.asUintN(t,e)}checkNum(e){if(e>this.max)throw new Error(`Number greater than ${this.max}`)}reset(){if(this.constructor===Bt)throw new Error("Method not implemented")}_int(){if(this.constructor===Bt)throw new Error("Method not implemented");return BigInt(0)}bool(){return this.float()>=.5}coin(e=.5){return this.float()<e}int(){return Number(this._int())}bigInt(){return this._int()}float(){return this.int()*(1/this.max)}float53(){const e=this.int()>>>5,t=this.int()>>>6;return(e*67108864+t)*(1/9007199254740992)}randRange(e,t){const i=t-e,o=this.max%i;let n=this.int();for(;n<o;)n=this.int();return e+n%i}randBelow(e){return this.randRange(0,e)}choice(e){return e[this.randBelow(e.length)]}shuffle(e,t=!0){let i=e;t||(i=Array.from(i));for(let o=i.length-1;o>0;o--){const n=this.randRange(0,o),s=i[o];i[o]=i[n],i[n]=s}return i}initArray(e,t){return Array.from({length:e},t)}boolArray(e){return this.initArray(e,()=>this.bool())}coinArray(e,t=.5){return this.initArray(e,()=>this.coin(t))}intArray(e){return this.initArray(e,()=>this.int())}bigIntArray(e){return this.initArray(e,()=>this.bigInt())}randRangeArray(e,t,i){return this.initArray(e,()=>this.randRange(t,i))}floatArray(e){return this.initArray(e,()=>this.float())}float53Array(e){return this.initArray(e,()=>this.float53())}}class dn extends Bt{constructor(e,t){super(e,t)}int(){return Number(this._int()>>11n)}float(){return this.int()/this.max}float53(){return this.float()}}const mn=2**32,yn=2**53;class Ir extends dn{constructor(e=Date.now(),t=13,i=7,o=17){super(yn,BigInt(e)),this.seed=e,this.a=this.cast(BigInt(t),64),this.b=this.cast(BigInt(i),64),this.c=this.cast(BigInt(o),64)}reset(){this.x=this.seed}get seed(){return this._seed}set seed(e){this._seed=this.cast(BigInt(e),64),this.x=this._seed}_int(){let{x:e}=this;return e^=e<<this.a,e=this.cast(e,64),e^=e>>this.b,e^=e<<this.c,e=this.cast(e,64),this.x=e,e}}class vn extends Bt{constructor(e=Date.now(),t=362436069,i=521288629,o=88675123,n=5783321,s=6615241,a=362437){super(mn,BigInt(e)),this._seed=this.cast(this._seed,32),this.x=this._seed,this.y=this.cast(BigInt(t),32),this.z=this.cast(BigInt(i),32),this.w=this.cast(BigInt(o),32),this.v=this.cast(BigInt(n),32),this.d=this.cast(BigInt(s),32),this.weyl=this.cast(BigInt(a),32),this.origParams={y:this.y,z:this.z,w:this.w,v:this.v,d:this.d}}reset(){this.x=this.seed,Object.assign(this,this.origParams)}get seed(){return this._seed}set seed(e){this._seed=this.cast(BigInt(e),32),this.reset()}_int(){let e=this.x,{v:t}=this;return e^=e>>2n,e^=e<<1n,t^=t<<4n,this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.v,this.v=this.cast(t^e,32),this.d+=this.weyl,this.cast(this.d+this.v,32)}}new Ir(Date.now());new Ir(Date.now());const et=({seed:r,type:e=be.NoiseType.Perlin,frequency:t=1,domain:i,fractal:o,cellular:n})=>{const s=new vn(pn(r)),a=new be(s.float());return a.SetNoiseType(e),a.SetFrequency(t),i&&(a.SetDomainWarpType(i.type),i.amp!==void 0&&a.SetDomainWarpAmp(i.amp)),o&&(a.SetFractalType(o.type),o.octaves!==void 0&&a.SetFractalOctaves(o.octaves),o.gain!==void 0&&a.SetFractalGain(o.gain),o.lacunarity!==void 0&&a.SetFractalLacunarity(o.lacunarity),o.pingPongStrength!==void 0&&a.SetFractalPingPongStrength(o.pingPongStrength),o.weightedStrength!==void 0&&a.SetFractalWeightedStrength(o.weightedStrength)),n&&(a.SetNoiseType(be.NoiseType.Cellular),n.distanceFunction&&a.SetCellularDistanceFunction(n.distanceFunction),n.returnType&&a.SetCellularReturnType(n.returnType)),(c,h)=>a.GetNoise(c,h)},gn=({offsetX:r=100,offsetZ:e=0,noise:t})=>(i,o)=>{const n=t(i*.1+r,o*.1+r)*2,s=t(i*.1+e,o*.1+e)*2;return t(i+n,o+s)},gr=(r,e,t,i)=>{const o=i.filter(s=>!s.disabled).map(({noise:s,name:a})=>s(`${t}-${a}`)),n=i.filter(s=>!s.disabled).reduce((s,{scale:a,inverse:c,weight:h,limit:f},u)=>{let l=o[u](r*a,e*a);return h&&(l*=h),c&&(l*=-1),f&&(f.min!==void 0&&(l=Math.max(f.min,l)),f.max!==void 0&&(l=Math.min(f.max,l))),l=s+l,l},0);return Math.max(-1,Math.min(1,n))},Rt=({seed:r,layers:e,variation:t=[]})=>(i,o)=>{let n=gr(i,o,r,e);const s=t.find(({min:a,max:c})=>a<=n&&n<=c);if(s){const a=gr(i,o,r,s.layers);n=hn({value:a,input:{min:-1,max:1},output:s})*s.weight}return Math.max(-1,Math.min(1,n))},wn=({seed:r})=>({heightmap:Rt({seed:`${r}-heightmap`,layers:[{name:"continents",scale:.8,weight:1,noise(e){const t=et({seed:e,frequency:.008,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:6,lacunarity:2.2,gain:.4}});return gn({noise:t,offsetX:1e3,offsetZ:2e3})}},{disabled:!0,name:"landmasses",scale:.8,weight:.7,noise(e){return et({seed:e,frequency:.02,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:5,lacunarity:2,gain:.5}})}},{disabled:!0,name:"hills",scale:2,weight:.3,noise(e){return et({seed:`${e}-hills`,frequency:.04,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:4,lacunarity:2,gain:.5}})}},{disabled:!0,name:"mountains",scale:2.5,weight:.25,noise(e){const t=et({seed:`${e}-mountains`,frequency:.05,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.Ridged,octaves:4,gain:.6,lacunarity:2.1}});return(i,o)=>{const n=t(i,o);return n>0?n*n*1.5:n}}},{disabled:!0,name:"terrain-detail",scale:6,weight:.15,noise(e){return et({seed:e,frequency:.1,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:3,gain:.4}})}}]}),biome:Rt({seed:`${r}-biome`,layers:[{name:"base-continental",scale:.5,weight:1,noise(e){return et({seed:e,frequency:.05,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:3,lacunarity:2,gain:.5}})}},{name:"detail",scale:2,weight:.3,noise(e){return et({seed:e,frequency:.1,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:2}})}}]}),temperature:Rt({seed:`${r}-temperature`,layers:[{name:"latitude",scale:.2,weight:1,noise(e){return(t,i)=>{const o=Math.sin(i*.02)*.8,n=et({seed:e,frequency:.01,type:be.NoiseType.OpenSimplex2})(t,i)*.2;return o+n}}},{name:"local-variation",scale:2,weight:.25,noise(e){return et({seed:e,frequency:.07,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:2}})}}]}),moisture:Rt({seed:`${r}-moisture`,layers:[{name:"base-moisture",scale:.8,weight:1,noise(e){return et({seed:e,frequency:.05,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:3,lacunarity:2,gain:.6}})}},{name:"local-humidity",scale:2,weight:.4,noise(e){return et({seed:e,frequency:.08,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:2}})}}]}),shade:Rt({seed:`${r}-shade`,layers:[{name:"microvariation",scale:5,weight:1,noise(e){return et({seed:e,frequency:.2,type:be.NoiseType.OpenSimplex2,fractal:{type:be.FractalType.FBm,octaves:2,gain:.4}})}}]})}),bn={maxZoom:1,minZoom:.001,plotSize:16,plotCount:256,chunkSize:16*256,chunkLimit:2048,source:wn,colorMap:un([Be.DeepOcean,Be.Ocean,Be.ShallowWater,Be.Coast,Be.Foam,Be.Beach,Be.Wetland,Be.Lowland,Be.Valley,Be.Grassland,Be.Midland,Be.Highland,Be.Foothills,Be.Mountain,Be.HighMountain,Be.MountainPeak]),layers:[{min:.001,max:.0025,level:64,offset:4},{min:.0025,max:.005,level:16,offset:4},{min:.005,max:.015,level:8,offset:4},{min:.015,max:.025,level:4,offset:4},{min:.025,max:.04,level:2,offset:4},{min:.04,max:1,level:1,offset:4}]};var cr=["u8","u16","u32","u64","u128","i8","i16","i32","i64","i128","f32","f64"],_n=function(){function r(){this.offset=0,this.buffer_size=256,this.buffer=new ArrayBuffer(this.buffer_size),this.view=new DataView(this.buffer)}return r.prototype.resize_if_necessary=function(e){if(this.buffer_size-this.offset<e){this.buffer_size=Math.max(this.buffer_size*2,this.buffer_size+e);var t=new ArrayBuffer(this.buffer_size);new Uint8Array(t).set(new Uint8Array(this.buffer)),this.buffer=t,this.view=new DataView(t)}},r.prototype.get_used_buffer=function(){return new Uint8Array(this.buffer).slice(0,this.offset)},r.prototype.store_value=function(e,t){var i=t.substring(1),o=parseInt(i)/8;this.resize_if_necessary(o);var n=t[0]==="f"?"setFloat".concat(i):t[0]==="i"?"setInt".concat(i):"setUint".concat(i);this.view[n](this.offset,e,!0),this.offset+=o},r.prototype.store_bytes=function(e){this.resize_if_necessary(e.length),new Uint8Array(this.buffer).set(new Uint8Array(e),this.offset),this.offset+=e.length},r}(),xn=function(){function r(e){this.offset=0,this.buffer_size=e.length,this.buffer=new ArrayBuffer(e.length),new Uint8Array(this.buffer).set(e),this.view=new DataView(this.buffer)}return r.prototype.assert_enough_buffer=function(e){if(this.offset+e>this.buffer.byteLength)throw new Error("Error in schema, the buffer is smaller than expected")},r.prototype.consume_value=function(e){var t=e.substring(1),i=parseInt(t)/8;this.assert_enough_buffer(i);var o=e[0]==="f"?"getFloat".concat(t):e[0]==="i"?"getInt".concat(t):"getUint".concat(t),n=this.view[o](this.offset,!0);return this.offset+=i,n},r.prototype.consume_bytes=function(e){this.assert_enough_buffer(e);var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},r}(),kn=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i[n]=o[n])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();function Sn(r){return Array.isArray(r)||!!r&&typeof r=="object"&&"length"in r&&typeof r.length=="number"&&(r.length===0||r.length>0&&r.length-1 in r)}function kt(r,e,t){if(typeof r!==e)throw new Error("Expected ".concat(e," not ").concat(typeof r,"(").concat(r,") at ").concat(t.join(".")))}function Tn(r,e){var t=["number","string","bigint","boolean"].includes(typeof r),i=typeof r=="object"&&r!==null&&"toString"in r;if(!t&&!i)throw new Error("Expected bigint, number, boolean or string not ".concat(typeof r,"(").concat(r,") at ").concat(e.join(".")))}function wr(r,e,t){if(r!==e)throw new Error("Array length ".concat(r," does not match schema length ").concat(e," at ").concat(t.join(".")))}function On(r,e){if(typeof r!="object"||r===null)throw new Error("Expected object not ".concat(typeof r,"(").concat(r,") at ").concat(e.join(".")))}var br=cr.concat(["bool","string"]),_r=["option","enum","array","set","map","struct"],Ot=function(r){kn(e,r);function e(t,i){var o="Invalid schema: ".concat(JSON.stringify(t)," expected ").concat(i);return r.call(this,o)||this}return e}(Error);function dt(r){if(!(typeof r=="string"&&br.includes(r))){if(r&&typeof r=="object"){var e=Object.keys(r);if(e.length===1&&_r.includes(e[0])){var t=e[0];if(t==="option")return dt(r[t]);if(t==="enum")return Mn(r[t]);if(t==="array")return Wn(r[t]);if(t==="set")return dt(r[t]);if(t==="map")return Pn(r[t]);if(t==="struct")return Fn(r[t])}}throw new Ot(r,_r.join(", ")+" or "+br.join(", "))}}function Mn(r){if(!Array.isArray(r))throw new Ot(r,"Array");for(var e=0,t=r;e<t.length;e++){var i=t[e];if(typeof i!="object"||!("struct"in i))throw new Error('Missing "struct" key in enum schema');if(typeof i.struct!="object"||Object.keys(i.struct).length!==1)throw new Error('The "struct" in each enum must have a single key');dt({struct:i.struct})}}function Wn(r){if(typeof r!="object")throw new Ot(r,"{ type, len? }");if(r.len&&typeof r.len!="number")throw new Error("Invalid schema: ".concat(r));if("type"in r)return dt(r.type);throw new Ot(r,"{ type, len? }")}function Pn(r){if(typeof r=="object"&&"key"in r&&"value"in r)dt(r.key),dt(r.value);else throw new Ot(r,"{ key, value }")}function Fn(r){if(typeof r!="object")throw new Ot(r,"object");for(var e in r)dt(r[e])}var Rn=function(){function r(e){this.encoded=new _n,this.fieldPath=["value"],this.checkTypes=e}return r.prototype.encode=function(e,t){return this.encode_value(e,t),this.encoded.get_used_buffer()},r.prototype.encode_value=function(e,t){if(typeof t=="string"){if(cr.includes(t))return this.encode_integer(e,t);if(t==="string")return this.encode_string(e);if(t==="bool")return this.encode_boolean(e)}if(typeof t=="object"){if("option"in t)return this.encode_option(e,t);if("enum"in t)return this.encode_enum(e,t);if("array"in t)return this.encode_array(e,t);if("set"in t)return this.encode_set(e,t);if("map"in t)return this.encode_map(e,t);if("struct"in t)return this.encode_struct(e,t)}},r.prototype.encode_integer=function(e,t){var i=parseInt(t.substring(1));i<=32||t=="f64"?(this.checkTypes&&kt(e,"number",this.fieldPath),this.encoded.store_value(e,t)):(this.checkTypes&&Tn(e,this.fieldPath),this.encode_bigint(BigInt(e),i))},r.prototype.encode_bigint=function(e,t){for(var i=t/8,o=new Uint8Array(i),n=0;n<i;n++)o[n]=Number(e&BigInt(255)),e=e>>BigInt(8);this.encoded.store_bytes(new Uint8Array(o))},r.prototype.encode_string=function(e){this.checkTypes&&kt(e,"string",this.fieldPath);for(var t=e,i=[],o=0;o<t.length;o++){var n=t.charCodeAt(o);n<128?i.push(n):n<2048?i.push(192|n>>6,128|n&63):n<55296||n>=57344?i.push(224|n>>12,128|n>>6&63,128|n&63):(o++,n=65536+((n&1023)<<10|t.charCodeAt(o)&1023),i.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63))}this.encoded.store_value(i.length,"u32"),this.encoded.store_bytes(new Uint8Array(i))},r.prototype.encode_boolean=function(e){this.checkTypes&&kt(e,"boolean",this.fieldPath),this.encoded.store_value(e?1:0,"u8")},r.prototype.encode_option=function(e,t){e==null?this.encoded.store_value(0,"u8"):(this.encoded.store_value(1,"u8"),this.encode_value(e,t.option))},r.prototype.encode_enum=function(e,t){this.checkTypes&&On(e,this.fieldPath);for(var i=Object.keys(e)[0],o=0;o<t.enum.length;o++){var n=t.enum[o];if(i===Object.keys(n.struct)[0])return this.encoded.store_value(o,"u8"),this.encode_struct(e,n)}throw new Error("Enum key (".concat(i,") not found in enum schema: ").concat(JSON.stringify(t)," at ").concat(this.fieldPath.join(".")))},r.prototype.encode_array=function(e,t){if(Sn(e))return this.encode_arraylike(e,t);if(e instanceof ArrayBuffer)return this.encode_buffer(e,t);throw new Error("Expected Array-like not ".concat(typeof e,"(").concat(e,") at ").concat(this.fieldPath.join(".")))},r.prototype.encode_arraylike=function(e,t){t.array.len?wr(e.length,t.array.len,this.fieldPath):this.encoded.store_value(e.length,"u32");for(var i=0;i<e.length;i++)this.encode_value(e[i],t.array.type)},r.prototype.encode_buffer=function(e,t){t.array.len?wr(e.byteLength,t.array.len,this.fieldPath):this.encoded.store_value(e.byteLength,"u32"),this.encoded.store_bytes(new Uint8Array(e))},r.prototype.encode_set=function(e,t){this.checkTypes&&kt(e,"object",this.fieldPath);var i=e instanceof Set,o=i?Array.from(e.values()):Object.values(e);this.encoded.store_value(o.length,"u32");for(var n=0,s=o;n<s.length;n++){var a=s[n];this.encode_value(a,t.set)}},r.prototype.encode_map=function(e,t){this.checkTypes&&kt(e,"object",this.fieldPath);var i=e instanceof Map,o=i?Array.from(e.keys()):Object.keys(e);this.encoded.store_value(o.length,"u32");for(var n=0,s=o;n<s.length;n++){var a=s[n];this.encode_value(a,t.map.key),this.encode_value(i?e.get(a):e[a],t.map.value)}},r.prototype.encode_struct=function(e,t){this.checkTypes&&kt(e,"object",this.fieldPath);for(var i=0,o=Object.keys(t.struct);i<o.length;i++){var n=o[i];this.fieldPath.push(n),this.encode_value(e[n],t.struct[n]),this.fieldPath.pop()}},r}(),En=function(){function r(e){this.buffer=new xn(e)}return r.prototype.decode=function(e){return this.decode_value(e)},r.prototype.decode_value=function(e){if(typeof e=="string"){if(cr.includes(e))return this.decode_integer(e);if(e==="string")return this.decode_string();if(e==="bool")return this.decode_boolean()}if(typeof e=="object"){if("option"in e)return this.decode_option(e);if("enum"in e)return this.decode_enum(e);if("array"in e)return this.decode_array(e);if("set"in e)return this.decode_set(e);if("map"in e)return this.decode_map(e);if("struct"in e)return this.decode_struct(e)}throw new Error("Unsupported type: ".concat(e))},r.prototype.decode_integer=function(e){var t=parseInt(e.substring(1));return t<=32||e=="f64"?this.buffer.consume_value(e):this.decode_bigint(t,e.startsWith("i"))},r.prototype.decode_bigint=function(e,t){t===void 0&&(t=!1);var i=e/8,o=new Uint8Array(this.buffer.consume_bytes(i)),n=o.reduceRight(function(s,a){return s+a.toString(16).padStart(2,"0")},"");return t&&o[i-1]?BigInt.asIntN(e,BigInt("0x".concat(n))):BigInt("0x".concat(n))},r.prototype.decode_string=function(){for(var e=this.decode_integer("u32"),t=new Uint8Array(this.buffer.consume_bytes(e)),i=[],o=0;o<e;++o){var n=t[o];if(n<128)i.push(n);else if(n<224)i.push((n&31)<<6|t[++o]&63);else if(n<240)i.push((n&15)<<12|(t[++o]&63)<<6|t[++o]&63);else{var s=(n&7)<<18|(t[++o]&63)<<12|(t[++o]&63)<<6|t[++o]&63;i.push(s)}}return String.fromCodePoint.apply(String,i)},r.prototype.decode_boolean=function(){return this.buffer.consume_value("u8")>0},r.prototype.decode_option=function(e){var t=this.buffer.consume_value("u8");if(t===1)return this.decode_value(e.option);if(t!==0)throw new Error("Invalid option ".concat(t));return null},r.prototype.decode_enum=function(e){var t,i=this.buffer.consume_value("u8");if(i>e.enum.length)throw new Error("Enum option ".concat(i," is not available"));var o=e.enum[i].struct,n=Object.keys(o)[0];return t={},t[n]=this.decode_value(o[n]),t},r.prototype.decode_array=function(e){for(var t=[],i=e.array.len?e.array.len:this.decode_integer("u32"),o=0;o<i;++o)t.push(this.decode_value(e.array.type));return t},r.prototype.decode_set=function(e){for(var t=this.decode_integer("u32"),i=new Set,o=0;o<t;++o)i.add(this.decode_value(e.set));return i},r.prototype.decode_map=function(e){for(var t=this.decode_integer("u32"),i=new Map,o=0;o<t;++o){var n=this.decode_value(e.map.key),s=this.decode_value(e.map.value);i.set(n,s)}return i},r.prototype.decode_struct=function(e){var t={};for(var i in e.struct)t[i]=this.decode_value(e.struct[i]);return t},r}();function Dn(r,e,t){t===void 0&&(t=!0),t&&dt(r);var i=new Rn(t);return i.encode(e,r)}function jn(r,e,t){t===void 0&&(t=!0),t&&dt(r);var i=new En(e);return i.decode(r)}var Le=Uint8Array,qe=Uint16Array,lr=Int32Array,$t=new Le([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Jt=new Le([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ir=new Le([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Lr=function(r,e){for(var t=new qe(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var o=new lr(t[30]),i=1;i<30;++i)for(var n=t[i];n<t[i+1];++n)o[n]=n-t[i]<<5|i;return{b:t,r:o}},Nr=Lr($t,2),zr=Nr.b,or=Nr.r;zr[28]=258,or[258]=28;var Br=Lr(Jt,0),An=Br.b,xr=Br.r,sr=new qe(32768);for(var xe=0;xe<32768;++xe){var yt=(xe&43690)>>1|(xe&21845)<<1;yt=(yt&52428)>>2|(yt&13107)<<2,yt=(yt&61680)>>4|(yt&3855)<<4,sr[xe]=((yt&65280)>>8|(yt&255)<<8)>>1}var lt=function(r,e,t){for(var i=r.length,o=0,n=new qe(e);o<i;++o)r[o]&&++n[r[o]-1];var s=new qe(e);for(o=1;o<e;++o)s[o]=s[o-1]+n[o-1]<<1;var a;if(t){a=new qe(1<<e);var c=15-e;for(o=0;o<i;++o)if(r[o])for(var h=o<<4|r[o],f=e-r[o],u=s[r[o]-1]++<<f,l=u|(1<<f)-1;u<=l;++u)a[sr[u]>>c]=h}else for(a=new qe(i),o=0;o<i;++o)r[o]&&(a[o]=sr[s[r[o]-1]++]>>15-r[o]);return a},wt=new Le(288);for(var xe=0;xe<144;++xe)wt[xe]=8;for(var xe=144;xe<256;++xe)wt[xe]=9;for(var xe=256;xe<280;++xe)wt[xe]=7;for(var xe=280;xe<288;++xe)wt[xe]=8;var Gt=new Le(32);for(var xe=0;xe<32;++xe)Gt[xe]=5;var In=lt(wt,9,0),Ln=lt(wt,9,1),Nn=lt(Gt,5,0),zn=lt(Gt,5,1),er=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},rt=function(r,e,t){var i=e/8|0;return(r[i]|r[i+1]<<8)>>(e&7)&t},tr=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},ur=function(r){return(r+7)/8|0},Gr=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new Le(r.subarray(e,t))},Bn=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Qe=function(r,e,t){var i=new Error(e||Bn[r]);if(i.code=r,Error.captureStackTrace&&Error.captureStackTrace(i,Qe),!t)throw i;return i},fr=function(r,e,t,i){var o=r.length,n=0;if(!o||e.f&&!e.l)return t||new Le(0);var s=!t,a=s||e.i!=2,c=e.i;s&&(t=new Le(o*3));var h=function(Oe){var Ze=t.length;if(Oe>Ze){var Ne=new Le(Math.max(Ze*2,Oe));Ne.set(t),t=Ne}},f=e.f||0,u=e.p||0,l=e.b||0,p=e.l,d=e.d,y=e.m,v=e.n,x=o*8;do{if(!p){f=rt(r,u,1);var w=rt(r,u+1,3);if(u+=3,w)if(w==1)p=Ln,d=zn,y=9,v=5;else if(w==2){var k=rt(r,u,31)+257,g=rt(r,u+10,15)+4,j=k+rt(r,u+5,31)+1;u+=14;for(var M=new Le(j),$=new Le(19),C=0;C<g;++C)$[ir[C]]=rt(r,u+C*3,7);u+=g*3;for(var H=er($),X=(1<<H)-1,Z=lt($,H,1),C=0;C<j;){var K=Z[rt(r,u,X)];u+=K&15;var m=K>>4;if(m<16)M[C++]=m;else{var ee=0,z=0;for(m==16?(z=3+rt(r,u,3),u+=2,ee=M[C-1]):m==17?(z=3+rt(r,u,7),u+=3):m==18&&(z=11+rt(r,u,127),u+=7);z--;)M[C++]=ee}}var Y=M.subarray(0,k),V=M.subarray(k);y=er(Y),v=er(V),p=lt(Y,y,1),d=lt(V,v,1)}else Qe(1);else{var m=ur(u)+4,b=r[m-4]|r[m-3]<<8,_=m+b;if(_>o){c&&Qe(0);break}a&&h(l+b),t.set(r.subarray(m,_),l),e.b=l+=b,e.p=u=_*8,e.f=f;continue}if(u>x){c&&Qe(0);break}}a&&h(l+131072);for(var W=(1<<y)-1,I=(1<<v)-1,U=u;;U=u){var ee=p[tr(r,u)&W],J=ee>>4;if(u+=ee&15,u>x){c&&Qe(0);break}if(ee||Qe(2),J<256)t[l++]=J;else if(J==256){U=u,p=null;break}else{var ue=J-254;if(J>264){var C=J-257,ae=$t[C];ue=rt(r,u,(1<<ae)-1)+zr[C],u+=ae}var ke=d[tr(r,u)&I],Se=ke>>4;ke||Qe(3),u+=ke&15;var V=An[Se];if(Se>3){var ae=Jt[Se];V+=tr(r,u)&(1<<ae)-1,u+=ae}if(u>x){c&&Qe(0);break}a&&h(l+131072);var We=l+ue;if(l<V){var Ye=n-V,Ue=Math.min(V,We);for(Ye+l<0&&Qe(3);l<Ue;++l)t[l]=i[Ye+l]}for(;l<We;++l)t[l]=t[l-V]}}e.l=p,e.p=U,e.b=l,e.f=f,p&&(f=1,e.m=y,e.d=d,e.n=v)}while(!f);return l!=t.length&&s?Gr(t,0,l):t.subarray(0,l)},ht=function(r,e,t){t<<=e&7;var i=e/8|0;r[i]|=t,r[i+1]|=t>>8},Et=function(r,e,t){t<<=e&7;var i=e/8|0;r[i]|=t,r[i+1]|=t>>8,r[i+2]|=t>>16},rr=function(r,e){for(var t=[],i=0;i<r.length;++i)r[i]&&t.push({s:i,f:r[i]});var o=t.length,n=t.slice();if(!o)return{t:Cr,l:0};if(o==1){var s=new Le(t[0].s+1);return s[t[0].s]=1,{t:s,l:1}}t.sort(function(_,k){return _.f-k.f}),t.push({s:-1,f:25001});var a=t[0],c=t[1],h=0,f=1,u=2;for(t[0]={s:-1,f:a.f+c.f,l:a,r:c};f!=o-1;)a=t[t[h].f<t[u].f?h++:u++],c=t[h!=f&&t[h].f<t[u].f?h++:u++],t[f++]={s:-1,f:a.f+c.f,l:a,r:c};for(var l=n[0].s,i=1;i<o;++i)n[i].s>l&&(l=n[i].s);var p=new qe(l+1),d=ar(t[f-1],p,0);if(d>e){var i=0,y=0,v=d-e,x=1<<v;for(n.sort(function(k,g){return p[g.s]-p[k.s]||k.f-g.f});i<o;++i){var w=n[i].s;if(p[w]>e)y+=x-(1<<d-p[w]),p[w]=e;else break}for(y>>=v;y>0;){var m=n[i].s;p[m]<e?y-=1<<e-p[m]++-1:++i}for(;i>=0&&y;--i){var b=n[i].s;p[b]==e&&(--p[b],++y)}d=e}return{t:new Le(p),l:d}},ar=function(r,e,t){return r.s==-1?Math.max(ar(r.l,e,t+1),ar(r.r,e,t+1)):e[r.s]=t},kr=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new qe(++e),i=0,o=r[0],n=1,s=function(c){t[i++]=c},a=1;a<=e;++a)if(r[a]==o&&a!=e)++n;else{if(!o&&n>2){for(;n>138;n-=138)s(32754);n>2&&(s(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(s(o),--n;n>6;n-=6)s(8304);n>2&&(s(n-3<<5|8208),n=0)}for(;n--;)s(o);n=1,o=r[a]}return{c:t.subarray(0,i),n:e}},Dt=function(r,e){for(var t=0,i=0;i<e.length;++i)t+=r[i]*e[i];return t},Zr=function(r,e,t){var i=t.length,o=ur(e+2);r[o]=i&255,r[o+1]=i>>8,r[o+2]=r[o]^255,r[o+3]=r[o+1]^255;for(var n=0;n<i;++n)r[o+n+4]=t[n];return(o+4+i)*8},Sr=function(r,e,t,i,o,n,s,a,c,h,f){ht(e,f++,t),++o[256];for(var u=rr(o,15),l=u.t,p=u.l,d=rr(n,15),y=d.t,v=d.l,x=kr(l),w=x.c,m=x.n,b=kr(y),_=b.c,k=b.n,g=new qe(19),j=0;j<w.length;++j)++g[w[j]&31];for(var j=0;j<_.length;++j)++g[_[j]&31];for(var M=rr(g,7),$=M.t,C=M.l,H=19;H>4&&!$[ir[H-1]];--H);var X=h+5<<3,Z=Dt(o,wt)+Dt(n,Gt)+s,K=Dt(o,l)+Dt(n,y)+s+14+3*H+Dt(g,$)+2*g[16]+3*g[17]+7*g[18];if(c>=0&&X<=Z&&X<=K)return Zr(e,f,r.subarray(c,c+h));var ee,z,Y,V;if(ht(e,f,1+(K<Z)),f+=2,K<Z){ee=lt(l,p,0),z=l,Y=lt(y,v,0),V=y;var W=lt($,C,0);ht(e,f,m-257),ht(e,f+5,k-1),ht(e,f+10,H-4),f+=14;for(var j=0;j<H;++j)ht(e,f+3*j,$[ir[j]]);f+=3*H;for(var I=[w,_],U=0;U<2;++U)for(var J=I[U],j=0;j<J.length;++j){var ue=J[j]&31;ht(e,f,W[ue]),f+=$[ue],ue>15&&(ht(e,f,J[j]>>5&127),f+=J[j]>>12)}}else ee=In,z=wt,Y=Nn,V=Gt;for(var j=0;j<a;++j){var ae=i[j];if(ae>255){var ue=ae>>18&31;Et(e,f,ee[ue+257]),f+=z[ue+257],ue>7&&(ht(e,f,ae>>23&31),f+=$t[ue]);var ke=ae&31;Et(e,f,Y[ke]),f+=V[ke],ke>3&&(Et(e,f,ae>>5&8191),f+=Jt[ke])}else Et(e,f,ee[ae]),f+=z[ae]}return Et(e,f,ee[256]),f+z[256]},Gn=new lr([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Cr=new Le(0),Zn=function(r,e,t,i,o,n){var s=n.z||r.length,a=new Le(i+s+5*(1+Math.ceil(s/7e3))+o),c=a.subarray(i,a.length-o),h=n.l,f=(n.r||0)&7;if(e){f&&(c[0]=n.r>>3);for(var u=Gn[e-1],l=u>>13,p=u&8191,d=(1<<t)-1,y=n.p||new qe(32768),v=n.h||new qe(d+1),x=Math.ceil(t/3),w=2*x,m=function(ut){return(r[ut]^r[ut+1]<<x^r[ut+2]<<w)&d},b=new lr(25e3),_=new qe(288),k=new qe(32),g=0,j=0,M=n.i||0,$=0,C=n.w||0,H=0;M+2<s;++M){var X=m(M),Z=M&32767,K=v[X];if(y[Z]=K,v[X]=Z,C<=M){var ee=s-M;if((g>7e3||$>24576)&&(ee>423||!h)){f=Sr(r,c,0,b,_,k,j,$,H,M-H,f),$=g=j=0,H=M;for(var z=0;z<286;++z)_[z]=0;for(var z=0;z<30;++z)k[z]=0}var Y=2,V=0,W=p,I=Z-K&32767;if(ee>2&&X==m(M-I))for(var U=Math.min(l,ee)-1,J=Math.min(32767,M),ue=Math.min(258,ee);I<=J&&--W&&Z!=K;){if(r[M+Y]==r[M+Y-I]){for(var ae=0;ae<ue&&r[M+ae]==r[M+ae-I];++ae);if(ae>Y){if(Y=ae,V=I,ae>U)break;for(var ke=Math.min(I,ae-2),Se=0,z=0;z<ke;++z){var We=M-I+z&32767,Ye=y[We],Ue=We-Ye&32767;Ue>Se&&(Se=Ue,K=We)}}}Z=K,K=y[Z],I+=Z-K&32767}if(V){b[$++]=268435456|or[Y]<<18|xr[V];var Oe=or[Y]&31,Ze=xr[V]&31;j+=$t[Oe]+Jt[Ze],++_[257+Oe],++k[Ze],C=M+Y,++g}else b[$++]=r[M],++_[r[M]]}}for(M=Math.max(M,C);M<s;++M)b[$++]=r[M],++_[r[M]];f=Sr(r,c,h,b,_,k,j,$,H,M-H,f),h||(n.r=f&7|c[f/8|0]<<3,f-=7,n.h=v,n.p=y,n.i=M,n.w=C)}else{for(var M=n.w||0;M<s+h;M+=65535){var Ne=M+65535;Ne>=s&&(c[f/8|0]=h,Ne=s),f=Zr(c,f+1,r.subarray(M,Ne))}n.i=s}return Gr(a,0,i+ur(f)+o)},Cn=function(r,e,t,i,o){if(!o&&(o={l:1},e.dictionary)){var n=e.dictionary.subarray(-32768),s=new Le(n.length+r.length);s.set(n),s.set(r,n.length),r=s,o.w=n.length}return Zn(r,e.level==null?6:e.level,e.mem==null?o.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,t,i,o)},Xn=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Qe(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!r[t++]);return t+(e&2)},Yn=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Un=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Qe(6,"invalid zlib data"),(r[1]>>5&1)==1&&Qe(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Vn(r,e){return Cn(r,e||{},0,0)}function Hn(r,e){return fr(r,{i:2},e,e)}function Qn(r,e){var t=Xn(r);return t+8>r.length&&Qe(6,"invalid gzip data"),fr(r.subarray(t,-8),{i:2},new Le(Yn(r)),e)}function qn(r,e){return fr(r.subarray(Un(r),-4),{i:2},e,e)}function $n(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Qn(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Hn(r,e):qn(r,e)}var Jn=typeof TextDecoder<"u"&&new TextDecoder,Kn=0;try{Jn.decode(Cr,{stream:!0}),Kn=1}catch{}const Xr=Object.freeze({struct:{id:"string",size:"i32",x:"i32",z:"i32",level:"u8",texture:{struct:{size:"i32",data:{array:{type:"u8"}}}}}}),Tr=r=>Vn(Dn(Xr,r),{level:9}),e0=r=>jn(Xr,$n(r)),t0=({color:[r,e,t,i]})=>{e/=100,t/=100;const o=(1-Math.abs(2*t-1))*e,n=o*(1-Math.abs(r/60%2-1)),s=t-o/2;let a=0,c=0,h=0;return r>=0&&r<60?(a=o,c=n,h=0):r>=60&&r<120?(a=n,c=o,h=0):r>=120&&r<180?(a=0,c=o,h=n):r>=180&&r<240?(a=0,c=n,h=o):r>=240&&r<300?(a=n,c=0,h=o):r>=300&&r<360&&(a=o,c=0,h=n),Ar([Math.round((a+s)*255),Math.round((c+s)*255),Math.round((h+s)*255),Math.round(i*255)])},r0=({colorMap:r,source:e})=>{const t=e.heightmap??0;for(const{level:i,color:o}of r){const[n,s]=i;if(t>=n&&t<=s)return t0(o)}return Ar([128,128,128,255])},n0=({seed:r,gameConfig:e,level:t})=>{const i=1/(e.plotCount*(1/t.layer.level)),o=e.source({seed:r});return({x:n,z:s})=>{const a=e.plotCount**2,c=new Uint8Array(a*4);for(let u=0;u<a;u++){const l=u%e.plotCount,p=Math.floor(u/e.plotCount),d=(n*e.plotCount+u%e.plotCount)*i,y=(s*e.plotCount+Math.floor(u/e.plotCount))*i,v=r0({colorMap:e.colorMap,source:{heightmap:o.heightmap(d,y)}});c.set(v.color,((e.plotCount-1-p)*e.plotCount+l)*4)}const h=e.chunkSize*t.layer.level,f=e.chunkSize*(t.layer.level-1)/2;return{id:`${n}:${s}:${t.layer.level}`,x:n*h+f,z:s*h+f,size:h,level:t.layer.level,texture:{size:e.plotCount,data:c}}}};async function i0({id:r,mapId:e,level:t,x:i,z:o}){const n=n0({gameConfig:bn,seed:e,level:t}),s=`/chunk/${e}/${r}.bin`;return new Promise(a=>{Tt(s).exists().then(c=>{(c?Ht(s,Tr(n({x:i,z:o}))).then(()=>!1):Ht(s,Tr(n({x:i,z:o}))).then(()=>!1)).then(h=>{Tt(s).arrayBuffer().then(f=>{a({hit:h,chunk:e0(new Uint8Array(f))})})})})})}an.worker({chunkOf:i0});
